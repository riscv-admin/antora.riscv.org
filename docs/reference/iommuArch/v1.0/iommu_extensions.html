<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RISC-V Ratified Specifications Library</title>
    <link rel="prev" href="iommu_hw_guidelines.html">
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="1ea0d9f81bc80a15c1f560d76c5d8bddea1856e2"> 
    <meta name="version" content="v1.0">
    <meta name="component" content="iommuArch">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">


<header class="header" id="antora-header">
    <nav class="navbar">
        <head>
            <link data-rh="true" rel="icon" href="/img/favicon.ico">
            <link data-rh="true" rel="canonical" href="https://developer.riscv.org/ref">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="en">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="x-default">
            <link data-rh="true" rel="preconnect" href="https://MGVPU7BN22-dsn.algolia.net" crossorigin="anonymous">
            <link rel="stylesheet" type="text/css" href="/docs/reference/_/docusaurus-styles-copy-08-25.css">

        </head>

            <link rel="preload" as="image" href="/img/logo.svg">
            <div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div>
            <div class="announcementBar_mb4j" role="banner">
                <div class="announcementBarPlaceholder_vyr4"></div>
                <div class="content_knG7 announcementBarContent_xLdY">congratulations, you found the RISC-V Developer Portal! ðŸŽ‰ . This site is under active development and not meant for public consumption yet.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div>
            <nav aria-label="Main" class="navbar ">
                <div class="navbar__inner">
                    <div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button>
                        <a class="navbar__brand" href="/">
                            <div class="navbar__logo"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Specifications</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/isa">ISA</a></li>
                                <li><a class="dropdown__link" href="/docs/spec/profiles">Profiles</a></li>
                                <li><a class="dropdown__link" docid="spec/non-isa" href="/docs/spec/non-isa">Non-ISA</a></li>
                            </ul>
                        </div>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Developers</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/intro">Specification Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/hardware/overview">Hardware Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/software/overview">Software Developers</a></li>
                            </ul>
                        </div><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://riscv.org/community/calendar/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div>
                    <div class="navbar__items navbar__items--right">
                      <div class="navbarSearchContainer_Bca1">
                        <button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)">
                          <span class="DocSearch-Button-Container">
                            <svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true">
                              <path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span class="DocSearch-Button-Placeholder">Search</span>
                          </span>
                          <span class="DocSearch-Button-Keys"></span>
                        </button>
                      </div>
                    </div>
                </div>
                <div role="presentation" class="navbar-sidebar__backdrop"></div>
            </nav>
            <div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper__tJE"></div>
        

    </nav>
</header><div class="body">
<div class="nav-container" data-component="iommuArch" data-version="v1.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">IOMMU Architecture</span>
  <span class="version">v1.0</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IOMMU Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="contributors.html">Contributors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_preface.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_data_structures.html">Data Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_in_memory_queues.html">In-memory queue interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_debug.html">Debug support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_registers.html">Memory-mapped register interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_sw_guidelines.html">Software guidelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_hw_guidelines.html">Hardware guidelines</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link"  href="iommu_extensions.html">IOMMU Extensions</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title=""
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/riscv-non-isa/riscv-iommu/edit/antora-refactor/modules/ROOT/pages/iommu_extensions.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/riscv-non-isa/riscv-iommu" title="Source Repository">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="512px" height="512px" fill="none">
    <path d="M23.6188 12.9999L19.8886 2.82896C19.7371 2.4083 19.122 2.4083 18.9705 2.82896L16.494 9.99994H7.50604L5.02956 2.82896C4.87803 2.4083 4.26295 2.4083 4.11142 2.82896L0.381247 12.9999C0.276408 13.289 0.404366 13.6112 0.678 13.7651L11.5243 19.6958C11.8256 19.8611 12.1744 19.8611 12.4757 19.6958L23.322 13.7651C23.5956 13.6112 23.7236 13.289 23.6188 12.9999Z" fill="#E24329"/>
    <path d="M12.0001 19.1956L16.4941 9.99996H7.5061L12.0001 19.1956Z" fill="#FCA326"/>
    <path d="M12.0001 19.1955L7.5061 9.99988H3.24121L12.0001 19.1955Z" fill="#E24329"/>
    <path d="M3.24121 9.99988L0.381226 12.9998C0.276388 13.2889 0.404345 13.6111 0.678 13.765L12.0001 19.1955L3.24121 9.99988Z" fill="#FCA326"/>
    <path d="M12.0001 19.1955L16.4941 9.99988H20.7589L12.0001 19.1955Z" fill="#E24329"/>
    <path d="M20.7589 9.99988L23.6188 12.9998C23.7237 13.2889 23.5957 13.6111 23.322 13.765L12.0001 19.1955L20.7589 9.99988Z" fill="#FCA326"/>
    <path d="M16.494 9.99988H20.7589L18.9705 2.82894C18.819 2.40828 18.2039 2.40828 18.0524 2.82894L16.494 9.99988Z" fill="#E24329"/>
    <path d="M7.50603 9.99988H3.24121L4.11141 2.82894C4.26294 2.40828 4.87802 2.40828 5.02955 2.82894L7.50603 9.99988Z" fill="#E24329"/>
  </svg>
  Source Repository
</a>
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li>IOMMU Architecture</li>
      <li><a href="iommu_extensions.html">IOMMU Extensions</a></li>
    </ul>
  </nav>
</div><div class="sect1">
<h2 id="extensions"><a class="anchor" href="#extensions"></a>IOMMU Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter specifies the following standard extensions to the IOMMU Base
Architecture:</p>
</div>
<table class="tableblock frame-all grid-all fit-content center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Specification</th>
<th class="tableblock halign-center valign-top">Version</th>
<th class="tableblock halign-center valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#QOSID"><strong>Quality-of-Service (QoS) Identifiers Extension</strong></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>1.0</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Ratified</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#NLINV"><strong>Non-leaf PTE Invalidation Extension</strong></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>1.0</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Ratified</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#ARINV"><strong>Address Range Invalidation Extension</strong></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>1.0</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Ratified</strong></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="QOSID"><a class="anchor" href="#QOSID"></a>Quality-of-Service (QoS) Identifiers Extension, Version 1.0</h3>
<div class="paragraph">
<p>Quality of Service (QoS) is defined as the minimal end-to-end performance
guaranteed in advance by a service level agreement (SLA) to a workload.
Performance metrics might include measures such as instructions per cycle (IPC),
latency of service, etc.</p>
</div>
<div class="paragraph">
<p>When multiple workloads execute concurrently on modern processors&#8201;&#8212;&#8201;equipped
with large core counts, multiple cache hierarchies, and multiple memory
controllers&#8201;&#8212;&#8201;the performance of any given workload becomes less
deterministic, or even non-deterministic, due to shared resource contention
cite:[PTCAMP].</p>
</div>
<div class="paragraph">
<p>To manage performance variability, system software needs resource allocation
and monitoring capabilities. These capabilities allow for the reservation of
resources like cache and bandwidth, thus meeting individual performance targets
while minimizing interference cite:[HERACLES]. For resource management, hardware
should provide monitoring features that allow system software to profile
workload resource consumption and allocate resources accordingly.</p>
</div>
<div class="paragraph">
<p>To facilitate this, the QoS Identifiers ISA extension (Ssqosid) cite:[SSQOSID]
introduces the <code>srmcfg</code> register, which configures a hart with two identifiers:
a Resource Control ID (<code>RCID</code>) and a Monitoring Counter ID (<code>MCID</code>). These
identifiers accompany each request issued by the hart to shared resource
controllers.</p>
</div>
<div class="paragraph">
<p>These identifiers are crucial for the RISC-V Capacity and Bandwidth Controller
QoS Register Interface cite:[CBQRI], which provides methods for setting resource
usage limits and monitoring resource consumption. The <code>RCID</code> controls resource
allocations, while the <code>MCID</code> is used for tracking resource usage.</p>
</div>
<div class="paragraph">
<p>The IOMMU QoS ID extension provides a method to associate QoS IDs with requests
to access resources by the IOMMU, as well as with devices governed by it. This
complements the Ssqosid extension that provides a method to associate QoS IDs
with requests originated by the RISC-V harts. Assocating QoS IDs with device
and IOMMU originated requests is required for effective monitoring and
allocation of shared resources.</p>
</div>
<div class="paragraph">
<p>The IOMMU <code>capabilities</code> register (<a href="#CAP">[CAP]</a>) is extended with a <code>QOSID</code> field
which enumerates support for associating QoS IDs with requests made through the
IOMMU. When <code>capabilities.QOSID</code> is 1, the memory-mapped register layout is
extended to add a register named <code>iommu_qosid</code> (<a href="#IOQOSID">[IOQOSID]</a>). This register is
used to configure the Quality of Service (QoS) IDs associated with
IOMMU-originated requests. The <code>ta</code> field of the device context (<a href="#DC_TA">[DC_TA]</a>) is
extended with two fields, <code>RCID</code> and <code>MCID</code>, to configure the QoS IDs to
associate with requests originated by the devices.</p>
</div>
<div class="sect3">
<h4 id="reset-behavior"><a class="anchor" href="#reset-behavior"></a>Reset Behavior</h4>
<div class="paragraph">
<p>If the reset value for <code>ddtp.iommu_mode</code> field is <code>Bare</code>, then the
<code>iommu_qosid.RCID</code> field must have a reset value of 0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At reset, it is required that the <code>RCID</code> field of <code>iommu_qosid</code> is set to 0 if
the IOMMU is in <code>Bare</code> mode, as typically the resource controllers in the
SoC default to a reset behavior of associating all capacity or bandwidth to the
<code>RCID</code> value of 0. When the reset value of the <code>ddtp.iommu_mode</code> is not <code>Bare</code>,
the <code>iommu_qosid</code> register should be initialized by software before changing
the mode to allow DMA.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sizing-qos-identifiers"><a class="anchor" href="#sizing-qos-identifiers"></a>Sizing QoS Identifiers</h4>
<div class="paragraph">
<p>The size (or width) of <code>RCID</code> and <code>MCID</code>, as fields in registers or in data
structures, supported by the IOMMU must be at least as large as that supported
by any RISC-V application processor hart in the system.</p>
</div>
</div>
<div class="sect3">
<h4 id="iommu-atc-capacity-allocation-and-monitoring"><a class="anchor" href="#iommu-atc-capacity-allocation-and-monitoring"></a>IOMMU ATC Capacity Allocation and Monitoring</h4>
<div class="paragraph">
<p>Some IOMMUs might support capacity allocation and usage monitoring in the IOMMU
address translation cache (IOATC) by implementing the capacity controller
register interface.</p>
</div>
<div class="paragraph">
<p>Additionally, some IOMMUs might support multiple IOATCs, each potentially having
different capacities. In scenarios where multiple IOATCs are implemented, such
as an IOATC for each supported page size, the IOMMU can implement a capacity
controller register interface for each IOATC to facilitate individual capacity
allocation.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="NLINV"><a class="anchor" href="#NLINV"></a>Non-leaf PTE Invalidation Extension, Version 1.0</h3>
<div class="paragraph">
<p>The RISC-V IOMMU Version 1.0 specification provides commands to invalidate
leaf page table entries from address translation caches when performing an
address-specific invalidation operation. The non-leaf PTE invalidation
extension provides commands to optionally also invalidate non-leaf PTE
entries from the address translation caches when performing an
address-specific invalidation operation.</p>
</div>
<div class="paragraph">
<p>The non-leaf PTE invalidation extension is implemented if the <code>capabilities.NL</code>
(bit 42) is 1. When the <code>capabilities.NL</code> bit is 1, a non-leaf (<code>NL</code>) field is
defined at bit 34 in the <code>IOTINVAL.VMA</code> and <code>IOTINVAL.GVMA</code> commands by this
extension. When the <code>capabilities.NL</code> bit is 0, bit 34 remains reserved.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The non-leaf PTE invalidation extension enables optimizations in shared
virtual addressing use cases by providing the ability to invalidate non-leaf
PTEs corresponding to the IOVA being invalidated from the IOMMU address
translation caches.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the address range invalidation extension is also implemented, the <code>NL</code>
operand applies to the address range determined by the <code>ADDR</code> and <code>S</code> operands.</p>
</div>
<div class="sect3">
<h4 id="non-leaf-pte-invalidation-by-iotinval-vma"><a class="anchor" href="#non-leaf-pte-invalidation-by-iotinval-vma"></a>Non-leaf PTE Invalidation by <code>IOTINVAL.VMA</code></h4>
<div class="ulist">
<ul>
<li>
<p>When the <code>AV</code> operand is 0, the <code>NL</code> operand is ignored and the <code>IOTINVAL.VMA</code>
command operations are as specified in RISC-V IOMMU Version 1.0 specification.</p>
</li>
<li>
<p>When the <code>AV</code> operand is 1 and the <code>NL</code> operand is 0, the <code>IOTINVAL.VMA</code>
command operations are as specified in RISC-V IOMMU Version 1.0 specification.</p>
</li>
<li>
<p>When both the <code>AV</code> and <code>NL</code> operands are 1, the <code>IOTINVAL.VMA</code> command
performs the following operations:</p>
<div class="ulist">
<ul>
<li>
<p>When <code>GV=0</code> and <code>PSCV=0</code>: Invalidates information cached from all levels of
first-stage page table entries corresponding to the IOVA in the <code>ADDR</code>
operand for all host address spaces, including entries containing global
mappings.</p>
</li>
<li>
<p>When <code>GV=0</code> and <code>PSCV=1</code>: Invalidates information cached from all levels of
first-stage page table entries corresponding to the IOVA in the <code>ADDR</code>
operand and the host address space identified by the <code>PSCID</code> operand, except
for entries containing global mappings.</p>
</li>
<li>
<p>When <code>GV=1</code> and <code>PSCV=0</code>: Invalidates information cached from all levels of
first-stage page table entries corresponding to the IOVA in the <code>ADDR</code>
operand for all VM address spaces associated with the <code>GSCID</code> operand,
including entries that contain global mappings.</p>
</li>
<li>
<p>When <code>GV=1</code> and <code>PSCV=1</code>: Invalidates information cached from all levels of
first-stage page table entries corresponding to the IOVA in the <code>ADDR</code>
operand and the VM address space identified by the <code>PSCID</code> and <code>GSCID</code>
operands, except for entries containing global mappings.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="non-leaf-pte-invalidation-by-iotinval-gvma"><a class="anchor" href="#non-leaf-pte-invalidation-by-iotinval-gvma"></a>Non-leaf PTE Invalidation by <code>IOTINVAL.GVMA</code></h4>
<div class="ulist">
<ul>
<li>
<p>When the <code>GV</code> operand is 0, both the <code>AV</code> and <code>NL</code> operands are ignored and
the <code>IOTINVAL.GVMA</code> command operations are as specified in RISC-V IOMMU
Version 1.0 specification.</p>
</li>
<li>
<p>When the <code>GV</code> operand is 1 and the <code>AV</code> operand is 0, the <code>NL</code> operand is
ignored and the <code>IOTINVAL.GVMA</code> command operations are as specified in
RISC-V IOMMU Version 1.0 specification.</p>
</li>
<li>
<p>When the <code>GV</code> and <code>AV</code> operands are 1 and the <code>NL</code> operand is 0, the
<code>IOTINVAL.GVMA</code> command operations are as specified in RISC-V IOMMU Version
1.0 specification.</p>
</li>
<li>
<p>When <code>GV</code>, <code>AV</code>, and <code>NL</code> are all 1, the <code>IOTINVAL.GVMA</code> command performs the
following operations:</p>
<div class="ulist">
<ul>
<li>
<p>Invalidates information cached from all levels of second-stage page table
entries corresponding to the guest-physical address in the <code>ADDR</code> operand and
the VM address spaces identified by the <code>GSCID</code> operand.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="ARINV"><a class="anchor" href="#ARINV"></a>Address Range Invalidation Extension, Version 1.0</h3>
<div class="paragraph">
<p>The address range invalidation extension enables specifying a range of addresses
in an IOMMU ATC invalidation command, reducing the number of commands queued to
the IOMMU. This facility is especially useful when superpages are employed in
page tables.</p>
</div>
<div class="paragraph">
<p>The address range invalidation extension is implemented if <code>capabilities.S</code> (bit
43) is 1. When <code>capabilities.S</code> is 1, a range-size (<code>S</code>) operand is defined at
bit 73 in the <code>IOTINVAL.VMA</code> and <code>IOTINVAL.GVMA</code> commands by this extension.
When the <code>capabilities.S</code> bit is 0, bit 73 remains reserved.</p>
</div>
<div class="paragraph">
<p>When the <code>GV</code> operand is 0, both the <code>AV</code> and <code>S</code> operands are ignored by the
<code>IOTINVAL.GVMA</code> command. When the <code>AV</code> operand is 0, the <code>S</code> operand is ignored
in both the <code>IOTINVAL.VMA</code> and <code>IOTINVAL.GVMA</code> commands. When the <code>S</code> operand is
ignored or set to 0, the operations of the <code>IOTINVAL.VMA</code> and <code>IOTINVAL.GVMA</code>
commands are as specified in the RISC-V IOMMU Version 1.0 specification.</p>
</div>
<div class="paragraph">
<p>When the <code>S</code> operand is not ignored and is 1, the <code>ADDR</code> operand represents a
NAPOT range encoded in the operand itself. Starting from bit position 0
of the <code>ADDR</code> operand, if the first 0 bit is at position <code>X</code>, the range size is
<code>2<sup>(X+1)</sup> * 4</code> KiB. When <code>X</code> is 0, the size of the range is 8 KiB.</p>
</div>
<div class="paragraph">
<p>If the <code>S</code> operand is not ignored and is 1 and all bits of the <code>ADDR</code> operand
are 1, the behavior is UNSPECIFIED.</p>
</div>
<div class="paragraph">
<p>If the <code>S</code> operand is not ignored and is 1 and the most significant bit of the
<code>ADDR</code> operand is 0 while all other bits are 1, the specified address range
covers the entire address space.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The NAPOT range encoding used by this extension follows the convention used by
PCIe ATS Invalidation Requests to denote address ranges. This convention is also
used to encode the translation range size in <code>tr_response</code> (<a href="#TRR_RSP">[TRR_RSP]</a>)
register.</p>
</div>
<div class="paragraph">
<p>Simpler implementations may invalidate all address-translation cache entries
when the <code>S</code> bit is set to 1.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="iommu_hw_guidelines.html">Hardware guidelines</a></span>
</nav>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../../ffh/v1.0/index.html">ACPI Functional Fixed Hardware</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../ffh/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../aia/v1.0/index.html">Advanced Interrupt Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../aia/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../etrace/v1.0/index.html">E-Trace Encapsulation Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../etrace/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../psabi/v1.0/index.html">ELF psABI Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../psabi/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="index.html">IOMMU Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../isa/index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../isa/index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../reri/v1.0/index.html">RERI Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../reri/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../qos/v1.0/index.html">RISC-V Capacity and Bandwidth QoS Register Interface</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../qos/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../plic/v1.0.0/index.html">RISC-V Platform-Level Interrupt Controller</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../plic/v1.0.0/index.html">
      v1.0.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../semihost/v1.0/index.html">semihosting</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../semihost/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
