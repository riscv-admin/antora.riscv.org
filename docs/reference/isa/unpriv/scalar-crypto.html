<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RISC-V Ratified Specifications Library</title>
    <link rel="prev" href="v-st-ext.html">
    <link rel="next" href="vector-crypto.html">
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: light)')?.matches && 'light'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="1ea0d9f81bc80a15c1f560d76c5d8bddea1856e2"> 
    <meta name="version" content="">
    <meta name="component" content="isa">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">


<header class="header" id="antora-header">
    <nav class="navbar">
        <head>
            <link data-rh="true" rel="icon" href="/img/favicon.ico">
            <link data-rh="true" rel="canonical" href="https://developer.riscv.org/ref">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="en">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="x-default">
            <link data-rh="true" rel="preconnect" href="https://MGVPU7BN22-dsn.algolia.net" crossorigin="anonymous">
            <link rel="stylesheet" type="text/css" href="/docs/reference/_/docusaurus-styles-copy-08-25.css">

        </head>
        <script>
            !function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())
        </script>
            <link rel="preload" as="image" href="/img/logo.svg">
            <div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div>
            <div class="announcementBar_mb4j" role="banner">
                <div class="announcementBarPlaceholder_vyr4"></div>
                <div class="content_knG7 announcementBarContent_xLdY">congratulations, you found the RISC-V Developer Portal! ðŸŽ‰ . This site is under active development and not meant for public consumption yet.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div>
            <nav aria-label="Main" class="navbar ">
                <div class="navbar__inner">
                    <div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button>
                        <a class="navbar__brand" href="/">
                            <div class="navbar__logo"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Specifications</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/isa">ISA</a></li>
                                <li><a class="dropdown__link" href="/docs/spec/profiles">Profiles</a></li>
                                <li><a class="dropdown__link" docid="spec/non-isa" href="/docs/spec/non-isa">Non-ISA</a></li>
                            </ul>
                        </div>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Developers</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/intro">Specification Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/hardware/overview">Hardware Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/software/overview">Software Developers</a></li>
                            </ul>
                        </div><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://riscv.org/community/calendar/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div>
                        <div class="navbar-item search hide-for-print">
                          <div id="search-field" class="field">
                            <input id="search-input" type="text" placeholder="Search">
                          </div>
                        </div>
                    <div class="navbar__items navbar__items--right">


                      <div class="navbarSearchContainer_Bca1">

                      </div>
                    </div>
                </div>
                <div role="presentation" class="navbar-sidebar__backdrop"></div>
            </nav>
            <div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper__tJE"></div>
        

    </nav>
</header><div class="body">
<div class="nav-container" data-component="isa" data-version="">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">ISA Specifications</span>
  <span class="version">default</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Volume I: RISC-V Unprivileged ISA Specification</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="colophon.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="rv32.html">RV32I Base Integer Instruction Set</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="rv32e.html">RV32E and RV64E Base Integer Instruction Sets, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="rv64.html">RV64I Base Integer Instruction Set</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zifencei.html">"Zifencei" Extension for Instruction-Fetch Fence, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zicsr.html">"Zicsr", Extension for Control and Status Register (CSR) Instructions, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="counters.html">"Zicntr" and "Zihpm" Extensions for Counters, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zihintntl.html">"Zihintntl" Extension for Non-Temporal Locality Hints, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zihintpause.html">"Zihintpause" Extension for Pause Hint, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zimop.html">"Zimop" Extension for May-Be-Operations, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zicond.html">"Zicond" Extension for Integer Conditional Operations, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="m-st-ext.html">"M" Extension for Integer Multiplication and Division, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="a-st-ext.html">"A" Extension for Atomic Instructions, Version 2.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zawrs.html">"Zawrs" Extension for Wait-on-Reservation-Set instructions, Version 1.01</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zacas.html">"Zacas" Extension for Atomic Compare-and-Swap (CAS) Instructions, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zabha.html">"Zabha" Extension for Byte and Halfword Atomic Memory Operations, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="rvwmo.html">RVWMO Memory Consistency Model, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="ztso-st-ext.html">"Ztso" Extension for Total Store Ordering, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="cmo.html">"CMO" Extensions for Base Cache Management Operation ISA, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="f-st-ext.html">"F" Extension for Single-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="d-st-ext.html">"D" Extension for Double-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="q-st-ext.html">"Q" Extension for Quad-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zfh.html">"Zfh" and "Zfhmin" Extensions for Half-Precision Floating-Point, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="bfloat16.html">"BF16" Extensions for for BFloat16-precision Floating-Point, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zfa.html">"Zfa" Extension for Additional Floating-Point Instructions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zfinx.html">"Zfinx", "Zdinx", "Zhinx", "Zhinxmin" Extensions for Floating-Point in Integer Registers, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="c-st-ext.html">"C" Extension for Compressed Instructions, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zc.html">"Zc*" Extension for Code Size Reduction, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="b-st-ext.html">"B" Extension for Bit Manipulation, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="v-st-ext.html">"V" Standard Extension for Vector Operations, Version 1.0</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link"  href="scalar-crypto.html">Cryptography Extensions: Scalar &amp; Entropy Source Instructions, Version 1.0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="vector-crypto.html">Cryptography Extensions: Vector Instructions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="unpriv-cfi.html">Control-flow Integrity (CFI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="rv-32-64g.html">RV32/64G Instruction Set Listings</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="naming.html">ISA Extension Naming Conventions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="mm-eplan.html">Appendix A: RVWMO Explanatory Material, Version 0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="mm-formal.html">Appendix B: Formal Memory Model Specifications, Version 0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="vector-examples.html">Appendix C: Vector Assembly Code Examples</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="calling-convention.html">Appendix D: Calling Convention for Vector State (Not authoritative - Placeholder Only)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Volume II: RISC-V Privileged ISA Specification</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/priv-index.html">Privileged Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/priv-contributors.html">Contributors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/priv-preface.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/priv-intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/priv-csrs.html">Control and Status Registers (CSRs)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/machine.html">Machine-Level ISA, Version 1.13</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/smstateen.html">"Smstateen/Ssstateen" Extensions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/indirect-csr.html">"Smcsrind/Sscsrind" Indirect CSR Access, version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="#smepmp.adoc">"Smepmp" Extension for PMP Enhancements, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/smcntrpmf.html">"Smcntrpmf" Cycke and Instret Privilege Mode Filtering, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/rnmi.html">"Smrnmi" Extension for Resumable Non-Maskable Interrupts, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/smcdeleg.html">"Smcdeleg" Counter Delegation Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/smdbltrp.html">"Smdbltrp" Double Trap Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/smctr.html">"Smctr" Control Transfer Records Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/supervisor.html">Supervisor-Level ISA, Version 1.13</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/sstc.html">"Sstc" Extension for Supervisor-mode Timer Interrupts, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/sscofpmf.html">"Sscofpmf" Extension for Count Overflow and Mode-Based Filtering, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/hypervisor.html">"H" Extension for Hypervisor Support, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/priv-cfi.html">Control-flow Integrity(CFI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/ssdbltrp.html">"Ssdbltrp" Double Trap Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/zpm.html">Pointer Masking Extensions, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/priv-insns.html">RISC-V Privileged Instruction Set Listings</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/priv-history.html">History</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../priv/bibliography.html">Bibliography</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title=""
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li><a href="../index.html">ISA Specifications</a></li>
      <li>Volume I: RISC-V Unprivileged ISA Specification</li>
      <li><a href="scalar-crypto.html">Cryptography Extensions: Scalar &amp; Entropy Source Instructions, Version 1.0.1</a></li>
    </ul>
  </nav>
</div><div class="sect1">
<h2 id="crypto_scalar_instructions"><a class="anchor" href="#crypto_scalar_instructions"></a>Cryptography Extensions: Scalar &amp; Entropy Source Instructions, Version 1.0.1</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="changelog"><a class="anchor" href="#changelog"></a>Changelog</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>v1.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fix typos to show that
  <code>c.srli</code>, <code>c.srai</code>, and <code>c.slli</code> are Zkt instructions in RV64.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>v1.0.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Release</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="crypto_scalar_introduction"><a class="anchor" href="#crypto_scalar_introduction"></a>Introduction</h3>
<div class="paragraph">
<p>This document describes the <em>scalar</em> cryptography
extension for RISC-V.
All instructions described herein use the general-purpose <code>X</code>
registers, and obey the 2-read-1-write register access constraint.
These instructions are designed to be lightweight and suitable
for <code>32</code> and <code>64</code> bit base architectures; from embedded IoT class
cores to large, application class cores which do not implement a
vector unit.</p>
</div>
<div class="paragraph">
<p>This document also describes the architectural interface to an
Entropy Source, which can be used to generate cryptographic secrets.
This is found in <a href="#crypto_scalar_es">Entropy Source</a>.</p>
</div>
<div class="paragraph">
<p>It also contains a mechanism allowing core implementers to provide
<em>"Constant Time Execution"</em> guarantees in <a href="#crypto_scalar_zkt">Data Independent Execution Latency Subset: Zkt</a>.</p>
</div>
<div class="sect3">
<h4 id="crypto_scalar_audience"><a class="anchor" href="#crypto_scalar_audience"></a>Intended Audience</h4>
<div class="paragraph">
<p>Cryptography is a specialised subject, requiring people with many different
backgrounds to cooperate in its secure and efficient implementation.
Where possible, we have written this specification to be understandable by
all, though we recognise that the motivations and references to
algorithms or other specifications and standards may be unfamiliar to those
who are not domain experts.</p>
</div>
<div class="paragraph">
<p>This specification anticipates being read and acted on by various people
with different backgrounds.
We have tried to capture these backgrounds
here, with a brief explanation of what we expect them to know, and how
it relates to the specification.
We hope this aids people&#8217;s understanding of which aspects of the specification
are particularly relevant to them, and which they may (safely!) ignore or
pass to a colleague.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Cryptographers and cryptographic software developers</dt>
<dd>
<p>These are the people we expect to write code using the instructions
in this specification.
They should understand fairly obviously the motivations for the
instructions we include, and be familiar with most of the algorithms
and outside standards to which we refer.
We expect the sections on constant time execution
(<a href="#crypto_scalar_zkt">Data Independent Execution Latency Subset: Zkt</a>)
and the entropy source
(<a href="#crypto_scalar_es">Entropy Source</a>)
to be chiefly understood with their help.</p>
</dd>
<dt class="hdlist1">Computer architects</dt>
<dd>
<p>We do not expect architects to have a cryptography background.
We nonetheless expect architects to be able to examine our instructions
for implementation issues, understand how the instructions will be used
in context, and advise on how best to fit the functionality the
cryptographers want to the ISA interface.</p>
</dd>
<dt class="hdlist1">Digital design engineers &amp; micro-architects</dt>
<dd>
<p>These are the people who will implement the specification inside a
core. Again, no cryptography expertise is assumed, but we expect them to
interpret the specification and anticipate any hardware implementation
issues, e.g., where high-frequency design considerations apply, or where
latency/area tradeoffs exist etc.
In particular, they should be aware of the literature around efficiently
implementing AES and SM4 SBoxes in hardware.</p>
</dd>
<dt class="hdlist1">Verification engineers</dt>
<dd>
<p>Responsible for ensuring the correct implementation of the extension
in hardware.
No cryptography background is assumed.
We expect them to identify interesting test cases from the
specification. An understanding of their real-world usage will help with this.
We do not expect verification engineers in this sense to be experts
in entropy source design or certification, since this is a very
specialised area.
We do expect them however to identify all of the <em>architectural</em>
test cases around the entropy source interface.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These are by no means the only people concerned with the specification,
but they are the ones we considered most while writing it.</p>
</div>
</div>
<div class="sect3">
<h4 id="crypto_scalar_sail_specifications"><a class="anchor" href="#crypto_scalar_sail_specifications"></a>Sail Specifications</h4>
<div class="paragraph">
<p>RISC-V maintains a
<a href="https://github.com/riscv/sail-riscv">formal model</a>
of the ISA specification,
implemented in the Sail ISA specification language
cite:[sail].
Note that <em>Sail</em> refers to the specification language itself,
and that there is a <em>model of RISC-V</em>, written using Sail.
It is not correct to refer to "the Sail model".
This is ambiguous, given there are many models of different ISAs implemented
using Sail. We refer to the Sail implementation of RISC-V as
"the RISC-V Sail model".</p>
</div>
<div class="paragraph">
<p>The Cryptography extension uses inline Sail code snippets from the
actual model to give canonical descriptions of instruction
functionality.
Each instruction is accompanied by its expression in Sail, and includes
calls to supporting functions which are too verbose to include directly
in the specification.
This supporting code is listed in
<a href="#crypto_scalar_appx_sail">Supporting Sail Code</a>.
The
<a href="https://alasdair.github.io/manual.html">Sail Manual</a>
is recommended reading in order to best understand the code snippets.</p>
</div>
<div class="paragraph">
<p>Note that this document contains only a subset of the formal model: refer to
the formal model GitHub
<a href="https://github.com/riscv/sail-riscv">repository</a>
for the complete model.</p>
</div>
</div>
<div class="sect3">
<h4 id="crypto_scalar_policies"><a class="anchor" href="#crypto_scalar_policies"></a>Policies</h4>
<div class="paragraph">
<p>In creating this proposal, we tried to adhere to the following
policies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Where there is a choice between:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>supporting diverse implementation strategies for an algorithm
or</p>
</li>
<li>
<p>supporting a single implementation style which is more performant /
   less expensive;
the crypto extension will pick the more constrained but performant
option.
This fits a common pattern in other parts of the RISC-V specification,
where recommended (but not required) instruction sequences for performing
particular tasks are given as an example, such that both hardware and
software implementers can optimise for only a single use-case.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The extension will be designed to support <em>existing</em> standardised
cryptographic constructs well.
It will not try to support proposed standards, or cryptographic
constructs which exist only in academia.
Cryptographic standards which are settled upon concurrently with or after
the RISC-V cryptographic extension standardisation will be dealt with
by future additions to, or versions of, the RISC-V cryptographic
standard extension. It is anticipated that the NIST Lightweight
Cryptography contest and the NIST Post-Quantum Cryptography contest
may be dealt with this way, depending on timescales.</p>
</li>
<li>
<p>Historically, there has been some discussion
cite:[LSYRR:04]
on how newly supported operations in general-purpose computing might
enable new bases for cryptographic algorithms.
The standard will not try to anticipate new useful low-level
operations which <em>may</em> be useful as building blocks for
future cryptographic constructs.</p>
</li>
<li>
<p>Regarding side-channel countermeasures:
Where relevant, proposed instructions must aim to remove the
possibility of any timing side-channels.
For side-channels based on power or electro-magnetic (EM) measurements,
the extension will not aim to support countermeasures which are
implemented above the ISA abstraction layer.
Recommendations will be given where relevant on how micro-architectures
can implement instructions in a power/EM side-channel resistant way.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crypto_scalar_extensions"><a class="anchor" href="#crypto_scalar_extensions"></a>Extensions Overview</h3>
<div class="paragraph">
<p>The group of extensions introduced by the Scalar Cryptography Instruction Set
Extension is listed here.</p>
</div>
<div class="paragraph">
<p>Detection of individual cryptography extensions uses the
unified software-based RISC-V discovery method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At the time of writing, these discovery mechanisms are still a work in
progress.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">A note on extension rationale</div>
<div class="paragraph">
<p>Specialist encryption and decryption instructions are separated into different
functional groups because some use cases (e.g., Galois/Counter
Mode in TLS 1.3) do not require decryption functionality.</p>
</div>
<div class="paragraph">
<p>The NIST and ShangMi algorithms suites are separated because their
usefulness is heavily dependent on the countries a device is expected to
operate in. NIST ciphers are a part of most standardised internet
protocols, while ShangMi ciphers are required for use in China.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="zbkb-sc"><a class="anchor" href="#zbkb-sc"></a><code>Zbkb</code> - Bitmanip instructions for Cryptography</h4>
<div class="paragraph">
<p>This extension contains bit-manipulation instructions that are particularly
useful for cryptography, most of which are also in the <code>Zbb</code> extension.
Please refer to <a href="b-st-ext.html#zbkb" class="xref page">b-st-ext.adoc#zbkb</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="zbkc-sc"><a class="anchor" href="#zbkc-sc"></a><code>Zbkc</code> - Carry-less multiply instructions</h4>
<div class="paragraph">
<p>Constant time carry-less multiply for Galois/Counter Mode.
These are separated from the <a href="b-st-ext.html#zbkb" class="xref page">b-st-ext.adoc#zbkb</a> because they
have a considerable implementation overhead which cannot be amortised
across other instructions.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="b-st-ext.html#zbkc" class="xref page">b-st-ext.adoc#zbkc</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="zbkx-sc"><a class="anchor" href="#zbkx-sc"></a><code>Zbkx</code> - Crossbar permutation instructions</h4>
<div class="paragraph">
<p>These instructions are useful for implementing SBoxes in constant time, and
potentially with DPA protections.
These are separated from the <a href="b-st-ext.html#zbkb" class="xref page">b-st-ext.adoc#zbkb</a> because they
have an implementation overhead which cannot be amortised
across other instructions.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="b-st-ext.html#zbkx" class="xref page">b-st-ext.adoc#zbkx</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="zknd"><a class="anchor" href="#zknd"></a><code>Zknd</code> - NIST Suite: AES Decryption</h4>
<div class="paragraph">
<p>Instructions for accelerating the decryption and key-schedule functions of
the AES block cipher.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes32dsi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes32dsi">AES final round decrypt (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes32dsmi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes32dsmi">AES middle round decrypt (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64ds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64ds">AES decrypt final round (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64dsm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64dsm">AES decrypt middle round (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64im</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64im">AES Decrypt KeySchedule MixColumns (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64ks1i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64ks1i">AES Key Schedule Instruction 1 (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64ks2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64ks2">AES Key Schedule Instruction 2 (RV64)</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="#insns-aes64ks1i">AES Key Schedule Instruction 1 (RV64)</a> and <a href="#insns-aes64ks2">AES Key Schedule Instruction 2 (RV64)</a> instructions are
present in both the <a href="#zknd">Zknd</a> and <a href="#zkne">Zkne</a> extensions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="zkne"><a class="anchor" href="#zkne"></a><code>Zkne</code> - NIST Suite: AES Encryption</h4>
<div class="paragraph">
<p>Instructions for accelerating the encryption and key-schedule functions of
the AES block cipher.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes32esi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes32esi">AES final round encrypt (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes32esmi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes32esmi">AES middle round encrypt (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64es</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64es">AES encrypt final round instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64esm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64esm">AES encrypt middle round instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64ks1i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64ks1i">AES Key Schedule Instruction 1 (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64ks2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64ks2">AES Key Schedule Instruction 2 (RV64)</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The
<a href="#insns-aes64ks1i"><code>aes64ks1i</code></a>
and
<a href="#insns-aes64ks2"><code>aes64ks2</code></a>
instructions are present in both the <a href="#zknd">Zknd</a> and <a href="#zkne">Zkne</a> extensions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="zknh"><a class="anchor" href="#zknh"></a><code>Zknh</code> - NIST Suite: Hash Function Instructions</h4>
<div class="paragraph">
<p>Instructions for accelerating the SHA2 family of cryptographic hash functions,
as specified in cite:[nist:fips:180:4].</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256sig0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha256sig0">SHA2-256 Sigma0 instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256sig1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha256sig1">SHA2-256 Sigma1 instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256sum0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha256sum0">SHA2-256 Sum0 instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256sum1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha256sum1">SHA2-256 Sum1 instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig0h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig0h">SHA2-512 Sigma0 high (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig0l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig0l">SHA2-512 Sigma0 low (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig1h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig1h">SHA2-512 Sigma1 high (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig1l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig1l">SHA2-512 Sigma1 low (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum0r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sum0r">SHA2-512 Sum0 (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum1r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sum1r">SHA2-512 Sum1 (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig0">SHA2-512 Sigma0 instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig1">SHA2-512 Sigma1 instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sum0">SHA2-512 Sum0 instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sum1">SHA2-512 Sum1 instruction (RV64)</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="zksed"><a class="anchor" href="#zksed"></a><code>Zksed</code> - ShangMi Suite: SM4 Block Cipher Instructions</h4>
<div class="paragraph">
<p>Instructions for accelerating the SM4 Block Cipher.
Note that unlike AES, this cipher uses the same core operation for
encryption and decryption, hence there is only one
extension for it.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sm4ed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sm4ed">SM4 Encrypt/Decrypt Instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sm4ks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sm4ks">SM4 Key Schedule Instruction</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="zksh"><a class="anchor" href="#zksh"></a><code>Zksh</code> - ShangMi Suite: SM3 Hash Function Instructions</h4>
<div class="paragraph">
<p>Instructions for accelerating the SM3 hash function.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sm3p0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sm3p0">SM3 P0 transform</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sm3p1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sm3p1">SM3 P1 transform</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="zkr"><a class="anchor" href="#zkr"></a><code>Zkr</code> - Entropy Source Extension</h4>
<div class="paragraph">
<p>The entropy source extension defines the <code>seed</code> CSR at address <code>0x015</code>.
This CSR provides up to 16 physical <code>entropy</code> bits that can be used to
seed cryptographic random bit generators.</p>
</div>
<div class="paragraph">
<p>See <a href="#crypto_scalar_es">Entropy Source</a> for the normative specification and access control
notes. <a href="#crypto_scalar_appx_es">Entropy Source Rationale and Recommendations</a> contains design rationale and further
recommendations to implementers.</p>
</div>
</div>
<div class="sect3">
<h4 id="zkn"><a class="anchor" href="#zkn"></a><code>Zkn</code> - NIST Algorithm Suite</h4>
<div class="paragraph">
<p>This extension is shorthand for the following set of other extensions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Included Extension</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zbkb-sc">Zbkb-sc</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitmanipulation instructions for cryptography.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zbkc-sc">Zbkc-sc</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carry-less multiply instructions.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zbkx-sc">Zbkx-sc</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-bar Permutation instructions.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zkne">Zkne</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AES encryption instructions.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zknd">Zknd</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AES decryption instructions.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zknh">Zknh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHA2 hash function instructions.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A core which implements <code>Zkn</code> must implement all of the above extensions.</p>
</div>
</div>
<div class="sect3">
<h4 id="zks"><a class="anchor" href="#zks"></a><code>Zks</code> - ShangMi Algorithm Suite</h4>
<div class="paragraph">
<p>This extension is shorthand for the following set of other extensions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Included Extension</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zbkb-sc">Zbkb-sc</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitmanipulation instructions for cryptography.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zbkc-sc">Zbkc-sc</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carry-less multiply instructions.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zbkx-sc">Zbkx-sc</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-bar Permutation instructions.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zksed">Zksed</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SM4 block cipher instructions.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zksh">Zksh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SM3 hash function instructions.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A core which implements <code>Zks</code> must implement all of the above extensions.</p>
</div>
</div>
<div class="sect3">
<h4 id="zk"><a class="anchor" href="#zk"></a><code>Zk</code> - Standard scalar cryptography extension</h4>
<div class="paragraph">
<p>This extension is shorthand for the following set of other extensions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Included Extension</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zkn">Zkn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NIST Algorithm suite extension.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#zkr">Zkr</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entropy Source extension.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#crypto_scalar_zkt">Zkt</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data independent execution latency extension.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A core which implements <code>Zk</code> must implement all of the above extensions.</p>
</div>
</div>
<div class="sect3">
<h4 id="zkt-data-independent-execution-latency"><a class="anchor" href="#zkt-data-independent-execution-latency"></a><code>Zkt</code> - Data Independent Execution Latency</h4>
<div class="paragraph">
<p>This extension allows CPU implementers to indicate to
cryptographic software developers that a subset of RISC-V instructions
are guaranteed to be implemented such that their execution latency
is independent of the data values they operate on.
A complete description of this extension is found in
<a href="#crypto_scalar_zkt">Data Independent Execution Latency Subset: Zkt</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crypto_scalar_insns"><a class="anchor" href="#crypto_scalar_insns"></a>Instructions</h3>
<div class="sect3">
<h4 id="insns-aes32dsi"><a class="anchor" href="#insns-aes32dsi"></a>aes32dsi</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AES final round decryption instruction for RV32.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes32dsi rd, rs1, rs2, bs</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGFoihA2gitPKgapjq0FAGpfMy4=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction sources a single byte from <code>rs2</code> according to <code>bs</code>.
To this it applies the inverse AES SBox operation, and XOR&#8217;s the result with
<code>rs1</code>.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES32DSI (bs,rs2,rs1,rd)) = {
  let shamt   : bits( 5) = bs @ 0b000; /* shamt = bs*8 */
  let si      : bits( 8) = (X(rs2)[31..0] &gt;&gt; shamt)[7..0]; /* SBox Input */
  let so      : bits(32) = 0x000000 @ aes_sbox_inv(si);
  let result  : bits(32) = X(rs1)[31..0] ^ rol32(so, unsigned(shamt));
  X(rd) = EXTS(result); RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknd">Zknd</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes32dsmi"><a class="anchor" href="#insns-aes32dsmi"></a>aes32dsmi</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AES middle round decryption instruction for RV32.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes32dsmi rd, rs1, rs2, bs</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGFojhA2gitPKgapjq0FAGqZMzA=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction sources a single byte from <code>rs2</code> according to <code>bs</code>.
To this it applies the inverse AES SBox operation, and a partial inverse
MixColumn, before XOR&#8217;ing the result with <code>rs1</code>.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES32DSMI (bs,rs2,rs1,rd)) = {
  let shamt   : bits( 5) = bs @ 0b000; /* shamt = bs*8 */
  let si      : bits( 8) = (X(rs2)[31..0] &gt;&gt; shamt)[7..0]; /* SBox Input */
  let so      : bits( 8) = aes_sbox_inv(si);
  let mixed   : bits(32) = aes_mixcolumn_byte_inv(so);
  let result  : bits(32) = X(rs1)[31..0] ^ rol32(mixed, unsigned(shamt));
  X(rd) = EXTS(result); RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknd">Zknd</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes32esi"><a class="anchor" href="#insns-aes32esi"></a>aes32esi</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AES final round encryption instruction for RV32.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes32esi rd, rs1, rs2, bs</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGFoiBA2gitPKgapjq0FAGnrMyo=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction sources a single byte from <code>rs2</code> according to <code>bs</code>.
To this it applies the forward AES SBox operation,
before XOR&#8217;ing the result with <code>rs1</code>.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES32ESI (bs,rs2,rs1,rd)) = {
  let shamt   : bits( 5) = bs @ 0b000; /* shamt = bs*8 */
  let si      : bits( 8) = (X(rs2)[31..0] &gt;&gt; shamt)[7..0]; /* SBox Input */
  let so      : bits(32) = 0x000000 @ aes_sbox_fwd(si);
  let result  : bits(32) = X(rs1)[31..0] ^ rol32(so, unsigned(shamt));
  X(rd) = EXTS(result); RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkne">Zkne</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes32esmi"><a class="anchor" href="#insns-aes32esmi"></a>aes32esmi</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AES middle round encryption instruction for RV32.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes32esmi rd, rs1, rs2, bs</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGGIZKcRXHlSMUh1bC0AaiUzLA==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction sources a single byte from <code>rs2</code> according to <code>bs</code>.
To this it applies the forward AES SBox operation, and a partial forward
MixColumn, before XOR&#8217;ing the result with <code>rs1</code>.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES32ESMI (bs,rs2,rs1,rd)) = {
  let shamt   : bits( 5) = bs @ 0b000; /* shamt = bs*8 */
  let si      : bits( 8) = (X(rs2)[31..0] &gt;&gt; shamt)[7..0]; /* SBox Input */
  let so      : bits( 8) = aes_sbox_fwd(si);
  let mixed   : bits(32) = aes_mixcolumn_byte_fwd(so);
  let result  : bits(32) = X(rs1)[31..0] ^ rol32(mixed, unsigned(shamt));
  X(rd) = EXTS(result); RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkne">Zkne</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes64ds"><a class="anchor" href="#insns-aes64ds"></a>aes64ds</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AES final round decryption instruction for RV64.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes64ds rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGGYghA2QjU8thYAPG8zEg==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>Uses the two 64-bit source registers to represent the entire AES state,
and produces <em>half</em> of the next round output, applying the Inverse ShiftRows
and SubBytes steps.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Note To Software Developers</div>
<div class="paragraph">
<p>The following code snippet shows the final round of the AES block decryption.
<code>t0</code> and <code>t1</code> hold the current round state.
<code>t2</code> and <code>t3</code> hold the next round state.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aes64ds t2, t0, t1
aes64ds t3, t1, t0</pre>
</div>
</div>
<div class="paragraph">
<p>Note the reversed register order of the second instruction.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES64DS(rs2, rs1, rd)) = {
  let sr : bits(64) = aes_rv64_shiftrows_inv(X(rs2)[63..0], X(rs1)[63..0]);
  let wd : bits(64) = sr[63..0];
  X(rd) = aes_apply_inv_sbox_to_each_byte(wd);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknd">Zknd</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes64dsm"><a class="anchor" href="#insns-aes64dsm"></a>aes64dsm</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AES middle round decryption instruction for RV64.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes64dsm rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGGYhhA2QjU8thYAPKczFA==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>Uses the two 64-bit source registers to represent the entire AES state,
and produces <em>half</em> of the next round output, applying the Inverse ShiftRows,
SubBytes and MixColumns steps.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Note To Software Developers</div>
<div class="paragraph">
<p>The following code snippet shows one middle round of the AES block decryption.
<code>t0</code> and <code>t1</code> hold the current round state.
<code>t2</code> and <code>t3</code> hold the next round state.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aes64dsm t2, t0, t1
aes64dsm t3, t1, t0</pre>
</div>
</div>
<div class="paragraph">
<p>Note the reversed register order of the second instruction.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES64DSM(rs2, rs1, rd)) = {
  let sr : bits(64) = aes_rv64_shiftrows_inv(X(rs2)[63..0], X(rs1)[63..0]);
  let wd : bits(64) = sr[63..0];
  let sb : bits(64) = aes_apply_inv_sbox_to_each_byte(wd);
  X(rd)  = aes_mixcolumn_inv(sb[63..32]) @ aes_mixcolumn_inv(sb[31..0]);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknd">Zknd</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes64es"><a class="anchor" href="#insns-aes64es"></a>aes64es</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AES final round encryption instruction for RV64.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes64es rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGFoiRA2QjU8thYAN7sy5w==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>Uses the two 64-bit source registers to represent the entire AES state,
and produces <em>half</em> of the next round output, applying the ShiftRows and
SubBytes steps.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Note To Software Developers</div>
<div class="paragraph">
<p>The following code snippet shows the final round of the AES block encryption.
<code>t0</code> and <code>t1</code> hold the current round state.
<code>t2</code> and <code>t3</code> hold the next round state.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aes64es t2, t0, t1
aes64es t3, t1, t0</pre>
</div>
</div>
<div class="paragraph">
<p>Note the reversed register order of the second instruction.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES64ES(rs2, rs1, rd)) = {
  let sr : bits(64) = aes_rv64_shiftrows_fwd(X(rs2)[63..0], X(rs1)[63..0]);
  let wd : bits(64) = sr[63..0];
  X(rd) = aes_apply_fwd_sbox_to_each_byte(wd);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkne">Zkne</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes64esm"><a class="anchor" href="#insns-aes64esm"></a>aes64esm</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AES middle round encryption instruction for RV64.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes64esm rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGGYhBA2QjU8thYAPDczEA==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>Uses the two 64-bit source registers to represent the entire AES state,
and produces <em>half</em> of the next round output, applying the ShiftRows,
SubBytes and MixColumns steps.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Note To Software Developers</div>
<div class="paragraph">
<p>The following code snippet shows one middle round of the AES block encryption.
<code>t0</code> and <code>t1</code> hold the current round state.
<code>t2</code> and <code>t3</code> hold the next round state.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aes64esm t2, t0, t1
aes64esm t3, t1, t0</pre>
</div>
</div>
<div class="paragraph">
<p>Note the reversed register order of the second instruction.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES64ESM(rs2, rs1, rd)) = {
  let sr : bits(64) = aes_rv64_shiftrows_fwd(X(rs2)[63..0], X(rs1)[63..0]);
  let wd : bits(64) = sr[63..0];
  let sb : bits(64) = aes_apply_fwd_sbox_to_each_byte(wd);
  X(rd)  =  aes_mixcolumn_fwd(sb[63..32]) @ aes_mixcolumn_fwd(sb[31..0]);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkne">Zkne</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes64im"><a class="anchor" href="#insns-aes64im"></a>aes64im</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>This instruction accelerates the inverse MixColumns step of the AES
Block Cipher, and is used to aid creation of the decryption KeySchedule.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes64im rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYYBV1NACIWyEqji2FgDTRjJY" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>The instruction applies the inverse MixColumns
transformation to two columns of the state array, packed into a single
64-bit register.
It is used to create the inverse cipher KeySchedule, according to
the equivalent inverse cipher construction in
cite:[nist:fips:197] (Page 23, Section 5.3.5).
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES64IM(rs1, rd)) = {
  let w0 : bits(32) = aes_mixcolumn_inv(X(rs1)[31.. 0]);
  let w1 : bits(32) = aes_mixcolumn_inv(X(rs1)[63..32]);
  X(rd)  = w1 @ w0;
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknd">Zknd</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes64ks1i"><a class="anchor" href="#insns-aes64ks1i"></a>aes64ks1i</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>This instruction implements part of the KeySchedule operation for the
AES Block cipher involving the SBox operation.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes64ks1i rd, rs1, rnum</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNkRSbYIQzyvNRZIwxG8MUNQCIWwEFwaKxdYCAMWuOXI=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction implements the rotation, SubBytes and Round Constant
addition steps of the AES block cipher Key Schedule.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.
Note that <code>rnum</code> must be in the range <code>0x0..0xA</code>.
The values <code>0xB..0xF</code> are reserved.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES64KS1I(rnum, rs1, rd)) = {
  if(unsigned(rnum) &gt; 10) then {
    handle_illegal();  RETIRE_SUCCESS
  } else {
    let tmp1 : bits(32) = X(rs1)[63..32];
    let rc   : bits(32) = aes_decode_rcon(rnum); /* round number -&gt; round constant */
    let tmp2 : bits(32) = if (rnum ==0xA) then tmp1 else ror32(tmp1, 8);
    let tmp3 : bits(32) = aes_subword_fwd(tmp2);
    let result : bits(64) = (tmp3 ^ rc) @ (tmp3 ^ rc);
    X(rd) = EXTZ(result);
    RETIRE_SUCCESS
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkne">Zkne</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknd">Zknd</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-aes64ks2"><a class="anchor" href="#insns-aes64ks2"></a>aes64ks2</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>This instruction implements part of the KeySchedule operation for the
AES Block cipher.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>aes64ks2 rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGGYhhA2QhIGisbWAgA8rTMV" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction implements the additional XOR&#8217;ing of key words as
part of the AES block cipher Key Schedule.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (AES64KS2(rs2, rs1, rd)) = {
  let w0 : bits(32) = X(rs1)[63..32] ^ X(rs2)[31..0];
  let w1 : bits(32) = X(rs1)[63..32] ^ X(rs2)[31..0] ^ X(rs2)[63..32];
  X(rd)  = w1 @ w0;
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkne">Zkne</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknd">Zknd</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-andn-sc"><a class="anchor" href="#insns-andn-sc"></a>andn</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>AND with inverted operand</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>andn <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpjYx2FxJKSIiuFaHX_APVYhVodVLWmMLXqRSnqGLLGCJPMEQY5-rn4qcfiManYUB2fRcVGmNJIbjYyQLcKpDq2FgDwqj6T" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs the bitwise logical AND operation between <em>rs1</em> and the bitwise inversion of <em>rs2</em>.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">X(rd) = X(rs1) &amp; ~X(rs2);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-brev8-sc"><a class="anchor" href="#insns-brev8-sc"></a>brev8</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Reverse the bits in each byte of a source register.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>brev8 <em>rd</em>, <em>rs</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpDYx2FxJKSIiuFaHX_AF1PX1_1WIVaHVT1pjD16kUp6hiyxgjTTPFpLcbQamiE0GpmYa5QyxVbCwA9bi6m" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction reverses the order of the bits in every byte of a register.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">result : xlenbits = EXTZ(0b0);
foreach (i from 0 to sizeof(xlen) by 8) {
    result[i+7..i] = reverse_bits_in_byte(X(rs1)[i+7..i]);
};
X(rd) = result;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-clmul-sc"><a class="anchor" href="#insns-clmul-sc"></a>clmul</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Carry-less multiply (low-part)</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>clmul <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpjYx2FxJKSIiuFaHX_APVYhVodVLWmMLXqRSnqGLLGCJMMEQY5-_iG-uA3q9hQHa-0EaY0kqtNEXb5evr5OkboI1kZWwsALVtBMQ==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>clmul produces the lower half of the 2Â·XLEN carry-less product.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let rs1_val = X(rs1);
let rs2_val = X(rs2);
let output : xlenbits = 0;

foreach (i from 0 to (xlen - 1) by 1) {
   output = if   ((rs2_val &gt;&gt; i) &amp; 1)
            then output ^ (rs1_val &lt;&lt; i);
            else output;
}

X[rd] = output</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbc (<a href="#zbc">[zbc]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkc (<a href="#zbkc-sc">Zbkc-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-clmulh-sc"><a class="anchor" href="#insns-clmulh-sc"></a>clmulh</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Carry-less multiply (high-part)</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>clmulh <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpjYx2FxJKSIiuFaHX_APVYhVodVLWmMLXqRSnqGLLGSCYhDHL28Q318cBvWLGhOl5pI0xpJGebIizz9fTzdYzQB9sJsTK2FgByDEF7" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>clmulh produces the upper half of the 2Â·XLEN carry-less product.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let rs1_val = X(rs1);
let rs2_val = X(rs2);
let output : xlenbits = 0;

foreach (i from 1 to xlen by 1) {
   output = if   ((rs2_val &gt;&gt; i) &amp; 1)
            then output ^ (rs1_val &gt;&gt; (xlen - i));
            else output;
}

X[rd] = output</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbc (<a href="#zbc">[zbc]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkc (<a href="#zbkc-sc">Zbkc-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-orn-sc"><a class="anchor" href="#insns-orn-sc"></a>orn</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>OR with inverted operand</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>orn <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpjYx2FxJKSIiuFaHX_APVYhVodVLWmMLXqRSnqGLLGCJPMkAwK8lOPxWNQsaE6PnuKjTClkZxsZIBmE0hxbC0AfAk-Lg==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs the bitwise logical OR operation between <em>rs1</em> and the bitwise inversion of <em>rs2</em>.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">X(rd) = X(rs1) | ~X(rs2);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-pack-sc"><a class="anchor" href="#insns-pack-sc"></a>pack</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Pack the low halves of <em>rs1</em> and <em>rs2</em> into <em>rd</em>.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>pack <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCC6qTMkmIrBQVzHYW8xNxUKwWDCmNjHYXEkpIiK4Vodf8A9ViFWh1kpaYwlepFKeqoUsYIQ0ygZkSrBzg6e6vH4jSj2FAdt5wRmpw5XgtiawGQOzw-" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>The pack instruction packs the XLEN/2-bit lower halves of <em>rs1</em> and <em>rs2</em> into
<em>rd</em>, with <em>rs1</em> in the lower half and <em>rs2</em> in the upper half.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let lo_half : bits(xlen/2) = X(rs1)[xlen/2-1..0];
let hi_half : bits(xlen/2) = X(rs2)[xlen/2-1..0];
X(rd) = EXTZ(hi_half @ lo_half);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-packh-sc"><a class="anchor" href="#insns-packh-sc"></a>packh</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Pack the low bytes of <em>rs1</em> and <em>rs2</em> into <em>rd</em>.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>packh <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCC6qTMkmIrBQVzHYW8xNxUKwWDCmNjHYXEkpIiK4Vodf8A9ViFWh1kpaYwlepFKeqoUsYIQ8wRZgQ4Ont7qMfiNKXYUB23nBGaHJI7TbBZEVsLAHJEPRE=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>And the packh instruction packs the least-significant bytes of
<em>rs1</em> and <em>rs2</em> into the 16 least-significant bits of <em>rd</em>,
zero extending the rest of <em>rd</em>.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let lo_half : bits(8) = X(rs1)[7..0];
let hi_half : bits(8) = X(rs2)[7..0];
X(rd) = EXTZ(hi_half @ lo_half);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-packw-sc"><a class="anchor" href="#insns-packw-sc"></a>packw</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Pack the low 16-bits of <em>rs1</em> and <em>rs2</em> into <em>rd</em> on RV64.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>packw <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDSUchLzE21UjCoMK7VgYmaIkRTsYiqF6WoI4SNEYpNsCouNlTHLm6EJG6OakpsLQD79DK3" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction packs the low 16 bits of
<em>rs1</em> and <em>rs2</em> into the 32 least-significant bits of <em>rd</em>,
sign extending the 32-bit result to the rest of <em>rd</em>.
This instruction only exists on RV64 based systems.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let lo_half : bits(16) = X(rs1)[15..0];
let hi_half : bits(16) = X(rs2)[15..0];
X(rd) = EXTS(hi_half @ lo_half);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-rev8-sc"><a class="anchor" href="#insns-rev8-sc"></a>rev8</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Byte-reverse register</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>rev8 <em>rd</em>, <em>rs</em></p>
</dd>
<dt class="hdlist1">Encoding (RV32)</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpDYx2FxJKSIiuFaHX_AF1PX1_1WIVaHVT1pjD16kUp6hiyxgjTTPFpLcbQamiE0GpmaaFQyxVbCwA9ey6o" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Encoding (RV64)</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpDYx2FxJKSIiuFaHX_AF1PX1_1WIVaHVT1pjD16kUp6hiyxgjTTPFpLcbQamiE0GqWZKFQyxVbCwA-mi7R" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction reverses the order of the bytes in <em>rs</em>.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let input = X(rs);
let output : xlenbits = 0;
let j = xlen - 1;

foreach (i from 0 to (xlen - 8) by 8) {
   output[i..(i + 7)] = input[(j - 7)..j];
   j = j - 8;
}

X[rd] = output</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="A"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The <strong>rev8</strong> mnemonic corresponds to different instruction encodings in RV32 and RV64.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Software Hint</div>
<div class="paragraph">
<p>The byte-reverse operation is only available for the full register
width.  To emulate word-sized and halfword-sized byte-reversal,
perform a <code>rev8 rd,rs</code> followed by a <code>srai rd,rd,K</code>, where K is
XLEN-32 and XLEN-16, respectively.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-rol-sc"><a class="anchor" href="#insns-rol-sc"></a>rol</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Rotate Left (Register)</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>rol <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpjYx2FxJKSIiuFaHX_APVYhVodVLWmMLXqRSnqGLLGCJMMEQYF-fuox-IxqNhQHZ89xUaY0shONkCzCaQ4thYAeK4-Jg==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs a rotate left of <em>rs1</em> by the amount in least-significant log2(XLEN) bits of <em>rs2</em>.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let shamt = if   xlen == 32
            then X(rs2)[4..0]
            else X(rs2)[5..0];
let result = (X(rs1) &lt;&lt; shamt) | (X(rs1) &gt;&gt; (xlen - shamt));

X(rd) = result;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-rolw-sc"><a class="anchor" href="#insns-rolw-sc"></a>rolw</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Rotate Left Word (Register)</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>rolw <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwrjJB2FxJKSIiuFaHX_AF1jI_VYhVodVOWmMOXqRSnqGLLGCMMMEWYF-fuEq8fiManYUB2fRcVGmNLIzjZAtwqkOrYWALitP5U=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs a rotate left on the least-significant word of  <em>rs1</em> by the amount in least-significant 5 bits of <em>rs2</em>.
The resulting word value is sign-extended by copying bit 31 to all of the more-significant bits.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let rs1 = EXTZ(X(rs1)[31..0])
let shamt = X(rs2)[4..0];
let result = (rs1 &lt;&lt; shamt) | (rs1 &gt;&gt; (32 - shamt));
X(rd) = EXTS(result[31..0]);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-ror-sc"><a class="anchor" href="#insns-ror-sc"></a>ror</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Rotate Right</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>ror <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpjYx2FxJKSIiuFaHX_APVYhVodVLWmMLXqRSnqGLLGCJNMEQYF-Qepx-IxqNhQHZ89xUaY0shONkCzCaQ4thYAfZY-Ng==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs a rotate right of <em>rs1</em> by the amount in least-significant log2(XLEN) bits of <em>rs2</em>.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let shamt = if   xlen == 32
            then X(rs2)[4..0]
            else X(rs2)[5..0];
let result = (X(rs1) &gt;&gt; shamt) | (X(rs1) &lt;&lt; (xlen - shamt));

X(rd) = result;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-rori-sc"><a class="anchor" href="#insns-rori-sc"></a>rori</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Rotate Right (Immediate)</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>rori <em>rd</em>, <em>rs1</em>, <em>shamt</em></p>
</dd>
<dt class="hdlist1">Encoding (RV32)</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpDYx2FxJKSIiuFaHX_AF1PX1_1WIVaHVT1pjD16kUp6hiyxgjTTBGGBfkHearH4jGp2FAdj0XFGYm5JZgKkFxubIBuGUh1bC0AlmlA3A==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Encoding (RV64)</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpDYx2FxJKSIiuFaHX_AF1PX1_1WIVaHVT1pjD16kUp6hiyxgjTTBGGBfkHearH4jGp2BDTKDO4dHFGYm4JHgVAl1ugWwZSHVsLAJcSQOI=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs a rotate right of <em>rs1</em> by the amount in the least-significant log2(XLEN) bits of <em>shamt</em>.
For RV32, the encodings corresponding to shamt[5]=1 are reserved.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let shamt = if   xlen == 32
            then shamt[4..0]
            else shamt[5..0];
let result = (X(rs1) &gt;&gt; shamt) | (X(rs1) &lt;&lt; (xlen - shamt));

X(rd) = result;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-roriw-sc"><a class="anchor" href="#insns-roriw-sc"></a>roriw</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Rotate Right Word by Immediate</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>roriw <em>rd</em>, <em>rs1</em>, <em>shamt</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwrDJB2FxJKSIiuFaHX_AF1PX19dYyP1WIVaHVQtpjAt6kUp6hiyxggDTRHmBfkHeYarx-IxqthQHY9NxRmJuSWYCpBcb2yAYRtIeWwtAOJuQks=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs a rotate right on the least-significant word
of <em>rs1</em> by the amount in the least-significant log2(XLEN) bits of
<em>shamt</em>.
The resulting word value is sign-extended by copying bit 31 to all of
the more-significant bits.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let rs1_data = EXTZ(X(rs1)[31..0];
let result = (rs1_data &gt;&gt; shamt) | (rs1_data &lt;&lt; (32 - shamt));
X(rd) = EXTS(result[31..0]);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-rorw-sc"><a class="anchor" href="#insns-rorw-sc"></a>rorw</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Rotate Right Word (Register)</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>rorw <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwrjJB2FxJKSIiuFaHX_AF1jI_VYhVodVOWmMOXqRSnqGLLGCMNMEWYF-QeFq8fiManYUB2fRcVGmNLIzjZAtwqkOrYWAL2vP6U=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs a rotate right on the least-significant word of  <em>rs1</em> by the amount in least-significant 5 bits of <em>rs2</em>.
The resultant word is sign-extended by copying bit 31 to all of the more-significant bits.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">let rs1 = EXTZ(X(rs1)[31..0])
let shamt = X(rs2)[4..0];
let result = (rs1 &gt;&gt; shamt) | (rs1 &lt;&lt; (32 - shamt));
X(rd) = EXTS(result);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha256sig0"><a class="anchor" href="#insns-sha256sig0"></a>sha256sig0</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sigma0 transformation function as used in
the SHA2-256 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha256sig0 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYYRV1AIhaoQQNQCKxtYCAKRGMik=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for both RV32 and RV64 base architectures.
For RV32, the entire <code>XLEN</code> source register is operated on.
For RV64, the low <code>32</code> bits of the source register are operated on, and the
result sign extended to <code>XLEN</code> bits.
Though named for SHA2-256, the instruction works for both the
SHA2-224 and SHA2-256 parameterizations as described in
cite:[nist:fips:180:4].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA256SIG0(rs1,rd)) = {
  let inb    : bits(32) = X(rs1)[31..0];
  let result : bits(32) = ror32(inb,  7) ^ ror32(inb, 18) ^ (inb &gt;&gt;  3);
  X(rd)      = EXTS(result);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha256sig1"><a class="anchor" href="#insns-sha256sig1"></a>sha256sig1</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sigma1 transformation function as used in
the SHA2-256 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha256sig1 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYYxV1AIhaoQQNQCKxtYCAKR4Mio=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for both RV32 and RV64 base architectures.
For RV32, the entire <code>XLEN</code> source register is operated on.
For RV64, the low <code>32</code> bits of the source register are operated on, and the
result sign extended to <code>XLEN</code> bits.
Though named for SHA2-256, the instruction works for both the
SHA2-224 and SHA2-256 parameterizations as described in
cite:[nist:fips:180:4].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA256SIG1(rs1,rd)) = {
  let inb    : bits(32) = X(rs1)[31..0];
  let result : bits(32) = ror32(inb, 17) ^ ror32(inb, 19) ^ (inb &gt;&gt; 10);
  X(rd)      = EXTS(result);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha256sum0"><a class="anchor" href="#insns-sha256sum0"></a>sha256sum0</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sum0 transformation function as used in
the SHA2-256 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha256sum0 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYYBV1AIhaoSqNrYWAKPiMic=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for both RV32 and RV64 base architectures.
For RV32, the entire <code>XLEN</code> source register is operated on.
For RV64, the low <code>32</code> bits of the source register are operated on, and the
result sign extended to <code>XLEN</code> bits.
Though named for SHA2-256, the instruction works for both the
SHA2-224 and SHA2-256 parameterizations as described in
cite:[nist:fips:180:4].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA256SUM0(rs1,rd)) = {
  let inb    : bits(32) = X(rs1)[31..0];
  let result : bits(32) = ror32(inb,  2) ^ ror32(inb, 13) ^ ror32(inb, 22);
  X(rd)      = EXTS(result);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha256sum1"><a class="anchor" href="#insns-sha256sum1"></a>sha256sum1</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sum1 transformation function as used in
the SHA2-256 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha256sum1 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIo5dtUGFBULUCCFqABSNrQUApBQyKA==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for both RV32 and RV64 base architectures.
For RV32, the entire <code>XLEN</code> source register is operated on.
For RV64, the low <code>32</code> bits of the source register are operated on, and the
result sign extended to <code>XLEN</code> bits.
Though named for SHA2-256, the instruction works for both the
SHA2-224 and SHA2-256 parameterizations as described in
cite:[nist:fips:180:4].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA256SUM1(rs1,rd)) = {
  let inb    : bits(32) = X(rs1)[31..0];
  let result : bits(32) = ror32(inb,  6) ^ ror32(inb, 11) ^ ror32(inb, 25);
  X(rd)      = EXTS(result);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sig0h"><a class="anchor" href="#insns-sha512sig0h"></a>sha512sig0h</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the <em>high half</em> of the Sigma0 transformation, as
used in the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sig0h rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUJGKEDVCiBoCRWNrAQyfMuM=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is implemented on RV32 only.
Used to compute the Sigma0 transform of the SHA2-512 hash function
in conjunction with the <a href="#insns-sha512sig0l"><code>sha512sig0l</code></a> instruction.
The transform is a 64-bit to 64-bit function, so the input and output
are each represented by two 32-bit registers.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note to software developers</div>
<div class="paragraph">
<p>The entire Sigma0 transform for SHA2-512 may be computed on RV32
using the following instruction sequence:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sha512sig0l    t0, a0, a1
sha512sig0h    t1, a1, a0</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SIG0H(rs2, rs1, rd)) = {
  X(rd) = EXTS((X(rs1) &gt;&gt;  1) ^ (X(rs1) &gt;&gt;  7) ^ (X(rs1) &gt;&gt;  8) ^
               (X(rs2) &lt;&lt; 31)                  ^ (X(rs2) &lt;&lt; 24) );
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sig0l"><a class="anchor" href="#insns-sha512sig0l"></a>sha512sig0l</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the <em>low half</em> of the Sigma0 transformation, as
used in the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sig0l rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUJGIEDVCiBoCRWNrAQwvMt8=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is implemented on RV32 only.
Used to compute the Sigma0 transform of the SHA2-512 hash function
in conjunction with the <a href="#insns-sha512sig0h"><code>sha512sig0h</code></a> instruction.
The transform is a 64-bit to 64-bit function, so the input and output
are each represented by two 32-bit registers.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note to software developers</div>
<div class="paragraph">
<p>The entire Sigma0 transform for SHA2-512 may be computed on RV32
using the following instruction sequence:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sha512sig0l    t0, a0, a1
sha512sig0h    t1, a1, a0</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SIG0L(rs2, rs1, rd)) = {
  X(rd) = EXTS((X(rs1) &gt;&gt;  1) ^ (X(rs1) &gt;&gt;  7) ^ (X(rs1) &gt;&gt;  8) ^
               (X(rs2) &lt;&lt; 31) ^ (X(rs2) &lt;&lt; 25) ^ (X(rs2) &lt;&lt; 24) );
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sig1h"><a class="anchor" href="#insns-sha512sig1h"></a>sha512sig1h</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the <em>high half</em> of the Sigma1 transformation, as
used in the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sig1h rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUJGGEDVCiBoCRWNrAQy7MuQ=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is implemented on RV32 only.
Used to compute the Sigma1 transform of the SHA2-512 hash function
in conjunction with the <a href="#insns-sha512sig1l"><code>sha512sig1l</code></a> instruction.
The transform is a 64-bit to 64-bit function, so the input and output
are each represented by two 32-bit registers.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note to software developers</div>
<div class="paragraph">
<p>The entire Sigma1 transform for SHA2-512 may be computed on RV32
using the following instruction sequence:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sha512sig1l    t0, a0, a1
sha512sig1h    t1, a1, a0</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SIG1H(rs2, rs1, rd)) = {
  X(rd) = EXTS((X(rs1) &lt;&lt;  3) ^ (X(rs1) &gt;&gt;  6) ^ (X(rs1) &gt;&gt; 19) ^
               (X(rs2) &gt;&gt; 29)                  ^ (X(rs2) &lt;&lt; 13) );
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sig1l"><a class="anchor" href="#insns-sha512sig1l"></a>sha512sig1l</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the <em>low half</em> of the Sigma1 transformation, as
used in the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sig1l rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUJGEEDVCiBoCRWNrAQxLMuA=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is implemented on RV32 only.
Used to compute the Sigma1 transform of the SHA2-512 hash function
in conjunction with the <a href="#insns-sha512sig1h"><code>sha512sig1h</code></a> instruction.
The transform is a 64-bit to 64-bit function, so the input and output
are each represented by two 32-bit registers.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note to software developers</div>
<div class="paragraph">
<p>The entire Sigma1 transform for SHA2-512 may be computed on RV32
using the following instruction sequence:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sha512sig1l    t0, a0, a1
sha512sig1h    t1, a1, a0</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SIG1L(rs2, rs1, rd)) = {
  X(rd) = EXTS((X(rs1) &lt;&lt;  3) ^ (X(rs1) &gt;&gt;  6) ^ (X(rs1) &gt;&gt; 19) ^
               (X(rs2) &gt;&gt; 29) ^ (X(rs2) &lt;&lt; 26) ^ (X(rs2) &lt;&lt; 13) );
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sum0r"><a class="anchor" href="#insns-sha512sum0r"></a>sha512sum0r</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sum0 transformation, as
used in the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sum0r rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGGBEDVCiBoCRWNrAQezMrY=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is implemented on RV32 only.
Used to compute the Sum0 transform of the SHA2-512 hash function.
The transform is a 64-bit to 64-bit function, so the input and output
is represented by two 32-bit registers.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note to software developers</div>
<div class="paragraph">
<p>The entire Sum0 transform for SHA2-512 may be computed on RV32
using the following instruction sequence:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sha512sum0r    t0, a0, a1
sha512sum0r    t1, a1, a0</pre>
</div>
</div>
<div class="paragraph">
<p>Note the reversed source register ordering.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SUM0R(rs2, rs1, rd)) = {
  X(rd) = EXTS((X(rs1) &lt;&lt; 25) ^ (X(rs1) &lt;&lt; 30) ^ (X(rs1) &gt;&gt; 28) ^
               (X(rs2) &gt;&gt;  7) ^ (X(rs2) &gt;&gt;  2) ^ (X(rs2) &lt;&lt;  4) );
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sum1r"><a class="anchor" href="#insns-sha512sum1r"></a>sha512sum1r</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sum1 transformation, as
used in the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sum1r rd, rs1, rs2</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGGJEDVCiBoCRWNrAQfPMrc=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is implemented on RV32 only.
Used to compute the Sum1 transform of the SHA2-512 hash function.
The transform is a 64-bit to 64-bit function, so the input and output
is represented by two 32-bit registers.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note to software developers</div>
<div class="paragraph">
<p>The entire Sum1 transform for SHA2-512 may be computed on RV32
using the following instruction sequence:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sha512sum1r    t0, a0, a1
sha512sum1r    t1, a1, a0</pre>
</div>
</div>
<div class="paragraph">
<p>Note the reversed source register ordering.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SUM1R(rs2, rs1, rd)) = {
  X(rd) = EXTS((X(rs1) &lt;&lt; 23) ^ (X(rs1) &gt;&gt; 14) ^ (X(rs1) &gt;&gt; 18) ^
               (X(rs2) &gt;&gt;  9) ^ (X(rs2) &lt;&lt; 18) ^ (X(rs2) &lt;&lt; 14) );
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sig0"><a class="anchor" href="#insns-sha512sig0"></a>sha512sig0</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sigma0 transformation function as used in
the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sig0 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYYZV1AIhaoQQNQCKxtYCAKUOMi0=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for the RV64 base architecture.
It implements the Sigma0 transform of the SHA2-512 hash function.
cite:[nist:fips:180:4].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SIG0(rs1, rd)) = {
  X(rd) = ror64(X(rs1),  1) ^ ror64(X(rs1),  8) ^ (X(rs1) &gt;&gt; 7);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sig1"><a class="anchor" href="#insns-sha512sig1"></a>sha512sig1</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sigma1 transformation function as used in
the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sig1 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYY5V1AIhaoQQNQCKxtYCAKVAMi4=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for the RV64 base architecture.
It implements the Sigma1 transform of the SHA2-512 hash function.
cite:[nist:fips:180:4].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SIG1(rs1, rd)) = {
  X(rd) = ror64(X(rs1), 19) ^ ror64(X(rs1), 61) ^ (X(rs1) &gt;&gt; 6);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sum0"><a class="anchor" href="#insns-sha512sum0"></a>sha512sum0</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sum0 transformation function as used in
the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sum0 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYYJV1AIhaoQQNQCKxtYCAKSqMis=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for the RV64 base architecture.
It implements the Sum0 transform of the SHA2-512 hash function.
cite:[nist:fips:180:4].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SUM0(rs1, rd)) = {
  X(rd) = ror64(X(rs1), 28) ^ ror64(X(rs1), 34) ^ ror64(X(rs1) ,39);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sha512sum1"><a class="anchor" href="#insns-sha512sum1"></a>sha512sum1</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the Sum1 transformation function as used in
the SHA2-512 hash function cite:[nist:fips:180:4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sha512sum1 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYYpV1AIhaoQQNQCKxtYCAKTcMiw=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for the RV64 base architecture.
It implements the Sum1 transform of the SHA2-512 hash function.
cite:[nist:fips:180:4].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SHA512SUM1(rs1, rd)) = {
  X(rd) = ror64(X(rs1), 14) ^ ror64(X(rs1), 18) ^ ror64(X(rs1) ,41);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zknh">Zknh</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zkn">Zkn</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zk">Zk</a> (RV64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sm3p0"><a class="anchor" href="#insns-sm3p0"></a>sm3p0</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the <em>P0</em> transformation function as used in
the SM3 hash function cite:[gbt:sm3,iso:sm3].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sm3p0 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYUFI1AghagAUja0FAKVyMi8=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for the RV32 and RV64 base architectures.
It implements the <em>P0</em> transform of the SM3 hash function cite:[gbt:sm3,iso:sm3].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Supporting Material</div>
<div class="paragraph">
<p>This instruction is based on work done in cite:[MJS:LWSHA:20].</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SM3P0(rs1, rd)) = {
  let r1     : bits(32) = X(rs1)[31..0];
  let result : bits(32) =  r1 ^ rol32(r1,  9) ^ rol32(r1, 17);
  X(rd) = EXTS(result);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zksh">Zksh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zks">Zks</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sm3p1"><a class="anchor" href="#insns-sm3p1"></a>sm3p1</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Implements the <em>P1</em> transformation function as used in
the SM3 hash function cite:[gbt:sm3,iso:sm3].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sm3p1 rd, rs1</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDSu1YEJm8KE1YtS1BHCxkiqsSouNlTHIm5QYYlV1AIhaoQQNQCKxtYCAKWkMjA=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction is supported for the RV32 and RV64 base architectures.
It implements the <em>P1</em> transform of the SM3 hash function cite:[gbt:sm3,iso:sm3].
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Supporting Material</div>
<div class="paragraph">
<p>This instruction is based on work done in cite:[MJS:LWSHA:20].</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SM3P1(rs1, rd)) = {
  let r1     : bits(32) = X(rs1)[31..0];
  let result : bits(32) =  r1 ^ rol32(r1, 15) ^ rol32(r1, 23);
  X(rd) = EXTS(result);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zksh">Zksh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zks">Zks</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sm4ed"><a class="anchor" href="#insns-sm4ed"></a>sm4ed</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Accelerates the block encrypt/decrypt operation of the SM4 block cipher
cite:[gbt:sm4, iso:sm4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sm4ed rd, rs1, rs2, bs</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGFogRA2gitPKgapjq0FAGq2MzE=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>Implements a T-tables in hardware style approach to accelerating the
SM4 round function.
A byte is extracted from <code>rs2</code> based on <code>bs</code>, to which the SBox and
linear layer transforms are applied, before the result is XOR&#8217;d with
<code>rs1</code> and written back to <code>rd</code>.
This instruction exists on RV32 and RV64 base architectures.
On RV64, the 32-bit result is sign extended to XLEN bits.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SM4ED (bs,rs2,rs1,rd)) = {
  let shamt : bits(5)  = bs @ 0b000; /* shamt = bs*8 */
  let sb_in : bits(8)  = (X(rs2)[31..0] &gt;&gt; shamt)[7..0];
  let x     : bits(32) = 0x000000 @ sm4_sbox(sb_in);
  let y     : bits(32) = x ^ (x               &lt;&lt;  8) ^ ( x               &lt;&lt;  2) ^
                             (x               &lt;&lt; 18) ^ ((x &amp; 0x0000003F) &lt;&lt; 26) ^
                             ((x &amp; 0x000000C0) &lt;&lt; 10);
  let z     : bits(32) = rol32(y, unsigned(shamt));
  let result: bits(32) = z ^ X(rs1)[31..0];
  X(rd)                = EXTS(result);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zksed">Zksed</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zks">Zks</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-sm4ks"><a class="anchor" href="#insns-sm4ks"></a>sm4ks</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Accelerates the Key Schedule operation of the SM4 block cipher
cite:[gbt:sm4, iso:sm4].</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>sm4ks rd, rs1, rs2, bs</p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDau1YEJm8KE1YtS1BHCxgjVBlgVFxuqYxc3wiZuUGGYiBA2gitPKgapjq0FAG9bM1o=" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>Implements a T-tables in hardware style approach to accelerating the
SM4 Key Schedule.
A byte is extracted from <code>rs2</code> based on <code>bs</code>, to which the SBox and
linear layer transforms are applied, before the result is XOR&#8217;d with
<code>rs1</code> and written back to <code>rd</code>.
This instruction exists on RV32 and RV64 base architectures.
On RV64, the 32-bit result is sign extended to XLEN bits.
This instruction must <em>always</em> be implemented such that its execution
latency does not depend on the data being operated on.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">function clause execute (SM4KS (bs,rs2,rs1,rd)) = {
  let shamt : bits(5)  = (bs @ 0b000); /* shamt = bs*8 */
  let sb_in : bits(8)  = (X(rs2)[31..0] &gt;&gt; shamt)[7..0];
  let x     : bits(32) = 0x000000 @ sm4_sbox(sb_in);
  let y     : bits(32) = x ^ ((x &amp; 0x00000007) &lt;&lt; 29) ^ ((x &amp; 0x000000FE) &lt;&lt;  7) ^
                             ((x &amp; 0x00000001) &lt;&lt; 23) ^ ((x &amp; 0x000000F8) &lt;&lt; 13) ;
  let z     : bits(32) = rol32(y, unsigned(shamt));
  let result: bits(32) = z ^ X(rs1)[31..0];
  X(rd) = EXTS(result);
  RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zksed">Zksed</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#zks">Zks</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-unzip-sc"><a class="anchor" href="#insns-unzip-sc"></a>unzip</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Place odd and even bits of the source register into upper and lower halves of
the destination register, respectively.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>unzip <em>rd</em>, <em>rs</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDSUchLzE21UjCoMK7VgYmaIkRNsIiqF6WoI4SNEYpNsSouNlTHanQaQtQc1cLYWgCHXzIw" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction scatters all of the odd and even bits of a source word into
the high and low halves of a destination word.
It is the inverse of the <a href="#insns-zip-sc">zip</a> instruction.
This instruction is available only on RV32.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">foreach (i from 0 to xlen/2-1) {
  X(rd)[i] = X(rs1)[2*i]
  X(rd)[i+xlen/2] = X(rs1)[2*i+1]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Software Hint</div>
<div class="paragraph">
<p>This instruction is useful for implementing the SHA3 cryptographic
hash function on a 32-bit architecture, as it implements the
bit-interleaving operation used to speed up the 64-bit rotations
directly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>) (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-xnor-sc"><a class="anchor" href="#insns-xnor-sc"></a>xnor</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Exclusive NOR</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>xnor <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmUgCCaoWkzJJiKwUFcx2FvMTcVCsFgwpjYx2FxJKSIiuFaHX_APVYhVodVLWmMLXqRSnqGLLGCJNMEAZF-PkHqcfiManYUB2fRcVGmNJIbjYyQLcKpDq2FgACYT7c" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction performs the bit-wise exclusive-NOR operation on <em>rs1</em> and <em>rs2</em>.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">X(rd) = ~(X(rs1) ^ X(rs2));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb (<a href="#zbb">[zbb]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-xperm8-sc"><a class="anchor" href="#insns-xperm8-sc"></a>xperm8</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Byte-wise lookup of indices into a vector in registers.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>xperm8 <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDSUchLzE21UjCoMK7VgYmaIkSTsYiqF6WoI4SNEYpNsCouNlTHLm6EJG6OMMUQZExsLQAtXDLm" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>The xperm8 instruction operates on bytes.
The <em>rs1</em> register contains a vector of XLEN/8 8-bit elements.
The <em>rs2</em> register contains a vector of XLEN/8 8-bit indexes.
The result is each element in <em>rs2</em> replaced by the indexed element in <em>rs1</em>,
or zero if the index into <em>rs2</em> is out of bounds.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">val xperm8_lookup : (bits(8), xlenbits) -&gt; bits(8)
function xperm8_lookup (idx, lut) = {
    (lut &gt;&gt; (idx @ 0b000))[7..0]
}

function clause execute ( XPERM8 (rs2,rs1,rd)) = {
    result : xlenbits = EXTZ(0b0);
    foreach(i from 0 to xlen by 8) {
        result[i+7..i] = xperm8_lookup(X(rs2)[i+7..i], X(rs1));
    };
    X(rd) = result;
    RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkx (<a href="#zbkx">[zbkx]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-xperm4-sc"><a class="anchor" href="#insns-xperm4-sc"></a>xperm4</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Nibble-wise lookup of indices into a vector.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>xperm4 <em>rd</em>, <em>rs1</em>, <em>rs2</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDSUchLzE21UjCoMK7VgYmaIkSTsYiqF6WoI4SNEYqNsCouNlTHLm6EJG6OMMXQBCgcWwsALMIy5A==" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>The xperm4 instruction operates on nibbles.
The <em>rs1</em> register contains a vector of XLEN/4 4-bit elements.
The <em>rs2</em> register contains a vector of XLEN/4 4-bit indexes.
The result is each element in <em>rs2</em> replaced by the indexed element in <em>rs1</em>,
or zero if the index into <em>rs2</em> is out of bounds.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">val xperm4_lookup : (bits(4), xlenbits) -&gt; bits(4)
function xperm4_lookup (idx, lut) = {
    (lut &gt;&gt; (idx @ 0b00))[3..0]
}

function clause execute ( XPERM4 (rs2,rs1,rd)) = {
    result : xlenbits = EXTZ(0b0);
    foreach(i from 0 to xlen by 4) {
        result[i+3..i] = xperm4_lookup(X(rs2)[i+3..i], X(rs1));
    };
    X(rd) = result;
    RETIRE_SUCCESS
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkx (<a href="#zbkx">[zbkx]</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="insns-zip-sc"><a class="anchor" href="#insns-zip-sc"></a>zip</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p>Interleave upper and lower halves of the source register into odd and even
bits of the destination register, respectively.</p>
</dd>
<dt class="hdlist1">Mnemonic</dt>
<dd>
<p>zip <em>rd</em>, <em>rs</em></p>
</dd>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDSUchLzE21UjCoMK7VgYmaIkRNsIiqF6WoI4SNEYoNsSouNlTHanQaQtQc1cLYWgCGNzIs" alt="svg">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Description</dt>
<dd>
<p>This instruction gathers bits from the high and low halves of the source
word into odd/even bit positions in the destination word.
It is the inverse of the <a href="#insns-unzip-sc">unzip</a> instruction.
This instruction is available only on RV32.</p>
</dd>
<dt class="hdlist1">Operation</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">foreach (i from 0 to xlen/2-1) {
  X(rd)[2*i] = X(rs1)[i]
  X(rd)[2*i+1] = X(rs1)[i+xlen/2]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Software Hint</div>
<div class="paragraph">
<p>This instruction is useful for implementing the SHA3 cryptographic
hash function on a 32-bit architecture, as it implements the
bit-interleaving operation used to speed up the 64-bit rotations
directly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included in</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Minimum version</th>
<th class="tableblock halign-left valign-top">Lifecycle state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbkb (<a href="#zbkb-sc">Zbkb-sc</a>) (RV32)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v1.0.0-rc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ratified</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="crypto_scalar_es"><a class="anchor" href="#crypto_scalar_es"></a>Entropy Source</h3>
<div class="paragraph">
<p>The <code>seed</code> CSR provides an interface to a NIST SP 800-90B cite:[TuBaKe:18]
or BSI AIS-31 cite:[KiSc11] compliant physical Entropy Source (ES).</p>
</div>
<div class="paragraph">
<p>An entropy source, by itself, is not a cryptographically secure Random
Bit Generator (RBG), but can be used to build standard (and nonstandard)
RBGs of many types with the help of symmetric cryptography. Expected usage
is to condition (typically with SHA-2/3) the output from an entropy source and
use it to seed a cryptographically secure Deterministic Random Bit Generator
(DRBG) such as AES-based <code>CTR_DRBG</code> cite:[BaKe15].
The combination of an Entropy Source, Conditioning, and a DRBG can be used
to create random bits securely cite:[BaKeRo:21].
See <a href="#crypto_scalar_appx_es">Entropy Source Rationale and Recommendations</a> for a non-normative description of a
certification and self-certification procedures, design rationale, and more
detailed suggestions on how the entropy source output can be used.</p>
</div>
<div class="sect3">
<h4 id="crypto_scalar_seed_csr"><a class="anchor" href="#crypto_scalar_seed_csr"></a>The <code>seed</code> CSR</h4>
<div class="paragraph">
<p><code>seed</code> is an unprivileged CSR located at address <code>0x015</code>.
The 32-bit contents of <code>seed</code> are as follows:</p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:30</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>OPST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status: <code>BIST</code> (00), <code>WAIT</code> (01), <code>ES16</code> (10), <code>DEAD</code>
(11).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>29:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For future use by the RISC-V specification.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>custom</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom and experimental use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15: 0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>entropy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bits of randomness, only when <code>OPST=ES16</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Attempts to access the <code>seed</code> CSR using a read-only CSR-access instruction
(<code>CSRRS</code>/<code>CSRRC</code> with <em>rs1</em>=<code>x0</code> or <code>CSRRSI</code>/<code>CSRRCI</code> with <em>uimm</em>=0) raise an
illegal-instruction exception; any other CSR-access instruction may be used
to access <code>seed</code>.
The write value (in <code>rs1</code> or <code>uimm</code>) must be ignored by implementations.
The purpose of the write is to signal polling and flushing.</p>
</div>
<div class="paragraph">
<p>Software normally uses the instruction <code>csrrw rd, seed, x0</code> to read the <code>seed</code>
CSR.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Encoding</dt>
</dl>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt4rmqk7KLCm2UjDXUchLzE21UjCoMDfWUUgsKSmyUlAKjgwOcfVVqtWBKTOFKVMvSlFHCBsjdBvCNTsHBwWFY9NrUGEAV1RhgKTC0AjJHFO4muLU1BQFW5A2Q1OQ6thaALLrNvI=" alt="svg">
</div>
</div>
<div class="paragraph">
<p>The <code>seed</code> CSR is also access controlled by execution mode, and attempted
read or write access will raise an illegal-instruction exception outside M mode
unless access is explicitly granted. See <a href="#crypto_scalar_es_access">Access Control to <code>seed</code></a> for
more details.</p>
</div>
<div class="paragraph">
<p>The status bits <code>seed[31:30]</code> = <code>OPST</code> may be <code>ES16</code> (10),
indicating successful polling, or one of three entropy polling failure
statuses <code>BIST</code> (00), <code>WAIT</code> (01), or <code>DEAD</code> (11), discussed below.</p>
</div>
<div class="paragraph">
<p>Each returned <code>seed[15:0]</code> = <code>entropy</code> value represents unique randomness
when <code>OPST</code>=<code>ES16</code> (<code>seed[31:30]</code> = <code>10</code>), even if its numerical value is
the same as that of a previously polled <code>entropy</code> value. The implementation
requirements of <code>entropy</code> bits are defined in <a href="#crypto_scalar_es_req">Entropy Source Requirements</a>.
When <code>OPST</code> is not <code>ES16</code>, <code>entropy</code> must be set to 0.
An implementation may safely set reserved and custom bits to zeros.</p>
</div>
<div class="paragraph">
<p>For security reasons, the interface guarantees that secret <code>entropy</code>
words are not made available multiple times. Hence polling (reading) must
also have the side effect of clearing (wipe-on-read) the <code>entropy</code> contents and
changing the state to <code>WAIT</code> (unless there is <code>entropy</code>
immediately available for <code>ES16</code>). Other states (<code>BIST</code>, <code>WAIT</code>, and <code>DEAD</code>)
may be unaffected by polling.</p>
</div>
<div class="paragraph">
<p>The Status Bits returned in <code>seed[31:30]</code>=<code>OPST</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>00</code> - <code>BIST</code>
indicates that Built-In Self-Test "on-demand" (BIST) testing is being
performed. If <code>OPST</code> returns temporarily to <code>BIST</code> from any other
state, this signals a non-fatal self-test alarm,
which is non-actionable, apart from being logged.
Such a <code>BIST</code> alarm must be latched until polled at least once to enable
software to record its occurrence.</p>
</li>
<li>
<p><code>01</code> - <code>WAIT</code>
means that a sufficient amount of entropy is not yet available. This
is not an error condition and may (in fact) be more frequent than ES16
since physical entropy sources often have low bandwidth.</p>
</li>
<li>
<p><code>10</code> - <code>ES16</code>
indicates success; the low bits <code>seed[15:0]</code> will have 16 bits of
randomness (<code>entropy</code>), which is guaranteed to meet certain minimum entropy
requirements, regardless of implementation.</p>
</li>
<li>
<p><code>11</code> - <code>DEAD</code>
is an unrecoverable self-test error. This may indicate a hardware
fault, a security issue, or (extremely rarely) a type-1 statistical
false positive in the continuous testing procedures. In case of a fatal
failure, an immediate lockdown may also be an appropriate response in
dedicated security devices.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Example.</strong> <code>0x8000ABCD</code> is a valid <code>ES16</code> status output, with <code>0xABCD</code>
being the <code>entropy</code> value. <code>0xFFFFFFFF</code> is an invalid output (<code>DEAD</code>) with
no <code>entropy</code> value.</p>
</div>
<div id="crypto_scalar_es_state" class="exampleblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="_images/es_state.svg" alt="es state">
</div>
<div class="title">Figure 1. Entropy Source state transition diagram.</div>
</div>
<div class="paragraph">
<p>Normally the operational state alternates between WAIT
(no data) and ES16, which means that 16 bits of randomness (<code>entropy</code>)
have been polled. BIST (Built-in Self-Test) only occurs after reset
or to signal a non-fatal self-test alarm (if reached after WAIT or
ES16). DEAD is an unrecoverable error state.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="crypto_scalar_es_req"><a class="anchor" href="#crypto_scalar_es_req"></a>Entropy Source Requirements</h4>
<div class="paragraph">
<p>The output <code>entropy</code> (<code>seed[15:0]</code> in ES16 state) is not necessarily
fully conditioned randomness due to hardware and energy limitations
of smaller, low-powered implementations. However, minimum requirements are
defined. The main requirement is that 2-to-1 cryptographic post-processing
in 256-bit input blocks will yield 128-bit "full entropy" output blocks.
Entropy source users may make this conservative assumption but are not
prohibited from using more than twice the number of seed bits relative
to the desired resulting entropy.</p>
</div>
<div class="paragraph">
<p>An implementation of the entropy source should meet at least one of the
following requirements sets in order to be considered a secure and
safe design:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#crypto_scalar_es_req_90b">NIST SP 800-90B / FIPS 140-3 Requirements</a>: A physical entropy source meeting
NIST SP 800-90B cite:[TuBaKe:18] criteria with evaluated min-entropy
of 192 bits for each 256 output bits (min-entropy rate 0.75).</p>
</li>
<li>
<p><a href="#crypto_scalar_es_req_ptg2">BSI AIS-31 PTG.2 / Common Criteria Requirements</a>: A physical entropy source meeting the
AIS-31 PTG.2 cite:[KiSc11] criteria, implying average Shannon entropy
rate 0.997. The source must also meet the NIST 800-90B
min-entropy rate 192/256 = 0.75.</p>
</li>
<li>
<p><a href="#crypto_scalar_es_req_virt">Virtual Sources: Security Requirement</a>: A virtual entropy source is a DRBG
seeded from a physical entropy source. It must have at least a
256-bit (Post-Quantum Category 5) internal security level.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All implementations must signal initialization, test mode, and health
alarms as required by respective standards. This may require the implementer
to add non-standard (custom) test interfaces in a secure and safe manner,
an example of which is described in <a href="#crypto_scalar_es_getnoise">Suggested GetNoise Test Interface</a></p>
</div>
<div class="sect4">
<h5 id="crypto_scalar_es_req_90b"><a class="anchor" href="#crypto_scalar_es_req_90b"></a>NIST SP 800-90B / FIPS 140-3 Requirements</h5>
<div class="paragraph">
<p>All NIST SP 800-90B cite:[TuBaKe:18] required components and health test
mechanisms must be implemented.</p>
</div>
<div class="paragraph">
<p>The entropy requirement is satisfied if 128 bits of <em>full entropy</em> can be
obtained from each 256-bit (16*16 -bit) successful, but possibly
non-consecutive <code>entropy</code> (ES16) output sequence using a vetted conditioning
algorithm such as a cryptographic hash (See Section 3.1.5.1.1, SP 800-90B
cite:[TuBaKe:18]). In practice, a min-entropy rate of 0.75 or larger is
required for this.</p>
</div>
<div class="paragraph">
<p>Note that 128 bits of estimated input min-entropy does not yield 128 bits of
conditioned, full entropy in SP 800-90B/C evaluation. Instead, the
implication is that every 256-bit sequence should have min-entropy of at
least 128+64 = 192 bits, as discussed in SP 800-90C cite:[BaKeRo:21];
the likelihood of successfully "guessing" an individual 256-bit output
sequence should not be higher than 2<sup>-192</sup> even with (almost)
unconstrained amount of entropy source data and computational power.</p>
</div>
<div class="paragraph">
<p>Rather than attempting to define all the mathematical and architectural
properties that the entropy source must satisfy, we define that the physical
entropy source be strong and robust enough to pass the equivalent of
NIST SP 800-90 evaluation and certification for full entropy when
conditioned cryptographically in ratio 2:1 with 128-bit output blocks.</p>
</div>
<div class="paragraph">
<p>Even though the requirement is defined in terms of 128-bit full entropy
blocks, we recommend 256-bit security. This can be accomplished by using
at least 512 <code>entropy</code> bits to initialize a DRBG that has 256-bit security.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_es_req_ptg2"><a class="anchor" href="#crypto_scalar_es_req_ptg2"></a>BSI AIS-31 PTG.2 / Common Criteria Requirements</h5>
<div class="paragraph">
<p>For alternative Common Criteria certification (or self-certification),
AIS 31 PTG.2 class cite:[KiSc11] (Sect. 4.3.) required hardware components
and mechanisms must be implemented.
In addition to AIS-31 PTG.2 randomness requirements (Shannon entropy rate of
0.997 as evaluated in that standard), the overall min-entropy requirement of
remains, as discussed in <a href="#crypto_scalar_es_req_90b">NIST SP 800-90B / FIPS 140-3 Requirements</a>. Note that 800-90B
min-entropy can be significantly lower than AIS-31 Shannon entropy. These
two metrics should not be equated or confused with each other.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_es_req_virt"><a class="anchor" href="#crypto_scalar_es_req_virt"></a>Virtual Sources: Security Requirement</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A virtual source is not an ISA compliance requirement. It is defined
for the benefit of the RISC-V security ecosystem so that virtual systems
may have a consistent level of security.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A virtual source is not a physical entropy source but provides
additional protection against covert channels, depletion attacks, and host
identification in operating environments that can not be entirely trusted
with direct access to a hardware resource. Despite limited trust,
implementers should try to guarantee that even such environments have
sufficient entropy available for secure cryptographic operations.</p>
</div>
<div class="paragraph">
<p>A virtual source traps access to the <code>seed</code> CSR, emulates it, or
otherwise implements it, possibly without direct access to a physical entropy
source. The output can be cryptographically secure pseudorandomness
instead of real entropy, but must have at least 256-bit security, as defined
below. A virtual source is intended especially for guest operating
systems, sandboxes, emulators, and similar use cases.</p>
</div>
<div class="paragraph">
<p>As a technical definition, a random-distinguishing attack against
the output should require computational resources comparable or greater
than those required for exhaustive key search on a secure block cipher
with a 256-bit key (e.g., AES 256). This applies to both classical
and quantum computing models, but only classical information flows.
The virtual source security requirement maps to Post-Quantum Security
Category 5 cite:[NI16].</p>
</div>
<div class="paragraph">
<p>Any implementation of the <code>seed</code> CSR that limits the security
strength shall not reduce it to less than 256 bits. If the security
level is under 256 bits, then the interface must not be available.</p>
</div>
<div class="paragraph">
<p>A virtual entropy source does not need to implement <code>WAIT</code> or <code>BIST</code> states.
It should fail (<code>DEAD</code>) if the host DRBG or entropy source fails and
there is insufficient seeding material for the host DRBG.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="crypto_scalar_es_access"><a class="anchor" href="#crypto_scalar_es_access"></a>Access Control to <code>seed</code></h4>
<div class="paragraph">
<p>The <code>seed</code> CSR is by default only available in M mode, but can be made
available to other modes via the <code>mseccfg.sseed</code> and <code>mseccfg.useed</code>
access control bits. <code>sseed</code> is bit <code>9</code> of and <code>useed</code> is
bit <code>8</code> of the <code>mseccfg</code> CSR.
Without the corresponding access control bit set to 1, any attempted
access to <code>seed</code> from U, S, or HS modes will raise an illegal-instruction
exception.</p>
</div>
<div class="paragraph">
<p>VS and VU modes are present in systems with Hypervisor (H) extension
implemented. If desired, a hypervisor can emulate accesses to the seed CSR
from a virtual machine. Attempted access to <code>seed</code> from virtual modes
VS and VU always raises an exception; a read-only instruction causes an
illegal-instruction exception, while a read-write instruction (that can
potentially be emulated) causes a virtual-instruction  exception only if
<code>mseccfg.sseed=1</code>. Note that <code>mseccfg.useed</code> has no effect on the exception
type for either VS or VU modes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Entropy Source Access Control.</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top"><code>sseed</code></th>
<th class="tableblock halign-left valign-top"><code>useed</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>seed</code> CSR is always available in machine mode as normal (with a
CSR read-write instruction.) Attempted read without a write raises an
illegal-instruction exception regardless of mode and access control bits.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <code>seed</code> CSR access raises an illegal-instruction exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>seed</code> CSR is accessible as normal. No exception is raised for read-write.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S/HS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <code>seed</code> CSR access raises an illegal-instruction exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S/HS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>seed</code> CSR is accessible as normal. No exception is raised for read-write.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VS/VU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <code>seed</code> CSR access raises an illegal-instruction exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VS/VU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A read-write <code>seed</code> access raises a virtual-instruction  exception,
while other access conditions raise an illegal-instruction exception.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Systems should implement carefully considered access control policies from
lower privilege modes to physical entropy sources. The system can trap
attempted access to <code>seed</code> and feed a less privileged client
<em>virtual entropy source</em> data (<a href="#crypto_scalar_es_req_virt">Virtual Sources: Security Requirement</a>) instead of
invoking an SP 800-90B  (<a href="#crypto_scalar_es_req_90b">NIST SP 800-90B / FIPS 140-3 Requirements</a>) or PTG.2
(<a href="#crypto_scalar_es_req_ptg2">BSI AIS-31 PTG.2 / Common Criteria Requirements</a>) <em>physical entropy source</em>. Emulated <code>seed</code>
data generation is made with an appropriately seeded, secure software DRBG.
See  <a href="#crypto_scalar_appx_es_access">Security Considerations for Direct Hardware Access</a> for security considerations related
to direct access to entropy sources.</p>
</div>
<div class="paragraph">
<p>Implementations may implement <code>mseccfg</code> such that <code>[s,u]seed</code> is a read-only
constant value <code>0</code>. Software may discover if access to the <code>seed</code> CSR can be
enabled in U and S mode by writing a <code>1</code> to <code>[s,u]seed</code> and reading back
the result.</p>
</div>
<div class="paragraph">
<p>If S or U mode is not implemented, then the corresponding <code>[s,u]seed</code>
bits of <code>mseccfg</code> must be hardwired to zero.
The <code>[s,u]seed</code> bits must have a defined reset value. The system
must not allow them to be in an undefined state after a reset.
<code>mseccfg</code> exists if <code>Zkr</code> is implemented, or if it is required by other
processor features. If <code>Zkr</code> is <em>not</em> implemented, the <code>[s,u]seed</code> bits must
be hardwired to zero.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crypto_scalar_zkt"><a class="anchor" href="#crypto_scalar_zkt"></a>Data Independent Execution Latency Subset: Zkt</h3>
<div class="paragraph">
<p>The Zkt extension attests that the machine has data-independent execution
time for a safe subset of instructions. This property is commonly called
<em>"constant-time"</em> although should not be taken with that literal meaning.</p>
</div>
<div class="paragraph">
<p>All currently defined cryptographic instructions (Zk* and Zbk* extensions) are on
this list, together with a set of relevant supporting instructions from
I, M, C, and B extensions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Note to software developers</div>
<div class="paragraph">
<p>Failure to prevent leakage of sensitive parameters via the direct
timing channel is considered a serious security vulnerability and will
typically result in a CERT CVE security advisory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="scope-and-goal"><a class="anchor" href="#scope-and-goal"></a>Scope and Goal</h4>
<div class="paragraph">
<p>An "ISA contract" is made between a programmer and the RISC-V implementation
that Zkt instructions do not leak information about processed secret data
(plaintext, keying information, or other "sensitive security parameters"&#8201;&#8212;&#8201;FIPS 140-3 term) through differences in execution latency. Zkt does <em>not</em>
define a set of instructions available in the core; it just restricts the
behaviour of certain instructions if those are implemented.</p>
</div>
<div class="paragraph">
<p>Currently, the scope of this document is within scalar RV32/RV64 processors.
Vector cryptography instructions (and appropriate vector support instructions)
will be added later, as will other security-related functions that wish
to assert leakage-free execution latency properties.</p>
</div>
<div class="paragraph">
<p>Loads, stores, conditional branches are excluded, along with a set of
instructions that are rarely necessary to process secret data. Also excluded
are instructions for which workarounds exist in standard cryptographic
middleware due to the limitations of other ISA processors.</p>
</div>
<div class="paragraph">
<p>The stated goal is that OpenSSL, BoringSSL (Android), the Linux Kernel,
and similar trusted software will not have directly observable
timing side channels when compiled and running on a Zkt-enabled RISC-V target.
The Zkt extension explicitly states many of the common latency assumptions
made by cryptography developers.</p>
</div>
<div class="paragraph">
<p>Vendors do not have to implement all of the list&#8217;s instructions to be Zkt
compliant; however, if they claim to have Zkt and implement any of the listed instructions, it must have data-independent latency.</p>
</div>
<div class="paragraph">
<p>For example, many simple RV32I and RV64I cores (without Multiply, Compressed,
Bitmanip, or Cryptographic extensions) are technically compliant with Zkt.
A constant-time AES can be implemented on them using "bit-slice" techniques,
but it will be excruciatingly slow when compared to implementation with AES
instructions. There are no guarantees that even a bit-sliced cipher
implementation (largely based on boolean logic instructions) is secure on a
core without Zkt attestation.</p>
</div>
<div class="paragraph">
<p>Out-of-order implementations adhering to Zkt are still free to fuse, crack,
change or even ignore sequences of instructions, so long as the optimisations
are applied deterministically, and not based on operand data.
The guiding principle should be that no information about the data being
operated on should be leaked based on the execution latency.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is left to future extensions or other techniques to tackle the problem
of data-independent execution in implementations which advanced out-of-order
capabilities which use value prediction, or which are otherwise data-dependent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="SH"></i>
</td>
<td class="content">
<div class="title">Note to software developers</div>
<div class="paragraph">
<p>Programming techniques can only mitigate leakage directly caused by
arithmetic, caches, and branches. Other ISAs have had micro-architectural
issues such as Spectre, Meltdown, Speculative Store Bypass, Rogue System
Register Read, Lazy FP State Restore, Bounds Check Bypass Store, TLBleed,
and L1TF/Foreshadow, etc. See e.g.
<a href="https://github.com/nsacyber/Hardware-and-Firmware-Security-Guidance">NSA Hardware and Firmware Security Guidance</a></p>
</div>
<div class="paragraph">
<p>It is not within the remit of this proposal to mitigate these
<em>micro-architectural</em> leakages.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="background"><a class="anchor" href="#background"></a>Background</h4>
<div class="ulist">
<ul>
<li>
<p>Timing attacks are much more powerful than was realised before the 2010s,
which has led to a significant mitigation effort in current cryptographic
code-bases.</p>
</li>
<li>
<p>Cryptography developers use static and dynamic security testing tools
to trace the handling of secret information and detect occasions where it
influences a branch or is used for a table lookup.</p>
</li>
<li>
<p>Architectural testing for Zkt can be pragmatic and semi-formal;
<em>security by design</em> against basic timing attacks can usually be achieved via
conscious implementation (of relevant iterative multi-cycle instructions or
instructions composed of micro-ops) in way that avoids data-dependent latency.</p>
</li>
<li>
<p>Laboratory testing may utilize statistical timing attack leakage analysis
techniques such as those described in ISO/IEC 17825 cite:[IS16].</p>
</li>
<li>
<p>Binary executables should not contain secrets in the instruction encodings
(Kerckhoffs&#8217;s principle), so instruction timing may leak information about
immediates, ordering of input registers, etc. There may be an exception to this
in systems where a binary loader modifies the executable for purposes of
relocation&#8201;&#8212;&#8201;and it is desirable to keep the execution location (PC) secret.
This is why instructions such as LUI, AUIPC, and ADDI are on the list.</p>
</li>
<li>
<p>The rules used by audit tools are relatively simple to understand.
Very briefly; we call the plaintext, secret keys, expanded keys, nonces,
and other such variables "secrets". A secret variable (arithmetically)
modifying any other variable/register turns that into a secret too.
If a secret ends up in address calculation affecting a load or store, that
is a violation. If a secret affects a branch&#8217;s condition, that is also a
violation. A secret variable location or register becomes a non-secret via
specific zeroization/sanitisation or by being declared ciphertext
(or otherwise no-longer-secret information). In essence, secrets can only
"touch" instructions on the Zkt list while they are secrets.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="specific-instruction-rationale"><a class="anchor" href="#specific-instruction-rationale"></a>Specific Instruction Rationale</h4>
<div class="ulist">
<ul>
<li>
<p>HINT instruction forms (typically encodings with <em>rd</em>=<code>x0</code>) are excluded from
the data-independent time requirement.</p>
</li>
<li>
<p>Floating point (F, D, Q, L extensions) are currently excluded from the
constant-time requirement as they have very few applications in standardised
cryptography. We may consider adding floating point add, sub, multiply as a
constant time requirement for some floating point extension in case a specific
algorithm (such as the PQC Signature algorithm Falcon) becomes critical.</p>
</li>
<li>
<p>Cryptographers typically assume division to be variable-time (while
multiplication is constant time) and implement their Montgomery reduction
routines with that assumption.</p>
</li>
<li>
<p>Zicsr, Zifencei are excluded.</p>
</li>
<li>
<p>Some instructions are on the list simply because we see no harm in
including them in testing scope.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="programming-information"><a class="anchor" href="#programming-information"></a>Programming Information</h4>
<div class="paragraph">
<p>For background information on secure programming "models", see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Thomas Pornin: <em>"Why Constant-Time Crypto?"</em> (A great introduction to timing assumptions.) <a href="https://www.bearssl.org/constanttime.html" class="bare">https://www.bearssl.org/constanttime.html</a></p>
</li>
<li>
<p>Jean-Philippe Aumasson: <em>"Guidelines for low-level cryptography software."</em>
(A list of recommendations.) <a href="https://github.com/veorq/cryptocoding" class="bare">https://github.com/veorq/cryptocoding</a></p>
</li>
<li>
<p>Peter Schwabe: <em>"Timing Attacks and Countermeasures."</em>
(Lecture slides&#8201;&#8212;&#8201;nice references.)
<a href="https://summerschool-croatia.cs.ru.nl/2016/slides/PeterSchwabe.pdf" class="bare">https://summerschool-croatia.cs.ru.nl/2016/slides/PeterSchwabe.pdf</a></p>
</li>
<li>
<p>Adam Langley: <em>"ctgrind."</em> (This is from 2010 but is still relevant.)
<a href="https://www.imperialviolet.org/2010/04/01/ctgrind.html" class="bare">https://www.imperialviolet.org/2010/04/01/ctgrind.html</a></p>
</li>
<li>
<p>Kris Kwiatkowski: <em>"Constant-time code verification with Memory Sanitizer."</em>
<a href="https://www.amongbytes.com/post/20210709-testing-constant-time/" class="bare">https://www.amongbytes.com/post/20210709-testing-constant-time/</a></p>
</li>
<li>
<p>For early examples of timing attack vulnerabilities, see
<a href="https://www.kb.cert.org/vuls/id/997481" class="bare">https://www.kb.cert.org/vuls/id/997481</a> and related academic papers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="zkt-listings"><a class="anchor" href="#zkt-listings"></a>Zkt listings</h4>
<div class="paragraph">
<p>The following instructions are included in the <code>Zkt</code> subset
They are listed here grouped by their original parent extension.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Note to implementers</div>
<div class="paragraph">
<p>You do not need to implement all of these instructions to implement <code>Zkt</code>.
Rather, every one of these instructions that the core does implement must
adhere to the requirements of <code>Zkt</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="rvi-base-instruction-set"><a class="anchor" href="#rvi-base-instruction-set"></a>RVI (Base Instruction Set)</h5>
<div class="paragraph">
<p>Only basic arithmetic and <code>slt*</code> (for carry computations) are included.
The data-independent timing requirement does not apply to HINT instruction
encoding forms of these instructions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lui   <em>rd</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">auipc <em>rd</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addi  <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slti  <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sltiu <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xori  <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ori   <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">andi  <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slli  <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srli  <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srai  <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sll   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slt   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sltu  <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xor   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srl   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sra   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">or    <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">and   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addiw <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slliw <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srliw <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sraiw <em>rd</em>, <em>rs1</em>, <em>imm</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addw  <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subw  <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sllw  <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srlw  <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sraw  <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="rvm-multiply"><a class="anchor" href="#rvm-multiply"></a>RVM (Multiply)</h5>
<div class="paragraph">
<p>Multiplication is included; division and remaindering excluded.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mul    <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mulh   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mulhsu <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mulhu  <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mulw   <em>rd</em>, <em>rs1</em>, <em>rs2</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="rvc-compressed"><a class="anchor" href="#rvc-compressed"></a>RVC (Compressed)</h5>
<div class="paragraph">
<p>Same criteria as in RVI. Organised by quadrants.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.nop</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.addi</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.addiw</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.lui</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.srli</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.srai</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.andi</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.sub</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.xor</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.or</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.and</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.subw</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.addw</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.slli</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.mv</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.add</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="rvk-scalar-cryptography"><a class="anchor" href="#rvk-scalar-cryptography"></a>RVK (Scalar Cryptography)</h5>
<div class="paragraph">
<p>All K-specific instructions are included.
Additionally, <code>seed</code> CSR latency should be independent of <code>ES16</code> state output
<code>entropy</code> bits, as that is a sensitive security parameter.
See <a href="#crypto_scalar_appx_es_access">Security Considerations for Direct Hardware Access</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes32dsi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes32dsi">AES final round decrypt (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes32dsmi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes32dsmi">AES middle round decrypt (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes32esi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes32esi">AES final round encrypt (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes32esmi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes32esmi">AES middle round encrypt (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64ds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64ds">AES decrypt final round (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64dsm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64dsm">AES decrypt middle round (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64es</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64es">AES encrypt final round instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64esm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64esm">AES encrypt middle round instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64im</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64im">AES Decrypt KeySchedule MixColumns (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64ks1i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64ks1i">AES Key Schedule Instruction 1 (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aes64ks2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-aes64ks2">AES Key Schedule Instruction 2 (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256sig0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha256sig0">SHA2-256 Sigma0 instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256sig1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha256sig1">SHA2-256 Sigma1 instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256sum0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha256sum0">SHA2-256 Sum0 instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256sum1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha256sum1">SHA2-256 Sum1 instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig0h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig0h">SHA2-512 Sigma0 high (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig0l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig0l">SHA2-512 Sigma0 low (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig1h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig1h">SHA2-512 Sigma1 high (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig1l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig1l">SHA2-512 Sigma1 low (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum0r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sum0r">SHA2-512 Sum0 (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum1r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sum1r">SHA2-512 Sum1 (RV32)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig0">SHA2-512 Sigma0 instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sig1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sig1">SHA2-512 Sigma1 instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sum0">SHA2-512 Sum0 instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sha512sum1">SHA2-512 Sum1 instruction (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sm3p0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sm3p0">SM3 P0 transform</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sm3p1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sm3p1">SM3 P1 transform</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sm4ed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sm4ed">SM4 Encrypt/Decrypt Instruction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sm4ks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-sm4ks">SM4 Key Schedule Instruction</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="rvb-bitmanip"><a class="anchor" href="#rvb-bitmanip"></a>RVB (Bitmanip)</h5>
<div class="paragraph">
<p>The <a href="#zbkb-sc">Zbkb-sc</a>, <a href="#zbkc-sc">Zbkc-sc</a> and <a href="#zbkx-sc">Zbkx-sc</a> extensions are included in their entirety.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">RV32</th>
<th class="tableblock halign-center valign-top">RV64</th>
<th class="tableblock halign-left valign-top">Mnemonic</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clmul</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-clmul-sc">Carry-less multiply (low-part)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clmulh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-clmulh-sc">Carry-less multiply (high-part)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xperm4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-xperm4-sc">Crossbar permutation (nibbles)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xperm8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-xperm8-sc">Crossbar permutation (bytes)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ror</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-ror-sc">Rotate right (Register)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-rol-sc">Rotate left (Register)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-rori-sc">Rotate right (Immediate)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rorw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-rorw-sc">Rotate right Word (Register)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rolw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-rolw-sc">Rotate Left Word (Register)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roriw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-roriw-sc">Rotate right Word (Immediate)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">andn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-andn-sc">AND with inverted operand</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">orn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-orn-sc">OR with inverted operand</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xnor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-xnor-sc">Exclusive NOR</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-pack-sc">Pack low halves of registers</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-packh-sc">Pack low bytes of registers</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-packw-sc">Pack low 16-bits of registers (RV64)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brev8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-brev8-sc">Reverse bits in bytes</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rev8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-rev8-sc">Byte-reverse register</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-zip-sc">Bit interleave</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#10003;</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unzip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#insns-unzip-sc">Bit deinterleave</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crypto_scalar_appx_rationale"><a class="anchor" href="#crypto_scalar_appx_rationale"></a>Instruction Rationale</h3>
<div class="paragraph">
<p>This section contains various rationale, design notes and usage
recommendations for the instructions in the scalar cryptography
extension. It also tries to record how the designs of instructions were
derived, or where they were contributed from.</p>
</div>
<div class="sect3">
<h4 id="aes-instructions"><a class="anchor" href="#aes-instructions"></a>AES Instructions</h4>
<div class="paragraph">
<p>The 32-bit instructions were derived from work in cite:[MJS:LWAES:20] and
contributed to the RISC-V cryptography extension.
The 64-bit instructions were developed collaboratively by task group
members on our mailing list.</p>
</div>
<div class="paragraph">
<p>Supporting material, including rationale and a design space exploration
for all of the AES instructions in the specification can be found in the paper
<em>"<a href="https://doi.org/10.46586/tches.v2021.i1.109-136">The design of scalar AES Instruction Set Extensions for RISC-V</a>"</em> cite:[MNPSW:20].</p>
</div>
</div>
<div class="sect3">
<h4 id="sha2-instructions"><a class="anchor" href="#sha2-instructions"></a>SHA2 Instructions</h4>
<div class="paragraph">
<p>These instructions were developed based on academic
work at the University of Bristol as part of the XCrypto project
cite:[MPP:19], and contributed to the RISC-V cryptography extension.</p>
</div>
<div class="paragraph">
<p>The RV32 SHA2-512 instructions were based on this work, and developed
in cite:[MJS:LWSHA:20], before being contributed in the same way.</p>
</div>
</div>
<div class="sect3">
<h4 id="sm3-and-sm4-instructions"><a class="anchor" href="#sm3-and-sm4-instructions"></a>SM3 and SM4 Instructions</h4>
<div class="paragraph">
<p>The SM4 instructions were derived from work in cite:[MJS:LWAES:20], and
are hence very similar to the RV32 AES instructions.</p>
</div>
<div class="paragraph">
<p>The SM3 instructions were inspired by the SHA2 instructions, and
based on development work done in cite:[MJS:LWSHA:20], before being
contributed to the RISC-V cryptography extension.</p>
</div>
</div>
<div class="sect3">
<h4 id="crypto_scalar_zkb"><a class="anchor" href="#crypto_scalar_zkb"></a>Bitmanip Instructions for Cryptography</h4>
<div class="paragraph">
<p>Many of the primitive operations used in symmetric key cryptography
and cryptographic hash functions are well supported by the
RISC-V Bitmanip extensions (see <a href="#bits">[bits]</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section repeats much of the information in
<a href="#zbkb-sc">Zbkb-sc</a>,
<a href="#zbkc-sc">Zbkc-sc</a>
and
<a href="#zbkx-sc">Zbkx-sc</a>,
but includes more rationale.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We proposed that the scalar cryptographic extension <em>reuse</em> a
subset of the instructions from the Bitmanip extensions <code>Zb[abc]</code> directly.
Specifically, this would mean that
a core implementing
<em>either</em>
the scalar cryptographic extensions,
<em>or</em>
the <code>Zb[abc]</code>,
<em>or</em>
both,
would be required to implement these instructions.</p>
</div>
<div class="sect4">
<h5 id="rotations"><a class="anchor" href="#rotations"></a>Rotations</h5>
<div class="listingblock">
<div class="content">
<pre>RV32, RV64:                         RV64 only:
    ror    rd, rs1, rs2                 rorw   rd, rs1, rs2
    rol    rd, rs1, rs2                 rolw   rd, rs1, rs2
    rori   rd, rs1, imm                 roriw  rd, rs1, imm</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#zbkb">[zbkb]</a> for details of these instructions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Notes to software developers</div>
<div class="paragraph">
<p>Standard bitwise rotation is a primitive operation in many block ciphers
and hash functions; it features particularly in the ARX (Add, Rotate, Xor)
class of block ciphers and stream ciphers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Algorithms making use of 32-bit rotations:
SHA256, AES (Shift Rows), ChaCha20, SM3.</p>
</li>
<li>
<p>Algorithms making use of 64-bit rotations:
SHA512, SHA3.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="bit-byte-permutations"><a class="anchor" href="#bit-byte-permutations"></a>Bit &amp; Byte Permutations</h5>
<div class="listingblock">
<div class="content">
<pre>RV32, RV64:
    brev8   rd, rs1
    rev8    rd, rs1</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#zbkb">[zbkb]</a> for details of these instructions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Notes to software developers</div>
<div class="paragraph">
<p>Reversing bytes in words is very common in cryptography when setting a
standard endianness for input and output data.
Bit reversal within bytes is used for implementing the GHASH component
of Galois/Counter Mode (GCM) cite:[nist:gcm].</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>RV32:
    zip     rd, rs1
    unzip   rd, rs1</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#zbkb">[zbkb]</a> for details of these instructions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Notes to software developers</div>
<div class="paragraph">
<p>These instructions perform a bit-interleave (or de-interleave) operation, and
are useful for implementing the 64-bit rotations in the
SHA3 cite:[nist:fips:202] algorithm on
a 32-bit architecture.
On RV64, the relevant operations in SHA3 can be done natively using
rotation instructions, so <code>zip</code> and <code>unzip</code> are not required.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="carry-less-multiply"><a class="anchor" href="#carry-less-multiply"></a>Carry-less Multiply</h5>
<div class="listingblock">
<div class="content">
<pre>RV32, RV64:
    clmul  rd, rs1, rs2
    clmulh rd, rs1, rs2</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#zbkc">[zbkc]</a> for details of these instructions.
See <a href="#crypto_scalar_zkt">Data Independent Execution Latency Subset: Zkt</a> for additional implementation
requirements for these instructions, related to data independent
execution latency.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Notes to software developers</div>
<div class="paragraph">
<p>As is mentioned there, obvious cryptographic use-cases for carry-less
multiply are for Galois Counter Mode (GCM) block cipher operations.
GCM is recommended by NIST as a block cipher mode of operation
cite:[nist:gcm], and is the only <em>required</em> mode for the TLS 1.3
protocol.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="logic-with-negate"><a class="anchor" href="#logic-with-negate"></a>Logic With Negate</h5>
<div class="listingblock">
<div class="content">
<pre>RV32, RV64:
    andn rd, rs1, rs2
     orn rd, rs1, rs2
    xnor rd, rs1, rs2</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#zbkb">[zbkb]</a> for details of these instructions.
These instructions are useful inside hash functions, block ciphers and
for implementing software based side-channel countermeasures like masking.
The <code>andn</code> instruction is also useful for constant time word-select
in systems without the ternary Bitmanip <code>cmov</code> instruction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Notes to software developers</div>
<div class="paragraph">
<p>In the context of Cryptography, these instructions are useful for:
SHA3/Keccak Chi step,
Bit-sliced function implementations,
Software based power/EM side-channel countermeasures based on masking.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="packing"><a class="anchor" href="#packing"></a>Packing</h5>
<div class="listingblock">
<div class="content">
<pre>RV32, RV64:                         RV64:
    pack   rd, rs1, rs2                 packw  rd, rs1, rs2
    packh  rd, rs1, rs2</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#zbkb">[zbkb]</a> for details of these instructions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Notes to software developers</div>
<div class="paragraph">
<p>The <code>pack*</code> instructions are
useful for re-arranging halfwords within words, and
generally getting data into the right shape prior to applying transforms.
This is particularly useful for cryptographic algorithms which pass inputs
around as (potentially un-aligned) byte strings, but can operate on words
made out of those byte strings.
This occurs (for example) in AES when loading blocks and keys (which may not
be word aligned) into registers to perform the round functions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="crossbar-permutation-instructions"><a class="anchor" href="#crossbar-permutation-instructions"></a>Crossbar Permutation Instructions</h5>
<div class="listingblock">
<div class="content">
<pre>RV32, RV64:
    xperm4 rd, rs1, rs2
    xperm8 rd, rs1, rs2</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#zbkx">[zbkx]</a> for a complete description of these instructions.</p>
</div>
<div class="paragraph">
<p>The <code>xperm4</code> instruction operates on nibbles.
<code>GPR[rs1]</code> contains a vector of <code>XLEN/4</code> 4-bit elements.
<code>GPR[rs2]</code> contains a vector of <code>XLEN/4</code> 4-bit indexes.
The result is each element in <code>GPR[rs2]</code> replaced by the indexed element
in <code>GPR[rs1]</code>, or zero if the index into <code>GPR[rs2]</code> is out of bounds.</p>
</div>
<div class="paragraph">
<p>The <code>xperm8</code> instruction operates on bytes.
<code>GPR[rs1]</code> contains a vector of <code>XLEN/8</code> 8-bit elements.
<code>GPR[rs2]</code> contains a vector of <code>XLEN/8</code> 8-bit indexes.
The result is each element in <code>GPR[rs2]</code> replaced by the indexed element
in <code>GPR[rs1]</code>, or zero if the index into <code>GPR[rs2]</code> is out of bounds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="SH"></i>
</td>
<td class="content">
<div class="title">Notes to software developers</div>
<div class="paragraph">
<p>The instruction can be used to implement arbitrary bit
permutations.
For cryptography, they can accelerate bit-sliced implementations,
permutation layers of block ciphers, masking based countermeasures
and SBox operations.</p>
</div>
<div class="paragraph">
<p>Lightweight block ciphers using 4-bit SBoxes include:
PRESENT cite:[block:present],
Rectangle cite:[block:rectangle],
GIFT cite:[block:gift],
Twine cite:[block:twine],
Skinny, MANTIS cite:[block:skinny],
Midori cite:[block:midori].</p>
</div>
<div class="paragraph">
<p>National ciphers using 8-bit SBoxes include:
Camellia cite:[block:camellia] (Japan),
Aria cite:[block:aria] (Korea),
AES cite:[nist:fips:197] (USA, Belgium),
SM4 cite:[gbt:sm4] (China)
Kuznyechik (Russia).</p>
</div>
<div class="paragraph">
<p>All of these SBoxes can be implemented efficiently, in constant
time, using the <code>xperm8</code> instruction
<sup class="footnote" id="_footnote_l">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.
Note that this technique is also suitable for masking based
side-channel countermeasures.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crypto_scalar_appx_es"><a class="anchor" href="#crypto_scalar_appx_es"></a>Entropy Source Rationale and Recommendations</h3>
<div class="paragraph">
<p>This <strong>non-normative</strong> appendix focuses on the rationale, security,
self-certification, and implementation aspects of entropy sources. Hence we
also discuss non-ISA system features that may be needed for cryptographic
standards compliance and security testing.</p>
</div>
<div class="sect3">
<h4 id="checklists-for-design-and-self-certification"><a class="anchor" href="#checklists-for-design-and-self-certification"></a>Checklists for Design and Self-Certification</h4>
<div class="paragraph">
<p>The security of cryptographic systems is based on secret bits and keys.
These bits need to be random and originate from cryptographically secure
Random Bit Generators (RBGs). An Entropy Source (ES) is required to
construct secure RBGs.</p>
</div>
<div class="paragraph">
<p>While entropy source implementations do not have to be certified
designs, RISC-V expects that they behave in a compatible manner and do not
create unnecessary security risks to users. Self-evaluation and testing
following appropriate security standards is usually needed to achieve this.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ISA Architectural Tests.</strong> Verify, to the extent possible, that RISC-V ISA
requirements in this specification are correctly implemented. This includes
the state transitions (<a href="#crypto_scalar_es">Entropy Source</a> and
<a href="#crypto_scalar_es_getnoise">Suggested GetNoise Test Interface</a>), access control
(<a href="#crypto_scalar_es_access">Access Control to <code>seed</code></a>), and that <code>seed</code> ES16 <code>entropy</code> words
can only be read destructively.
The scope of RISC-V ISA architectural tests are those behaviors that
are independent of the physical entropy source details. A smoke test ES
module may be helpful in design phase.</p>
</li>
<li>
<p><strong>Technical justification for entropy.</strong> This may take the form of a
stochastic model or a heuristic argument that explains why the noise
source output is from a random, rather than pseudorandom (deterministic)
process, and is not easily predictable or externally observable.
A complete physical model is not necessary; research literature can be
cited. For example, one can show that a good ring oscillator noise derives
an amount of physical entropy from local, spontaneously occurring
Johnson-Nyquist thermal noise cite:[Sa21], and is therefore not merely
"random-looking".</p>
</li>
<li>
<p><strong>Entropy Source Design Review.</strong> An entropy source is more than a noise
source, and must have features such as health tests
(<a href="#crypto_scalar_es_security_controls">Security Controls and Health Tests</a>),
a conditioner (<a href="#crypto_scalar_appx_es_intro-cond">Conditioning: Cryptographic and Non-Cryptographic</a>), and a security
boundary with clearly defined interfaces. One may tabulate the SHALL
statements of SP 800-90B cite:[TuBaKe:18], FIPS 140-3 Implementation
Guidance cite:[NICC21], AIS-31 cite:[KiSc11] or other standards being
used. Official and non-official checklist tables are available:
<a href="https://github.com/usnistgov/90B-Shall-Statements" class="bare">https://github.com/usnistgov/90B-Shall-Statements</a></p>
</li>
<li>
<p><strong>Experimental Tests.</strong> The raw noise source is subjected to entropy
estimation as defined in NIST 800-90B, Section 3 cite:[TuBaKe:18].
   The interface described in <a href="#crypto_scalar_es_getnoise">Suggested GetNoise Test Interface</a> can used be to
   record datasets for this purpose. One also needs to show experimentally
   that the conditioner and health test components work appropriately to
   meet the ES16 output entropy requirements of <a href="#crypto_scalar_es_req">Entropy Source Requirements</a>.
For SP 800-90B, NIST has made a min-entropy estimation
package freely available:
<a href="https://github.com/usnistgov/SP800-90B_EntropyAssessment" class="bare">https://github.com/usnistgov/SP800-90B_EntropyAssessment</a></p>
</li>
<li>
<p><strong>Resilience.</strong> Above physical engineering steps should consider the
operational environment of the device, which may be unexpected or
hostile (actively attempting to exploit vulnerabilities in the design).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#crypto_scalar_appx_es_implementation">Implementation Strategies</a> for a discussion of various
implementation options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is one of the goals of the RISC-V Entropy Source specification
that a standard 90B Entropy Source Module or AIS-31 RNG IP may be licensed
from a third party and integrated with a RISC-V processor design. Compared
to older (FIPS 140-2) RNG and DRBG modules, an entropy source module may
have a relatively small area (just a few thousand NAND2 gate equivalent).
CMVP is introducing an "Entropy Source Validation Scope" which potentially
allows 90B validations to be reused for different (FIPS 140-3) modules.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="standards-and-terminology"><a class="anchor" href="#standards-and-terminology"></a>Standards and Terminology</h4>
<div class="paragraph">
<p>As a fundamental security function, the generation of random numbers is
governed by numerous standards and technical evaluation methods, the main
ones being FIPS 140-3 cite:[NI19,NICC21] required for U.S. Federal use,
and Common Criteria Methodology cite:[Cr17] used in high-security evaluations
internationally.</p>
</div>
<div class="paragraph">
<p>Note that FIPS 140-3 is a significantly updated standard compared
to its predecessor FIPS 140-2 and is only coming into use in the 2020s.</p>
</div>
<div class="paragraph">
<p>These standards set many of the technical requirements for the RISC-V
entropy source design, and we use their terminology if possible.</p>
</div>
<div id="crypto_scalar_es_fig_rng" class="exampleblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="_images/es_dataflow.svg" alt="es dataflow">
</div>
</div>
<div class="paragraph">
<p>The <code>seed</code> CSR provides an Entropy Source (ES) interface, not a stateful
random number generator. As a result, it can support arbitrary
security levels. Cryptographic (AES, SHA-2/3) ISA Extensions
can be used to construct high-speed DRBGs that are seeded from the
entropy source.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_intro-es"><a class="anchor" href="#crypto_scalar_appx_es_intro-es"></a>Entropy Source (ES)</h5>
<div class="paragraph">
<p>Entropy sources are built by sampling and processing data from a noise
source (<a href="#crypto_scalar_appx_es_noise_sources">Ring Oscillators</a>).
We will only consider physical sources of true randomness in this work.
Since these are directly based on natural phenomena and are subject to
environmental conditions (which may be adversarial), they require features
that monitor the "health" and quality of those sources.</p>
</div>
<div class="paragraph">
<p>The requirements for physical entropy sources are specified in
NIST SP 800-90B cite:[TuBaKe:18] (<a href="#crypto_scalar_es_req_90b">NIST SP 800-90B / FIPS 140-3 Requirements</a>)
for U.S. Federal FIPS 140-3 cite:[NI19] evaluations and
in BSI AIS-31 cite:[KiSc01,KiSc11] (<a href="#crypto_scalar_es_req_ptg2">BSI AIS-31 PTG.2 / Common Criteria Requirements</a>)
for high-security Common Criteria evaluations.
There is some divergence in the types of health tests and entropy metrics
mandated in these standards, and RISC-V enables support for both alternatives.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_intro-cond"><a class="anchor" href="#crypto_scalar_appx_es_intro-cond"></a>Conditioning: Cryptographic and Non-Cryptographic</h5>
<div class="paragraph">
<p>Raw physical randomness (noise) sources are rarely statistically
perfect, and some generate very large amounts of bits, which need to be
"debiased" and reduced to a smaller number of bits. This process is
called conditioning. A secure hash function is an example of a
cryptographic conditioner. It is important to note that even though
hashing may make any data look random, it does not increase its
entropy content.</p>
</div>
<div class="paragraph">
<p>Non-cryptographic conditioners and extractors such as von Neumann&#8217;s
"debiased coin tossing" cite:[Ne51] are easier to implement
efficiently but may reduce entropy content (in individual bits removed)
more than cryptographic hashes, which mix the input entropy very
efficiently. However, they do not require cryptanalytic or computational
hardness assumptions and are therefore inherently more future-proof.
See <a href="#crypto_scalar_appx_es_noncrypto">Non-cryptographic Conditioners</a> for a more detailed
discussion.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_intro-prng"><a class="anchor" href="#crypto_scalar_appx_es_intro-prng"></a>Pseudorandom Number Generator (PRNG)</h5>
<div class="paragraph">
<p>Pseudorandom Number Generators (PRNGs) use deterministic mathematical
formulas to create abundant random numbers from a smaller amount of
"seed" randomness. PRNGs are also divided into cryptographic and
non-cryptographic ones.</p>
</div>
<div class="paragraph">
<p>Non-cryptographic PRNGs, such as LFSRs and the linear-congruential
generators found in many programming libraries, may generate statistically
satisfactory random numbers but must never be used for cryptographic
keying. This is because they are not designed to resist
<em>cryptanalysis</em>; it is usually possible to take some output and
mathematically derive the "seed" or the internal state of the PRNG
from it. This is a security problem since knowledge of the state
allows the attacker to compute future or past outputs.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_intro-drbg"><a class="anchor" href="#crypto_scalar_appx_es_intro-drbg"></a>Deterministic Random Bit Generator (DRBG)</h5>
<div class="paragraph">
<p>Cryptographic PRNGs are also known as Deterministic Random Bit
Generators (DRBGs), a term used by SP 800-90A cite:[BaKe15]. A strong
cryptographic algorithm such as AES cite:[nist:fips:197] or SHA-2/3
cite:[nist:fips:202,nist:fips:180:4]
is used to produce random bits from a seed. The secret
seed material is like a cryptographic key; determining the seed
from the DRBG output is as hard as breaking AES or a strong hash function.
This also illustrates that the seed/key needs to be long enough and
come from a trusted Entropy Source. The DRBG should still be frequently
refreshed (reseeded) for forward and backward security.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specific-rationale-and-considerations"><a class="anchor" href="#specific-rationale-and-considerations"></a>Specific Rationale and Considerations</h4>
<div class="sect4">
<h5 id="the-seed-csr"><a class="anchor" href="#the-seed-csr"></a>The <code>seed</code> CSR</h5>
<div class="paragraph">
<p>See <a href="#crypto_scalar_seed_csr">The <code>seed</code> CSR</a>.</p>
</div>
<div class="paragraph">
<p>The interface was designed to be simple so that a vendor- and
device-independent driver component (e.g., in Linux kernel,
embedded firmware, or a cryptographic  library) may use <code>seed</code> to
generate truly random bits.</p>
</div>
<div class="paragraph">
<p>An entropy source does not require a high-bandwidth interface;
a single DRBG source initialization only requires 512 bits
(256 bits of entropy), and DRBG output can be shared by any number of
callers. Once initiated, a DRBG requires new entropy only to mitigate
the risk of state compromise.</p>
</div>
<div class="paragraph">
<p>From a security perspective, it is essential that the side effect of
flushing the secret entropy bits occurs upon reading. Hence we mandate
a write operation on this particular CSR.</p>
</div>
<div class="paragraph">
<p>A blocking instruction may have been easier to use, but most users should
be querying a (D)RBG instead of an entropy source.
Without a polling-style mechanism, the entropy source could hang for
thousands of cycles under some circumstances. A <code>wfi</code> or <code>pause</code>
mechanism (at least potentially) allows energy-saving sleep on MCUs
and context switching on higher-end CPUs.</p>
</div>
<div class="paragraph">
<p>The reason for the particular <code>OPST = seed[31:0]</code> two-bit mechanism is to
provide redundancy. The "fault" bit combinations <code>11</code> (<code>DEAD</code>) and <code>00</code>
(<code>BIST</code>) are more likely for electrical reasons if feature discovery fails
and the entropy source is actually not available.</p>
</div>
<div class="paragraph">
<p>The 16-bit bandwidth was a compromise motivated by the desire to
provide redundancy in the return value, some protection against
potential Power/EM leakage (further alleviated by the 2:1 cryptographic
conditioning discussed in <a href="#crypto_scalar_appx_es_crypto-cond">Cryptographic Conditioners</a>),
and the desire to have all of the bits "in the same place" on
both RV32 and RV64 architectures for programming convenience.</p>
</div>
</div>
<div class="sect4">
<h5 id="nist-sp-800-90b"><a class="anchor" href="#nist-sp-800-90b"></a>NIST SP 800-90B</h5>
<div class="paragraph">
<p>See <a href="#crypto_scalar_es_req_90b">NIST SP 800-90B / FIPS 140-3 Requirements</a>.</p>
</div>
<div class="paragraph">
<p>SP 800-90C cite:[BaKeRo:21] states that each conditioned block of n bits
is required to have n+64 bits of input entropy to attain full entropy.
Hence NIST SP 800-90B cite:[TuBaKe:18] min-entropy assessment must
guarantee at least 128 + 64 = 192 bits input entropy per 256-bit block
(cite:[BaKeRo:21], Sections 4.1. and 4.3.2).
Only then a hashing of 16 * 16 = 256 bits from the entropy source
will produce the desired 128 bits of full entropy. This follows from
the specific requirements, threat model, and distinguishability proof
contained in SP 800-90C  cite:[BaKeRo:21], Appendix A.
The implied min-entropy rate is 192/256=12/16=0.75. The expected
Shannon entropy is much larger.</p>
</div>
<div class="paragraph">
<p>In FIPS 140-3 / SP 800-90 classification, an RBG2(P) construction is a
cryptographically secure RBG with continuous access to a physical entropy
source (<code>seed</code>) and output generated by a fully seeded, secure DRBG.
The entropy source can also be used to build RBG3
full entropy sources cite:[BaKeRo:21]. The concatenation of output words
corresponds to the <code>Get_ES_Bitstring</code> function.</p>
</div>
<div class="paragraph">
<p>The 128-bit output block size was selected because that is the output
size of the CBC-MAC conditioner specified in Appendix F of cite:[TuBaKe:18]
and also the smallest key size we expect to see in applications.</p>
</div>
<div class="paragraph">
<p>If NIST SP 800-90B certification is chosen, the entropy source
should implement at least the health tests defined in
Section 4.4 of cite:[TuBaKe:18]: the repetition count test and adaptive
proportion test, or show that the same flaws will be detected
by vendor-defined tests.</p>
</div>
</div>
<div class="sect4">
<h5 id="bsi-ais-31"><a class="anchor" href="#bsi-ais-31"></a>BSI AIS-31</h5>
<div class="paragraph">
<p>See <a href="#crypto_scalar_es_req_ptg2">BSI AIS-31 PTG.2 / Common Criteria Requirements</a>.</p>
</div>
<div class="paragraph">
<p>PTG.2 is one of the security and functionality classes defined in
BSI AIS 20/31 cite:[KiSc11]. The PTG.2 source requirements work as a
building block for other types of BSI generators (e.g., DRBGs, or
PTG.3 TRNG with appropriate software post-processing).</p>
</div>
<div class="paragraph">
<p>For validation purposes, the PTG.2 requirements may be mapped to
security controls T1-3 (<a href="#crypto_scalar_es_security_controls">Security Controls and Health Tests</a>) and the
interface as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>P1 <strong>[PTG.2.1]</strong> Start-up tests map to T1 and reset-triggered (on-demand)
<code>BIST</code> tests.</p>
</li>
<li>
<p>P2 <strong>[PTG.2.2]</strong> Continuous testing total failure maps to T2 and the
<code>DEAD</code> state.</p>
</li>
<li>
<p>P3 <strong>[PTG.2.3]</strong> Online tests are continuous tests of T2 â€“ entropy output
is prevented in the <code>BIST</code> state.</p>
</li>
<li>
<p>P4 <strong>[PTG.2.4]</strong> Is related to the design of effective entropy source
health tests, which we encourage.</p>
</li>
<li>
<p>P5 <strong>[PTG.2.5]</strong> Raw random sequence may be checked via the GetNoise
interface (<a href="#crypto_scalar_es_getnoise">Suggested GetNoise Test Interface</a>).</p>
</li>
<li>
<p>P6 <strong>[PTG.2.6]</strong> Test Procedure A cite:[KiSc11] (Sect 2.4.4.1) is a
part of the evaluation process, and we suggest self-evaluation using these
tests even if AIS-31 certification is not sought.</p>
</li>
<li>
<p>P7 <strong>[PTG.2.7]</strong> Average Shannon entropy of "internal random bits"
exceeds 0.997.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note how P7 concerns Shannon entropy, not min-entropy as with NIST
sources. Hence the min-entropy requirement needs to be also stated.
PTG.2 modules built and certified to the AIS-31 standard can also meet the
"full entropy" condition after 2:1 cryptographic conditioning, but not
necessarily so. The technical validation process is somewhat different.</p>
</div>
</div>
<div class="sect4">
<h5 id="virtual-sources"><a class="anchor" href="#virtual-sources"></a>Virtual Sources</h5>
<div class="paragraph">
<p><a href="#crypto_scalar_es_req_virt">Virtual Sources: Security Requirement</a>.</p>
</div>
<div class="paragraph">
<p>All sources that are not direct physical sources (meeting the SP 800-90B
or the AIS-31 PTG.2 requirements) need to meet the security requirements
of virtual entropy sources. It is assumed that a virtual entropy source
is not a limiting, shared bandwidth resource (but a software DRBG).</p>
</div>
<div class="paragraph">
<p>DRBGs can be used to feed other (virtual) DRBGs, but that does not
increase the absolute amount of entropy in the system.
The entropy source must be able to support current and future security
standards and applications. The 256-bit requirement maps to
"Category 5" of NIST Post-Quantum Cryptography (4.A.5
"Security Strength Categories" in cite:[NI16]) and TOP SECRET schemes
in Suite B and the newer U.S. Government CNSA Suite cite:[NS15].</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_access"><a class="anchor" href="#crypto_scalar_appx_es_access"></a>Security Considerations for Direct Hardware Access</h5>
<div class="paragraph">
<p><a href="#crypto_scalar_es_access">Access Control to <code>seed</code></a>.</p>
</div>
<div class="paragraph">
<p>The ISA implementation and system design must try to ensure that the
hardware-software interface minimizes avenues for adversarial
information flow even if not explicitly forbidden in the specification.</p>
</div>
<div class="paragraph">
<p>For security, virtualization requires both conditioning and DRBG processing
of physical entropy output. It is recommended if a single physical entropy
source is shared between multiple different virtual machines or if the
guest OS is untrusted. A virtual entropy source is significantly more
resistant to depletion attacks and also lessens the risk from covert channels.</p>
</div>
<div class="paragraph">
<p>The direct <code>mseccfg.[s,u]seed</code> option allows one to draw a security boundary
around a component in relation to Sensitive Security Parameter (SSP) flows,
even if that component is not in M mode. This is
helpful when implementing trusted enclaves. Such modules can enforce the
entire key lifecycle from birth (in the entropy source) to death
(zeroization) to occur without the key being passed across the boundary
to external code.</p>
</div>
<div class="paragraph">
<p><strong>Depletion.</strong>
Active polling may deny the entropy source to another simultaneously
running consumer. This can (for example) delay the instantiation of that
virtual machine if it requires entropy to initialize fully.</p>
</div>
<div class="paragraph">
<p><strong>Covert Channels.</strong>
Direct access to a component such as the entropy source can be used to
establish communication channels across security boundaries. Active
polling from one consumer makes the resource unavailable WAIT instead of
ES16 to another (which is polling infrequently). Such interactions can
be used to establish low-bandwidth channels.</p>
</div>
<div class="paragraph">
<p><strong>Hardware Fingerprinting.</strong>
An entropy source (and its noise source circuits) may have a uniquely
identifiable hardware "signature." This can be harmless or even useful
in some applications (as random sources may exhibit Physically Un-clonable
Function (PUF) -like features)
but highly undesirable in others (anonymized virtualized environments
and enclaves). A DRBG masks such statistical features.</p>
</div>
<div class="paragraph">
<p><strong>Side Channels.</strong>
Some of the most devastating practical attacks against real-life
cryptosystems have used inconsequential-looking additional
information, such as padding error messages cite:[BaFoKa:12]
or timing information cite:[MoSuEi:20].</p>
</div>
<div class="paragraph">
<p>We urge implementers against creating unnecessary information flows
via status or custom bits or to allow any other mechanism to disable or
affect the entropy source output. All information flows and interaction
mechanisms must be considered from an adversarial viewpoint:
the fewer the better.</p>
</div>
<div class="paragraph">
<p>As an example of side-channel analysis, we note that the entropy
polling interface is typically not "constant time." One needs to
analyze what kind of information is revealed via the timing oracle;
one way of doing it is to model <code>seed</code> as a rejection
sampler. Such a timing oracle can reveal information about the noise
source type and entropy source usage, but not about the random output
<code>entropy</code> bits themselves. If it does, additional countermeasures are
necessary.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="crypto_scalar_es_security_controls"><a class="anchor" href="#crypto_scalar_es_security_controls"></a>Security Controls and Health Tests</h4>
<div class="paragraph">
<p>The primary purpose of a cryptographic entropy source is to produce
secret keying material. In almost all cases, a hardware entropy source
must implement appropriate <em>security controls</em> to guarantee
unpredictability, prevent leakage, detect attacks, and deny adversarial
control over the entropy output or ts generation mechanism. Explicit
security controls are required for security testing and certification.</p>
</div>
<div class="paragraph">
<p>Many of the security controls built into the device are called "health
checks." Health checks can take the form of integrity checks, start-up
tests, and on-demand tests. These tests can be implemented in hardware
or firmware, typically both. Several are mandated by standards such as
NIST SP 800-90B cite:[NI19].
The choice of appropriate health tests depends on the
certification target, system architecture, threat model, entropy
source type, and other factors.</p>
</div>
<div class="paragraph">
<p>Health checks are not intended for hardware diagnostics but for detecting
security issues. Hence the default action in case of a failure should be
aimed at damage control: Limiting further output and preventing weak
crypto keys from being generated.</p>
</div>
<div class="paragraph">
<p>We discuss three specific testing requirements T1-T3. The testing requirement
follows from the definition of an Entropy Source; without it, the module is
simply a noise source and can&#8217;t be trusted to safely generate keying material.</p>
</div>
<div class="sect4">
<h5 id="t1-on-demand-testing"><a class="anchor" href="#t1-on-demand-testing"></a>T1: On-demand testing</h5>
<div class="paragraph">
<p>A sequence of simple tests is invoked via resetting, rebooting, or
powering up the hardware (not an ISA signal). The implementation will
simply return <code>BIST</code> during the initial start-up self-test period;
in any case, the driver must wait for them to finish before starting
cryptographic operations. Upon failure, the entropy source will enter
a no-output <code>DEAD</code> state.</p>
</div>
<div class="paragraph">
<p><strong>Rationale.</strong>
Interaction with hardware self-test mechanisms
from the software side should be minimal; the term "on-demand" does not
mean that the end-user or application program should be able to invoke
them in the field (the term is a throwback to an age of discrete,
non-autonomous crypto devices with human operators).</p>
</div>
</div>
<div class="sect4">
<h5 id="t2-continuous-checks"><a class="anchor" href="#t2-continuous-checks"></a>T2: Continuous checks</h5>
<div class="paragraph">
<p>If an error is detected in continuous tests or
environmental sensors, the entropy source will enter a no-output state.
We define that a non-critical alarm is signaled if the entropy source
returns to <code>BIST</code> state from live (<code>WAIT</code> or <code>ES16</code>) states. Critical
failures will result in <code>DEAD</code> state immediately. A hardware-based
continuous testing mechanism must not make statistical information
externally available, and it must be zeroized periodically or upon
demand via reset, power-up, or similar signal.</p>
</div>
<div class="paragraph">
<p><strong>Rationale.</strong>
Physical attacks can occur while the device is running. The design
should avoid guiding such active attacks by revealing detailed
status information. Upon detection of an attack, the default action
should be aimed at damage control&#8201;&#8212;&#8201;to prevent weak crypto keys from
being generated.</p>
</div>
<div class="paragraph">
<p>The statistical nature of some tests makes "type-1" false
positives a possibility. There may also be requirements for signaling
of non-fatal alarms; AIS 31 specifies "noise alarms" that can go off
with non-negligible probability even if the device is functioning
correctly; these can be signaled with <code>BIST</code>.
There rarely is anything that can or should be done about a non-fatal
alarm condition in an operator-free, autonomous system.</p>
</div>
<div class="paragraph">
<p>The state of statistical runtime health checks (such as counters)
is potentially correlated with some secret keying material, hence
the zeroization requirement.</p>
</div>
</div>
<div class="sect4">
<h5 id="t3-fatal-error-states"><a class="anchor" href="#t3-fatal-error-states"></a>T3: Fatal error states</h5>
<div class="paragraph">
<p>Since the security of most cryptographic operations depends on the
entropy source, a system-wide "default deny" security policy approach
is appropriate for most entropy source failures. A hardware test failure
should at least result in the <code>DEAD</code> state and possibly reset/halt.
Itâ€™s a show stopper: The entropy source (or its cryptographic client
application) <em>must not</em> be allowed to run if its secure operation
canâ€™t be guaranteed.</p>
</div>
<div class="paragraph">
<p><strong>Rationale.</strong>
These tests can complement other integrity and tamper resistance
mechanisms (See Chapter 18 of cite:[An20] for examples).</p>
</div>
<div class="paragraph">
<p>Some hardware random generators are, by their physical construction,
exposed to relatively non-adversarial environmental and manufacturing
issues. However, even such  "innocent" failure modes may indicate
a  <em>fault attack</em> cite:[KaScVe13] and therefore should be addressed
as a system integrity failure rather than as a diagnostic issue.</p>
</div>
<div class="paragraph">
<p>Security architects will understand to use
permanent or hard-to-recover "security-fuse" lockdowns only if the
threshold of a test is such that the probability of false-positive is
negligible over the entire device lifetime.</p>
</div>
</div>
<div class="sect4">
<h5 id="information-flows"><a class="anchor" href="#information-flows"></a>Information Flows</h5>
<div class="paragraph">
<p>Some of the most devastating practical attacks
against real-life cryptosystems have used inconsequential-looking
additional information, such as padding error messages cite:[BaFoKa:12]
or timing information cite:[MoSuEi:20]. In cryptography, such
out-of-band information sources  are called "oracles."</p>
</div>
<div class="paragraph">
<p>To guarantee that no sensitive data is read twice and that different
callers donâ€™t get correlated output, it is required that hardware
implements <em>wipe-on-read</em> on the randomness pathway during each read
(successful poll). For the same reasons, only complete and fully
processed random words shall be made available via <code>entropy</code> (ES16 status
of <code>seed</code>).</p>
</div>
<div class="paragraph">
<p>This also applies to the raw noise source. The raw source interface has
been delegated to an optional vendor-specific test interface.
Importantly the test interface and the main interface should not be
operational at the same time.</p>
</div>
<div class="quoteblock">
<blockquote>
The noise source state shall be protected from adversarial
knowledge or influence to the greatest extent possible. The methods
used for this shall be documented, including a description of the
(conceptual) security boundary&#8217;s role in protecting the noise source
from adversarial observation or influence.
</blockquote>
<div class="attribution">
&#8212; NIST SP 800-90B<br>
<cite>Noise Source Requirements</cite>
</div>
</div>
<div class="paragraph">
<p>An entropy source is a singular resource, subject to depletion
and also covert channels cite:[EvPo16]. Observation of the entropy
can be the same as the observation of the noise source output, as
cryptographic conditioning is mandatory only as a post-processing step.
SP 800-90B and other security standards mandate protection of
noise bits from observation and also influence.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="crypto_scalar_appx_es_implementation"><a class="anchor" href="#crypto_scalar_appx_es_implementation"></a>Implementation Strategies</h4>
<div class="paragraph">
<p>As a general rule, RISC-V specifies the ISA only. We provide some
additional suggestions so that portable, vendor-independent middleware
and kernel components can be created. The actual hardware implementation
and certification are left to vendors and circuit designers;
the discussion in this Section is purely informational.</p>
</div>
<div class="paragraph">
<p>When considering implementation options and trade-offs, one must look
at the entire information flow.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>A Noise Source</strong> generates private, unpredictable signals
from stable and well-understood physical random events.</p>
</li>
<li>
<p><strong>Sampling</strong> digitizes the noise signal into a raw stream of
bits. This raw data also needs to be protected by the design.</p>
</li>
<li>
<p><strong>Continuous health tests</strong> ensure that the noise source
and its environment meet their operational parameters.</p>
</li>
<li>
<p><strong>Non-cryptographic conditioners</strong> remove much of the bias
and correlation in input noise.</p>
</li>
<li>
<p><strong>Cryptographic conditioners</strong> produce full entropy
output, completely indistinguishable from ideal random.</p>
</li>
<li>
<p><strong>DRBG</strong> takes in <code>&gt;=256</code> bits of seed entropy as keying
material and uses a "one way" cryptographic process to rapidly
generate bits on demand (without revealing the seed/state).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Steps 1-4 (possibly 5) are considered to be part of the Entropy
Source (ES) and provided by the <code>seed</code> CSR.
Adding the software-side cryptographic steps 5-6 and control logic
complements it into a True Random Number Generator (TRNG).</p>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_noise_sources"><a class="anchor" href="#crypto_scalar_appx_es_noise_sources"></a>Ring Oscillators</h5>
<div class="paragraph">
<p>We will give some examples of common noise sources that can be
implemented in the processor itself (using standard cells).</p>
</div>
<div class="paragraph">
<p>The most common entropy source type in production use today is
based on "free running" ring oscillators and their timing jitter.
Here, an odd number of inverters is connected into a loop from which
noise source bits are sampled in relation to a reference clock
cite:[BaLuMi:11]. The sampled bit sequence may be expected to be
relatively uncorrelated (close to IID) if the sample rate is suitably low
cite:[KiSc11]. However, further processing is usually required.</p>
</div>
<div class="paragraph">
<p>AMD cite:[AM17], ARM cite:[AR17], and IBM cite:[LiBaBo:13] are
examples of ring oscillator TRNGs intended for high-security
applications.</p>
</div>
<div class="paragraph">
<p>There are related metastability-based generator designs such as
Transition Effect Ring Oscillator (TERO) cite:[VaDr10].
The differential/feedback Intel construction cite:[HaKoMa12] is slightly
different but also falls into the same general metastable
oscillator-based category.</p>
</div>
<div class="paragraph">
<p>The main benefits of ring oscillators are: (1) They can be implemented
with standard cell libraries without external components&#8201;&#8212;&#8201;and even on FPGAs cite:[VaFiAu:10], (2) there is an established theory
for their behavior cite:[HaLe98,HaLiLe99,BaLuMi:11], and (3) ample
precedent exists for testing and certifying them at the highest security
levels.</p>
</div>
<div class="paragraph">
<p>Ring oscillators also have well-known implementation pitfalls.
Their output is sometimes highly dependent on temperature,
which must be taken into account in testing and modeling.
If the ring oscillator construction is parallelized, it is important
that the number of stages and/or inverters in each chain is suitable to
avoid entropy reduction due to harmonic "Huyghens synchronization"
cite:[Ba86].
Such harmonics can also be inserted maliciously in a frequency
injection attack, which can have devastating results cite:[MaMo09].
Countermeasures are related to circuit design; environmental sensors,
electrical filters, and usage of a differential oscillator may help.</p>
</div>
</div>
<div class="sect4">
<h5 id="shot-noise"><a class="anchor" href="#shot-noise"></a>Shot Noise</h5>
<div class="paragraph">
<p>A category of random sources consisting of discrete events
and modeled as a Poisson process is called "shot noise."
There&#8217;s a long-established precedent of certifying them; the
AIS 31 document cite:[KiSc11] itself offers reference designs based on
noisy diodes. Shot noise sources are often more resistant to
temperature changes than ring oscillators.
Some of these generators can also be fully implemented with standard
cells (The Rambus / Inside Secure generic TRNG IP cite:[Ra20] is
described as a Shot Noise generator).</p>
</div>
</div>
<div class="sect4">
<h5 id="other-types-of-noise"><a class="anchor" href="#other-types-of-noise"></a>Other types of noise</h5>
<div class="paragraph">
<p>It may be possible to certify more exotic noise sources and designs,
although their stochastic model needs to be equally well understood,
and their CPU interfaces must be secure.
See <a href="#crypto_scalar_appx_es_quantum">Quantum vs. Classical Random</a> for a discussion of Quantum
entropy sources.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_cont-tests"><a class="anchor" href="#crypto_scalar_appx_es_cont-tests"></a>Continuous Health Tests</h5>
<div class="paragraph">
<p>Health monitoring requires some state information related
to the noise source to be maintained. The tests should be designed
in a way that a specific number of samples guarantees a state
flush (no hung states). We suggest flush size <code>W =&lt; 1024</code> to
match with the NIST SP 800-90B required tests (See Section 4.4 in
cite:[TuBaKe:18]). The state is also fully zeroized in a system reset.</p>
</div>
<div class="paragraph">
<p>The two mandatory tests can be built with minimal circuitry.
Full histograms are not required, only simple counter registers:
repetition count, window count, and sample count.
Repetition count is reset every time the output sample value
changes; if the count reaches a certain cutoff limit, a noise alarm
(<code>BIST</code>) or failure (<code>DEAD</code>) is signaled. The window counter is
used to save every W&#8217;th output (typically <code>W</code> in { 512, 1024 }).
The frequency of this reference sample in the following window is
counted; cutoff values are defined in the standard. We see that the
structure of the mandatory tests is such that, if well implemented,
no information is carried beyond a limit of <code>W</code> samples.</p>
</div>
<div class="paragraph">
<p>Section 4.5 of cite:[TuBaKe:18] explicitly permits additional
developer-defined tests, and several more were defined in early
versions of FIPS 140-1 before being "crossed out." The choice
of additional tests depends on the nature and implementation of the
physical source.</p>
</div>
<div class="paragraph">
<p>Especially if a non-cryptographic conditioner is used in hardware,
it is possible that the AIS 31 cite:[KiSc11] online tests are
implemented by driver software. They can also be implemented in hardware.
For some security profiles, AIS 31 mandates that their tolerances are
set in a way that the probability of an alarm is at least 10<sup>-6</sup>
yearly under "normal usage." Such requirements are problematic
in modern applications since their probability is too high for
critical systems.</p>
</div>
<div class="paragraph">
<p>There rarely is anything that can or should be done about a non-fatal
alarm condition in an operator-free, autonomous system. However,
AIS 31 allows the DRBG component to keep running despite a failure in
its Entropy Source, so we suggest re-entering a temporary <code>BIST</code>
state (<a href="#crypto_scalar_es_security_controls">Security Controls and Health Tests</a>) to signal a non-fatal
statistical error if such (non-actionable) signaling is necessary.
Drivers and applications can react to this appropriately (or simply
log it), but it will not directly affect the availability of the TRNG.
A permanent error condition should result in <code>DEAD</code> state.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_noncrypto"><a class="anchor" href="#crypto_scalar_appx_es_noncrypto"></a>Non-cryptographic Conditioners</h5>
<div class="paragraph">
<p>As noted in <a href="#crypto_scalar_appx_es_intro-cond">Conditioning: Cryptographic and Non-Cryptographic</a>, physical randomness
sources generally require a post-processing step called <em>conditioning</em> to
meet the desired quality requirements, which  are outlined in
<a href="#crypto_scalar_es_req">Entropy Source Requirements</a>.</p>
</div>
<div class="paragraph">
<p>The approach taken in this interface is to allow a combination of
non-cryptographic and cryptographic filtering to take place. The
first stage (hardware) merely needs to be able to distill the entropy
comfortably above the necessary level.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One may take a set of bits from a noise source and XOR them
together to produce a less biased (and more independent) bit.
However, such an XOR may introduce "pseudorandomness" and
make the output difficult to analyze.</p>
</li>
<li>
<p>The von Neumann extractor cite:[Ne51] looks at consecutive
pairs of bits, rejects 00 and 11, and outputs 0 or 1 for
01 and 10, respectively. It will reduce the number of bits to
less than 25% of the original, but the output is provably unbiased
(assuming independence).</p>
</li>
<li>
<p>Blum&#8217;s extractor cite:[Bl86] can be used on sources
whose behavior resembles N-state Markov chains. If its
assumptions hold, it also removes dependencies, creating an
independent and identically distributed (IID) source.</p>
</li>
<li>
<p>Other linear and non-linear correctors such as those
discussed by Dichtl and Lacharme cite:[La08].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the hardware may also implement a full cryptographic conditioner
in the entropy source, even though the software driver still needs
a cryptographic conditioner, too (<a href="#crypto_scalar_es_req">Entropy Source Requirements</a>).</p>
</div>
<div class="paragraph">
<p><strong>Rationale:</strong>
The main advantage of non-cryptographic extractors is in their
energy efficiency, relative simplicity, and amenability to mathematical
analysis. If well designed, they can be evaluated in
conjunction with a stochastic model of the noise source itself.
They do not require computational hardness assumptions.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_crypto-cond"><a class="anchor" href="#crypto_scalar_appx_es_crypto-cond"></a>Cryptographic Conditioners</h5>
<div class="paragraph">
<p>For secure use, cryptographic conditioners are always required on the
software side of the ISA boundary. They may also be implemented on the
hardware side if necessary. In any case, the <code>entropy</code> ES16 output must
always be compressed 2:1 (or more) before being used as keying material
or considered "full entropy."</p>
</div>
<div class="paragraph">
<p>Examples of cryptographic conditioners include the random pool of the
Linux operating system, secure hash functions (SHA-2/3, SHAKE
cite:[nist:fips:202,nist:fips:180:4]), and the AES / CBC-MAC
construction in Appendix F, SP 800-90B cite:[TuBaKe:18].</p>
</div>
<div class="paragraph">
<p>In some constructions, such as the Linux RNG and SHA-3/SHAKE
cite:[nist:fips:202] based generators, the cryptographic conditioning
and output (DRBG) generation are provided by the same component.</p>
</div>
<div class="paragraph">
<p><strong>Rationale:</strong>
For many low-power targets constructions the type of hardware AES CBC-MAC
conditioner used by Intel cite:[Me18] and AMD cite:[AM17] would be too
complex and energy-hungry to implement solely to serve the <code>seed</code> CSR.
On the other hand, simpler non-cryptographic conditioners may be too
wasteful on input entropy if high-quality random output is required&#8201;&#8212;&#8201;(ARM TrustZone TRBG cite:[AR17] outputs only 10Kbit/sec at 200 MHz.)
Hence a resource-saving compromise is made between hardware and software
generation.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_drbgs"><a class="anchor" href="#crypto_scalar_appx_es_drbgs"></a>The Final Random: DRBGs</h5>
<div class="paragraph">
<p>All random bits reaching end users and applications must come from a
cryptographic DRBG. These are generally implemented by the driver
component in software. The RISC-V AES and SHA instruction set extensions
should be used if available since they offer additional
security features such as timing attack resistance.</p>
</div>
<div class="paragraph">
<p>Currently recommended DRBGs are defined in NIST SP 800-90A (Rev 1)
cite:[BaKe15]: <code>CTR_DRBG</code>, <code>Hash_DRBG</code>, and <code>HMAC_DRBG</code>.
Certification often requires known answer tests (KATs) for the symmetric
components and the DRBG as a whole. These are significantly easier to
implement in software than in hardware. In addition to the directly
certifiable SP 800-90A DRBGs, a Linux-style random pool construction
based on ChaCha20 cite:[Mu20] can be used, or an appropriate construction
based on SHAKE256 cite:[nist:fips:202].</p>
</div>
<div class="paragraph">
<p>These are just recommendations; programmers can adjust the usage of the
CPU Entropy Source to meet future requirements.</p>
</div>
</div>
<div class="sect4">
<h5 id="crypto_scalar_appx_es_quantum"><a class="anchor" href="#crypto_scalar_appx_es_quantum"></a>Quantum vs. Classical Random</h5>
<div class="quoteblock">
<blockquote>
The NCSC believes that classical RNGs will continue to
meet our needs for government and military applications for the
foreseeable future.
</blockquote>
<div class="attribution">
&#8212; U.K. NCSC QRNG Guidance<br>
<cite>March 2020</cite>
</div>
</div>
<div class="paragraph">
<p>A Quantum Random Number Generator (QRNG) is a TRNG whose source of
randomness can be unambiguously identified to be a specific
quantum phenomenon such as quantum state superposition, quantum state
entanglement, Heisenberg uncertainty, quantum tunneling, spontaneous
emission, or radioactive decay cite:[IT19].</p>
</div>
<div class="paragraph">
<p>Direct quantum entropy is theoretically the best possible kind of
entropy. A typical TRNG based on electronic noise is also largely
based on quantum phenomena and is equally unpredictable - the difference
is that the relative amount of quantum and classical physics involved is
difficult to quantify for a classical TRNG.</p>
</div>
<div class="paragraph">
<p>QRNGs are designed in a way that allows the amount of quantum-origin
entropy to be modeled and estimated. This distinction is important in
the security model used by QKD (Quantum Key Distribution) security
mechanisms which can be used to protect the physical layer (such as
fiber optic cables) against interception by using quantum mechanical
effects directly.</p>
</div>
<div class="paragraph">
<p>This security model means that many of the available QRNG devices do
not use cryptographic conditioning and may fail cryptographic statistical
requirements cite:[HuHe20]. Many implementers may consider them to be
entropy sources instead.</p>
</div>
<div class="paragraph">
<p>Relatively little research has gone into QRNG implementation security,
but many QRNG designs are arguably more susceptible to leakage than
classical generators (such as ring oscillators) as they tend to employ
external components and mixed materials. As an example, amplification of
a photon detector signal may be observable in power analysis,
which classical noise-based sources are designed to resist.</p>
</div>
</div>
<div class="sect4">
<h5 id="post-quantum-cryptography"><a class="anchor" href="#post-quantum-cryptography"></a>Post-Quantum Cryptography</h5>
<div class="paragraph">
<p>PQC public-key cryptography standards cite:[NI16] do not require
quantum-origin randomness, just sufficiently secure keying material.
Recall that cryptography aims to protect the confidentiality and
integrity of data itself and does not place any requirements on
the physical communication channel (like QKD).</p>
</div>
<div class="paragraph">
<p>Classical good-quality TRNGs are perfectly suitable
for generating the secret keys for PQC protocols that are hard for
quantum computers to break but implementable on classical computers.
What matters in cryptography is that the secret keys have enough true
randomness (entropy) and that they are generated and stored securely.</p>
</div>
<div class="paragraph">
<p>Of course, one must avoid DRBGs that are based on problems that are
easily solvable with quantum computers, such as factoring cite:[Sh94]
in the case of the Blum-Blum-Shub generator cite:[BlBlSh86].
Most symmetric algorithms are not affected as the best quantum
attacks are still exponential to key size cite:[Gr96].</p>
</div>
<div class="paragraph">
<p>As an example, the original Intel RNG cite:[Me18], whose output generation
is based on AES-128, can be attacked using Grover&#8217;s algorithm
with approximately square-root effort cite:[JaNaRo:20].
While even "64-bit" quantum security is extremely difficult to
break, many applications specify a higher security requirement.
NIST cite:[NI16] defines AES-128 to be "Category 1" equivalent
post-quantum security, while AES-256 is "Category 5" (highest).
We avoid this possible future issue by exposing direct access
to the entropy source which can derive its security from
information-theoretic assumptions only.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="crypto_scalar_es_getnoise"><a class="anchor" href="#crypto_scalar_es_getnoise"></a>Suggested GetNoise Test Interface</h4>
<div class="paragraph">
<p>Compliance testing, characterization, and configuration of entropy sources
require access to raw, unconditioned noise samples. This conceptual test
interface is named GetNoise in Section 2.3.2 of NIST SP 800-90B
cite:[TuBaKe:18].</p>
</div>
<div class="paragraph">
<p>Since this type of interface is both necessary for security testing
and also constitutes a potential backdoor to the cryptographic key generation
process, we define a safety behavior that compliant implementations can
have for temporarily disabling the entropy source <code>seed</code> CSR interface during
test.</p>
</div>
<div class="paragraph">
<p>In order for shared RISC-V self-certification scripts (and drivers) to
accommodate the test interface in a secure fashion, we suggest that it is
implemented as a custom, M-mode only CSR, denoted here as <code>mnoise</code>.</p>
</div>
<div class="paragraph">
<p>This non-normative interface is not intended to be used as a source of
randomness or for other production use.
We define the semantics for single bit for this interface, <code>mnoise[31]</code>,
which is named <code>NOISE_TEST</code>, which will affect the behavior of <code>seed</code>
if implemented.</p>
</div>
<div class="paragraph">
<p>When <code>NOISE_TEST = 1</code> in <code>mnoise</code>, the <code>seed</code> CSR must not return
anything via <code>ES16</code>; it should be in <code>BIST</code> state unless the source
is <code>DEAD</code>. When <code>NOISE_TEST</code> is again disabled, the entropy source
shall return from <code>BIST</code> via an appropriate zeroization and self-test
mechanism.</p>
</div>
<div class="paragraph">
<p>The behavior of other input and output bits is largely left to the vendor
(as they depend on the technical details of the physical entropy source),
as is the address of the custom <code>mnoise</code> CSR. Other contents and behavior of the
CSR only can be interpreted in the context of <code>mvendorid</code>, <code>marchid</code>, and
<code>mimpid</code> CSR identifiers.</p>
</div>
<div class="paragraph">
<p>When not implemented (e.g., in virtual machines), <code>mnoise</code> can permanently
read zero (<code>0x00000000</code>) and ignore writes.
When available, but <code>NOISE_TEST = 0</code>, <code>mnoise</code> can return a
nonzero constant (e.g. <code>0x00000001</code>) but no noise samples.</p>
</div>
<div id="crypto_scalar_es_noistest" class="exampleblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="_images/es_noisetest.svg" alt="es noisetest">
</div>
<div class="title">Figure 2. Entropy source can&#8217;t be read in test mode.</div>
</div>
<div class="paragraph">
<p>In <code>NOISE_TEST</code> mode, the WAIT and ES16 states are unreachable,
and no entropy is output. Implementation of test interfaces that directly
affect ES16 entropy output from the <code>seed</code> CSR interface is discouraged.
Such vendor test interfaces have been exploited in attacks. For example,
an ECDSA cite:[nist:fips:186:4] signature process without sufficient
entropy will not only create an insecure signature but can also reveal
the secret signing key, that can be used for authentication forgeries by
attackers. Hence even a temporary lapse in <code>entropy</code> security may have serious
security implications.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crypto_scalar_appx_materials"><a class="anchor" href="#crypto_scalar_appx_materials"></a>Supplementary Materials</h3>
<div class="paragraph">
<p>While this document contains the specifications for the RISC-V cryptography
extensions, numerous supplementary materials and example codes have
also been developed.
All of the materials related to the RISC-V Cryptography
extension live in a GitHub Repository, located at
<a href="https://github.com/riscv/riscv-crypto" class="bare">https://github.com/riscv/riscv-crypto</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>doc/</code>
Contains the source code for this document.</p>
</li>
<li>
<p><code>doc/supp/</code>
Contains supplementary information and recommendations for implementers of
software and hardware.</p>
</li>
<li>
<p><code>benchmarks/</code>
Example software implementations.</p>
</li>
<li>
<p><code>rtl/</code>
Example Verilog implementations of each instruction.</p>
</li>
<li>
<p><code>sail/</code>
Formal model implementations in Sail.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="crypto_scalar_appx_sail"><a class="anchor" href="#crypto_scalar_appx_sail"></a>Supporting Sail Code</h3>
<div class="paragraph">
<p>This section contains the supporting Sail code referenced by the
instruction descriptions throughout the specification.
The
<a href="https://alasdair.github.io/manual.html">Sail Manual</a>
is recommended reading in order to best understand the supporting code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sail hljs" data-lang="sail">/* Auxiliary function for performing GF multiplication */
val xt2 : bits(8) -&gt; bits(8)
function xt2(x) = {
  (x &lt;&lt; 1) ^ (if bit_to_bool(x[7]) then 0x1b else 0x00)
}

val xt3 : bits(8) -&gt; bits(8)
function xt3(x) = x ^ xt2(x)

/* Multiply 8-bit field element by 4-bit value for AES MixCols step */
val gfmul : (bits(8), bits(4)) -&gt; bits(8)
function gfmul( x, y) = {
  (if bit_to_bool(y[0]) then             x    else 0x00) ^
  (if bit_to_bool(y[1]) then xt2(        x)   else 0x00) ^
  (if bit_to_bool(y[2]) then xt2(xt2(    x))  else 0x00) ^
  (if bit_to_bool(y[3]) then xt2(xt2(xt2(x))) else 0x00)
}

/* 8-bit to 32-bit partial AES Mix Column - forwards */
val aes_mixcolumn_byte_fwd : bits(8) -&gt; bits(32)
function aes_mixcolumn_byte_fwd(so) = {
  gfmul(so, 0x3) @ so @ so @ gfmul(so, 0x2)
}

/* 8-bit to 32-bit partial AES Mix Column - inverse*/
val aes_mixcolumn_byte_inv : bits(8) -&gt; bits(32)
function aes_mixcolumn_byte_inv(so) = {
  gfmul(so, 0xb) @ gfmul(so, 0xd) @ gfmul(so, 0x9) @ gfmul(so, 0xe)
}

/* 32-bit to 32-bit AES forward MixColumn */
val aes_mixcolumn_fwd : bits(32) -&gt; bits(32)
function aes_mixcolumn_fwd(x) = {
  let s0 : bits (8) = x[ 7.. 0];
  let s1 : bits (8) = x[15.. 8];
  let s2 : bits (8) = x[23..16];
  let s3 : bits (8) = x[31..24];
  let b0 : bits (8) = xt2(s0) ^ xt3(s1) ^    (s2) ^    (s3);
  let b1 : bits (8) =    (s0) ^ xt2(s1) ^ xt3(s2) ^    (s3);
  let b2 : bits (8) =    (s0) ^    (s1) ^ xt2(s2) ^ xt3(s3);
  let b3 : bits (8) = xt3(s0) ^    (s1) ^    (s2) ^ xt2(s3);
  b3 @ b2 @ b1 @ b0 /* Return value */
}

/* 32-bit to 32-bit AES inverse MixColumn */
val aes_mixcolumn_inv : bits(32) -&gt; bits(32)
function aes_mixcolumn_inv(x) = {
  let s0 : bits (8) = x[ 7.. 0];
  let s1 : bits (8) = x[15.. 8];
  let s2 : bits (8) = x[23..16];
  let s3 : bits (8) = x[31..24];
  let b0 : bits (8) = gfmul(s0, 0xE) ^ gfmul(s1, 0xB) ^ gfmul(s2, 0xD) ^ gfmul(s3, 0x9);
  let b1 : bits (8) = gfmul(s0, 0x9) ^ gfmul(s1, 0xE) ^ gfmul(s2, 0xB) ^ gfmul(s3, 0xD);
  let b2 : bits (8) = gfmul(s0, 0xD) ^ gfmul(s1, 0x9) ^ gfmul(s2, 0xE) ^ gfmul(s3, 0xB);
  let b3 : bits (8) = gfmul(s0, 0xB) ^ gfmul(s1, 0xD) ^ gfmul(s2, 0x9) ^ gfmul(s3, 0xE);
  b3 @ b2 @ b1 @ b0 /* Return value */
}

/* Turn a round number into a round constant for AES. Note that the
   AES64KS1I instruction is defined such that the r argument is always
   in the range 0x0..0xA. Values of rnum outside the range 0x0..0xA
   do not decode to the AES64KS1I instruction. The 0xA case is used
   specifically for the AES-256 KeySchedule, and this function is never
   called in that case. */
val aes_decode_rcon : bits(4) -&gt; bits(32)
function aes_decode_rcon(r) = {
  assert(r &lt;_u 0xA);
  match r {
    0x0 =&gt; 0x00000001,
    0x1 =&gt; 0x00000002,
    0x2 =&gt; 0x00000004,
    0x3 =&gt; 0x00000008,
    0x4 =&gt; 0x00000010,
    0x5 =&gt; 0x00000020,
    0x6 =&gt; 0x00000040,
    0x7 =&gt; 0x00000080,
    0x8 =&gt; 0x0000001b,
    0x9 =&gt; 0x00000036,
    _   =&gt; internal_error(__FILE__, __LINE__, "Unexpected AES r") /* unreachable -- required to silence Sail warning */
  }
}

/* SM4 SBox - only one sbox for forwards and inverse */
let sm4_sbox_table : vector(256, bits(8)) = [
0xD6, 0x90, 0xE9, 0xFE, 0xCC, 0xE1, 0x3D, 0xB7, 0x16, 0xB6, 0x14, 0xC2, 0x28,
0xFB, 0x2C, 0x05, 0x2B, 0x67, 0x9A, 0x76, 0x2A, 0xBE, 0x04, 0xC3, 0xAA, 0x44,
0x13, 0x26, 0x49, 0x86, 0x06, 0x99, 0x9C, 0x42, 0x50, 0xF4, 0x91, 0xEF, 0x98,
0x7A, 0x33, 0x54, 0x0B, 0x43, 0xED, 0xCF, 0xAC, 0x62, 0xE4, 0xB3, 0x1C, 0xA9,
0xC9, 0x08, 0xE8, 0x95, 0x80, 0xDF, 0x94, 0xFA, 0x75, 0x8F, 0x3F, 0xA6, 0x47,
0x07, 0xA7, 0xFC, 0xF3, 0x73, 0x17, 0xBA, 0x83, 0x59, 0x3C, 0x19, 0xE6, 0x85,
0x4F, 0xA8, 0x68, 0x6B, 0x81, 0xB2, 0x71, 0x64, 0xDA, 0x8B, 0xF8, 0xEB, 0x0F,
0x4B, 0x70, 0x56, 0x9D, 0x35, 0x1E, 0x24, 0x0E, 0x5E, 0x63, 0x58, 0xD1, 0xA2,
0x25, 0x22, 0x7C, 0x3B, 0x01, 0x21, 0x78, 0x87, 0xD4, 0x00, 0x46, 0x57, 0x9F,
0xD3, 0x27, 0x52, 0x4C, 0x36, 0x02, 0xE7, 0xA0, 0xC4, 0xC8, 0x9E, 0xEA, 0xBF,
0x8A, 0xD2, 0x40, 0xC7, 0x38, 0xB5, 0xA3, 0xF7, 0xF2, 0xCE, 0xF9, 0x61, 0x15,
0xA1, 0xE0, 0xAE, 0x5D, 0xA4, 0x9B, 0x34, 0x1A, 0x55, 0xAD, 0x93, 0x32, 0x30,
0xF5, 0x8C, 0xB1, 0xE3, 0x1D, 0xF6, 0xE2, 0x2E, 0x82, 0x66, 0xCA, 0x60, 0xC0,
0x29, 0x23, 0xAB, 0x0D, 0x53, 0x4E, 0x6F, 0xD5, 0xDB, 0x37, 0x45, 0xDE, 0xFD,
0x8E, 0x2F, 0x03, 0xFF, 0x6A, 0x72, 0x6D, 0x6C, 0x5B, 0x51, 0x8D, 0x1B, 0xAF,
0x92, 0xBB, 0xDD, 0xBC, 0x7F, 0x11, 0xD9, 0x5C, 0x41, 0x1F, 0x10, 0x5A, 0xD8,
0x0A, 0xC1, 0x31, 0x88, 0xA5, 0xCD, 0x7B, 0xBD, 0x2D, 0x74, 0xD0, 0x12, 0xB8,
0xE5, 0xB4, 0xB0, 0x89, 0x69, 0x97, 0x4A, 0x0C, 0x96, 0x77, 0x7E, 0x65, 0xB9,
0xF1, 0x09, 0xC5, 0x6E, 0xC6, 0x84, 0x18, 0xF0, 0x7D, 0xEC, 0x3A, 0xDC, 0x4D,
0x20, 0x79, 0xEE, 0x5F, 0x3E, 0xD7, 0xCB, 0x39, 0x48
]

let aes_sbox_fwd_table : vector(256, bits(8)) = [
0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe,
0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4,
0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7,
0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7, 0x23, 0xc3,
0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, 0x09,
0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3,
0x2f, 0x84, 0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe,
0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85,
0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92,
0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c,
0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19,
0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14,
0xde, 0x5e, 0x0b, 0xdb, 0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2,
0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5,
0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, 0xba, 0x78, 0x25,
0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a,
0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86,
0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e,
0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, 0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42,
0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16
]

let aes_sbox_inv_table : vector(256, bits(8)) = [
0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81,
0xf3, 0xd7, 0xfb, 0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e,
0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, 0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23,
0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, 0x08, 0x2e, 0xa1, 0x66,
0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, 0x72,
0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65,
0xb6, 0x92, 0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46,
0x57, 0xa7, 0x8d, 0x9d, 0x84, 0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a,
0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, 0xd0, 0x2c, 0x1e, 0x8f, 0xca,
0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, 0x3a, 0x91,
0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6,
0x73, 0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8,
0x1c, 0x75, 0xdf, 0x6e, 0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f,
0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, 0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2,
0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, 0x1f, 0xdd, 0xa8,
0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f,
0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93,
0xc9, 0x9c, 0xef, 0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb,
0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6,
0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d
]

/* Lookup function - takes an index and a table, and retrieves the
 * x'th element of that table. Note that the Sail vector literals
 * start at index 255, and go down to 0.
 */
val sbox_lookup : (bits(8), vector(256, bits(8))) -&gt; bits(8)
function sbox_lookup(x, table) = {
  table[255 - unsigned(x)]
}

/* Easy function to perform a forward AES SBox operation on 1 byte. */
val aes_sbox_fwd : bits(8) -&gt; bits(8)
function aes_sbox_fwd(x) = sbox_lookup(x, aes_sbox_fwd_table)

/* Easy function to perform an inverse AES SBox operation on 1 byte. */
val aes_sbox_inv : bits(8) -&gt; bits(8)
function aes_sbox_inv(x) = sbox_lookup(x, aes_sbox_inv_table)

/* AES SubWord function used in the key expansion
 * - Applies the forward sbox to each byte in the input word.
 */
val aes_subword_fwd : bits(32) -&gt; bits(32)
function aes_subword_fwd(x) = {
  aes_sbox_fwd(x[31..24]) @
  aes_sbox_fwd(x[23..16]) @
  aes_sbox_fwd(x[15.. 8]) @
  aes_sbox_fwd(x[ 7.. 0])
}

/* AES Inverse SubWord function.
 * - Applies the inverse sbox to each byte in the input word.
 */
val aes_subword_inv : bits(32) -&gt; bits(32)
function aes_subword_inv(x) = {
  aes_sbox_inv(x[31..24]) @
  aes_sbox_inv(x[23..16]) @
  aes_sbox_inv(x[15.. 8]) @
  aes_sbox_inv(x[ 7.. 0])
}

/* Easy function to perform an SM4 SBox operation on 1 byte. */
val sm4_sbox : bits(8) -&gt; bits(8)
function sm4_sbox(x) = sbox_lookup(x, sm4_sbox_table)

val aes_get_column : (bits(128), nat) -&gt; bits(32)
function aes_get_column(state,c) = (state &gt;&gt; (to_bits(7, 32 * c)))[31..0]

/* 64-bit to 64-bit function which applies the AES forward sbox to each byte
 * in a 64-bit word.
 */
val aes_apply_fwd_sbox_to_each_byte : bits(64) -&gt; bits(64)
function aes_apply_fwd_sbox_to_each_byte(x) = {
  aes_sbox_fwd(x[63..56]) @
  aes_sbox_fwd(x[55..48]) @
  aes_sbox_fwd(x[47..40]) @
  aes_sbox_fwd(x[39..32]) @
  aes_sbox_fwd(x[31..24]) @
  aes_sbox_fwd(x[23..16]) @
  aes_sbox_fwd(x[15.. 8]) @
  aes_sbox_fwd(x[ 7.. 0])
}

/* 64-bit to 64-bit function which applies the AES inverse sbox to each byte
 * in a 64-bit word.
 */
val aes_apply_inv_sbox_to_each_byte : bits(64) -&gt; bits(64)
function aes_apply_inv_sbox_to_each_byte(x) = {
  aes_sbox_inv(x[63..56]) @
  aes_sbox_inv(x[55..48]) @
  aes_sbox_inv(x[47..40]) @
  aes_sbox_inv(x[39..32]) @
  aes_sbox_inv(x[31..24]) @
  aes_sbox_inv(x[23..16]) @
  aes_sbox_inv(x[15.. 8]) @
  aes_sbox_inv(x[ 7.. 0])
}

/*
 * AES full-round transformation functions.
 */

val getbyte : (bits(64), int) -&gt; bits(8)
function getbyte(x, i) = (x &gt;&gt; to_bits(6, i * 8))[7..0]

val aes_rv64_shiftrows_fwd : (bits(64), bits(64)) -&gt; bits(64)
function aes_rv64_shiftrows_fwd(rs2, rs1) = {
  getbyte(rs1, 3) @
  getbyte(rs2, 6) @
  getbyte(rs2, 1) @
  getbyte(rs1, 4) @
  getbyte(rs2, 7) @
  getbyte(rs2, 2) @
  getbyte(rs1, 5) @
  getbyte(rs1, 0)
}

val aes_rv64_shiftrows_inv : (bits(64), bits(64)) -&gt; bits(64)
function aes_rv64_shiftrows_inv(rs2, rs1) = {
  getbyte(rs2, 3) @
  getbyte(rs2, 6) @
  getbyte(rs1, 1) @
  getbyte(rs1, 4) @
  getbyte(rs1, 7) @
  getbyte(rs2, 2) @
  getbyte(rs2, 5) @
  getbyte(rs1, 0)
}

/* 128-bit to 128-bit implementation of the forward AES ShiftRows transform.
 * Byte 0 of state is input column 0, bits  7..0.
 * Byte 5 of state is input column 1, bits 15..8.
 */
val aes_shift_rows_fwd : bits(128) -&gt; bits(128)
function aes_shift_rows_fwd(x) = {
  let ic3 : bits(32) = aes_get_column(x, 3);
  let ic2 : bits(32) = aes_get_column(x, 2);
  let ic1 : bits(32) = aes_get_column(x, 1);
  let ic0 : bits(32) = aes_get_column(x, 0);
  let oc0 : bits(32) = ic0[31..24] @ ic1[23..16] @ ic2[15.. 8] @ ic3[ 7.. 0];
  let oc1 : bits(32) = ic1[31..24] @ ic2[23..16] @ ic3[15.. 8] @ ic0[ 7.. 0];
  let oc2 : bits(32) = ic2[31..24] @ ic3[23..16] @ ic0[15.. 8] @ ic1[ 7.. 0];
  let oc3 : bits(32) = ic3[31..24] @ ic0[23..16] @ ic1[15.. 8] @ ic2[ 7.. 0];
  (oc3 @ oc2 @ oc1 @ oc0) /* Return value */
}

/* 128-bit to 128-bit implementation of the inverse AES ShiftRows transform.
 * Byte 0 of state is input column 0, bits  7..0.
 * Byte 5 of state is input column 1, bits 15..8.
 */
val aes_shift_rows_inv : bits(128) -&gt; bits(128)
function aes_shift_rows_inv(x) = {
  let ic3 : bits(32) = aes_get_column(x, 3); /* In column 3 */
  let ic2 : bits(32) = aes_get_column(x, 2);
  let ic1 : bits(32) = aes_get_column(x, 1);
  let ic0 : bits(32) = aes_get_column(x, 0);
  let oc0 : bits(32) = ic0[31..24] @ ic3[23..16] @ ic2[15.. 8] @ ic1[ 7.. 0];
  let oc1 : bits(32) = ic1[31..24] @ ic0[23..16] @ ic3[15.. 8] @ ic2[ 7.. 0];
  let oc2 : bits(32) = ic2[31..24] @ ic1[23..16] @ ic0[15.. 8] @ ic3[ 7.. 0];
  let oc3 : bits(32) = ic3[31..24] @ ic2[23..16] @ ic1[15.. 8] @ ic0[ 7.. 0];
  (oc3 @ oc2 @ oc1 @ oc0) /* Return value */
}

/* Applies the forward sub-bytes step of AES to a 128-bit vector
 * representation of its state.
 */
val aes_subbytes_fwd : bits(128) -&gt; bits(128)
function aes_subbytes_fwd(x) = {
  let oc0 : bits(32) = aes_subword_fwd(aes_get_column(x, 0));
  let oc1 : bits(32) = aes_subword_fwd(aes_get_column(x, 1));
  let oc2 : bits(32) = aes_subword_fwd(aes_get_column(x, 2));
  let oc3 : bits(32) = aes_subword_fwd(aes_get_column(x, 3));
  (oc3 @ oc2 @ oc1 @ oc0) /* Return value */
}

/* Applies the inverse sub-bytes step of AES to a 128-bit vector
 * representation of its state.
 */
val aes_subbytes_inv : bits(128) -&gt; bits(128)
function aes_subbytes_inv(x) = {
  let oc0 : bits(32) = aes_subword_inv(aes_get_column(x, 0));
  let oc1 : bits(32) = aes_subword_inv(aes_get_column(x, 1));
  let oc2 : bits(32) = aes_subword_inv(aes_get_column(x, 2));
  let oc3 : bits(32) = aes_subword_inv(aes_get_column(x, 3));
  (oc3 @ oc2 @ oc1 @ oc0) /* Return value */
}

/* Applies the forward MixColumns step of AES to a 128-bit vector
 * representation of its state.
 */
val aes_mixcolumns_fwd : bits(128) -&gt; bits(128)
function aes_mixcolumns_fwd(x) = {
  let oc0 : bits(32) = aes_mixcolumn_fwd(aes_get_column(x, 0));
  let oc1 : bits(32) = aes_mixcolumn_fwd(aes_get_column(x, 1));
  let oc2 : bits(32) = aes_mixcolumn_fwd(aes_get_column(x, 2));
  let oc3 : bits(32) = aes_mixcolumn_fwd(aes_get_column(x, 3));
  (oc3 @ oc2 @ oc1 @ oc0) /* Return value */
}

/* Applies the inverse MixColumns step of AES to a 128-bit vector
 * representation of its state.
 */
val aes_mixcolumns_inv : bits(128) -&gt; bits(128)
function aes_mixcolumns_inv(x) = {
  let oc0 : bits(32) = aes_mixcolumn_inv(aes_get_column(x, 0));
  let oc1 : bits(32) = aes_mixcolumn_inv(aes_get_column(x, 1));
  let oc2 : bits(32) = aes_mixcolumn_inv(aes_get_column(x, 2));
  let oc3 : bits(32) = aes_mixcolumn_inv(aes_get_column(x, 3));
  (oc3 @ oc2 @ oc1 @ oc0) /* Return value */
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="http://svn.clairexen.net/handicraft/2020/lut4perm/demo02.cc" class="bare">http://svn.clairexen.net/handicraft/2020/lut4perm/demo02.cc</a>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="v-st-ext.html">"V" Standard Extension for Vector Operations, Version 1.0</a></span>
  <span class="next"><a href="vector-crypto.html">Cryptography Extensions: Vector Instructions, Version 1.0</a></span>
</nav>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
		<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
