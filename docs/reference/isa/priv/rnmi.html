<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RISC-V Ratified Specifications Library</title>
    <link rel="prev" href="smcntrpmf.html">
    <link rel="next" href="smcdeleg.html">
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: light)')?.matches && 'light'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="1ea0d9f81bc80a15c1f560d76c5d8bddea1856e2"> 
    <meta name="version" content="">
    <meta name="component" content="isa">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">


<header class="header" id="antora-header">
    <nav class="navbar">
        <head>
            <link data-rh="true" rel="icon" href="/img/favicon.ico">
            <link data-rh="true" rel="canonical" href="https://developer.riscv.org/ref">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="en">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="x-default">
            <link data-rh="true" rel="preconnect" href="https://MGVPU7BN22-dsn.algolia.net" crossorigin="anonymous">
            <link rel="stylesheet" type="text/css" href="/docs/reference/_/docusaurus-styles-copy-08-25.css">

        </head>
        <script>
            !function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())
        </script>
            <link rel="preload" as="image" href="/img/logo.svg">
            <div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div>
            <div class="announcementBar_mb4j" role="banner">
                <div class="announcementBarPlaceholder_vyr4"></div>
                <div class="content_knG7 announcementBarContent_xLdY">congratulations, you found the RISC-V Developer Portal! ðŸŽ‰ . This site is under active development and not meant for public consumption yet.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div>
            <nav aria-label="Main" class="navbar ">
                <div class="navbar__inner">
                    <div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button>
                        <a class="navbar__brand" href="/">
                            <div class="navbar__logo"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Specifications</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/isa">ISA</a></li>
                                <li><a class="dropdown__link" href="/docs/spec/profiles">Profiles</a></li>
                                <li><a class="dropdown__link" docid="spec/non-isa" href="/docs/spec/non-isa">Non-ISA</a></li>
                            </ul>
                        </div>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Developers</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/intro">Specification Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/hardware/overview">Hardware Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/software/overview">Software Developers</a></li>
                            </ul>
                        </div><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://riscv.org/community/calendar/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div>
                        <div class="navbar-item search hide-for-print">
                          <div id="search-field" class="field">
                            <input id="search-input" type="text" placeholder="Search">
                          </div>
                        </div>
                    <div class="navbar__items navbar__items--right">


                      <div class="navbarSearchContainer_Bca1">

                      </div>
                    </div>
                </div>
                <div role="presentation" class="navbar-sidebar__backdrop"></div>
            </nav>
            <div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper__tJE"></div>
        

    </nav>
</header><div class="body">
<div class="nav-container" data-component="isa" data-version="">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">ISA Specifications</span>
  <span class="version">default</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Volume I: RISC-V Unprivileged ISA Specification</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/colophon.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/rv32.html">RV32I Base Integer Instruction Set</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/rv32e.html">RV32E and RV64E Base Integer Instruction Sets, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/rv64.html">RV64I Base Integer Instruction Set</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zifencei.html">"Zifencei" Extension for Instruction-Fetch Fence, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zicsr.html">"Zicsr", Extension for Control and Status Register (CSR) Instructions, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/counters.html">"Zicntr" and "Zihpm" Extensions for Counters, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zihintntl.html">"Zihintntl" Extension for Non-Temporal Locality Hints, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zihintpause.html">"Zihintpause" Extension for Pause Hint, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zimop.html">"Zimop" Extension for May-Be-Operations, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zicond.html">"Zicond" Extension for Integer Conditional Operations, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/m-st-ext.html">"M" Extension for Integer Multiplication and Division, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/a-st-ext.html">"A" Extension for Atomic Instructions, Version 2.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zawrs.html">"Zawrs" Extension for Wait-on-Reservation-Set instructions, Version 1.01</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zacas.html">"Zacas" Extension for Atomic Compare-and-Swap (CAS) Instructions, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zabha.html">"Zabha" Extension for Byte and Halfword Atomic Memory Operations, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/rvwmo.html">RVWMO Memory Consistency Model, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/ztso-st-ext.html">"Ztso" Extension for Total Store Ordering, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/cmo.html">"CMO" Extensions for Base Cache Management Operation ISA, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/f-st-ext.html">"F" Extension for Single-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/d-st-ext.html">"D" Extension for Double-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/q-st-ext.html">"Q" Extension for Quad-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zfh.html">"Zfh" and "Zfhmin" Extensions for Half-Precision Floating-Point, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/bfloat16.html">"BF16" Extensions for for BFloat16-precision Floating-Point, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zfa.html">"Zfa" Extension for Additional Floating-Point Instructions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zfinx.html">"Zfinx", "Zdinx", "Zhinx", "Zhinxmin" Extensions for Floating-Point in Integer Registers, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/c-st-ext.html">"C" Extension for Compressed Instructions, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/zc.html">"Zc*" Extension for Code Size Reduction, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/b-st-ext.html">"B" Extension for Bit Manipulation, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/v-st-ext.html">"V" Standard Extension for Vector Operations, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/scalar-crypto.html">Cryptography Extensions: Scalar &amp; Entropy Source Instructions, Version 1.0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/vector-crypto.html">Cryptography Extensions: Vector Instructions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/unpriv-cfi.html">Control-flow Integrity (CFI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/rv-32-64g.html">RV32/64G Instruction Set Listings</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/naming.html">ISA Extension Naming Conventions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/mm-eplan.html">Appendix A: RVWMO Explanatory Material, Version 0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/mm-formal.html">Appendix B: Formal Memory Model Specifications, Version 0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/vector-examples.html">Appendix C: Vector Assembly Code Examples</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="../unpriv/calling-convention.html">Appendix D: Calling Convention for Vector State (Not authoritative - Placeholder Only)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Volume II: RISC-V Privileged ISA Specification</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="priv-index.html">Privileged Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="priv-contributors.html">Contributors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="priv-preface.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="priv-intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="priv-csrs.html">Control and Status Registers (CSRs)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="machine.html">Machine-Level ISA, Version 1.13</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="smstateen.html">"Smstateen/Ssstateen" Extensions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="indirect-csr.html">"Smcsrind/Sscsrind" Indirect CSR Access, version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="#smepmp.adoc">"Smepmp" Extension for PMP Enhancements, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="smcntrpmf.html">"Smcntrpmf" Cycke and Instret Privilege Mode Filtering, Version 1.0</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link"  href="rnmi.html">"Smrnmi" Extension for Resumable Non-Maskable Interrupts, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="smcdeleg.html">"Smcdeleg" Counter Delegation Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="smdbltrp.html">"Smdbltrp" Double Trap Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="smctr.html">"Smctr" Control Transfer Records Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="supervisor.html">Supervisor-Level ISA, Version 1.13</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="sstc.html">"Sstc" Extension for Supervisor-mode Timer Interrupts, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="sscofpmf.html">"Sscofpmf" Extension for Count Overflow and Mode-Based Filtering, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="hypervisor.html">"H" Extension for Hypervisor Support, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="priv-cfi.html">Control-flow Integrity(CFI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="ssdbltrp.html">"Ssdbltrp" Double Trap Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="zpm.html">Pointer Masking Extensions, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="priv-insns.html">RISC-V Privileged Instruction Set Listings</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="priv-history.html">History</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="bibliography.html">Bibliography</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title=""
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li><a href="../index.html">ISA Specifications</a></li>
      <li>Volume II: RISC-V Privileged ISA Specification</li>
      <li><a href="rnmi.html">"Smrnmi" Extension for Resumable Non-Maskable Interrupts, Version 1.0</a></li>
    </ul>
  </nav>
</div><div class="sect1">
<h2 id="rnmi"><a class="anchor" href="#rnmi"></a>"Smrnmi" Extension for Resumable Non-Maskable Interrupts, Version 1.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The base machine-level architecture supports only unresumable
non-maskable interrupts (UNMIs), where the NMI jumps to a handler in
machine mode, overwriting the current <code>mepc</code> and <code>mcause</code> register
values. If the hart had been executing machine-mode code in a trap
handler, the previous values in <code>mepc</code> and <code>mcause</code> would not be
recoverable and so execution is not generally resumable.</p>
</div>
<div class="paragraph">
<p>The Smrnmi extension adds support for resumable non-maskable interrupts
(RNMIs) to RISC-V. The extension adds four new CSRs (<code>mnepc</code>, <code>mncause</code>,
<code>mnstatus</code>, and <code>mnscratch</code>) to hold the interrupted state, and one new
instruction, MNRET, to resume from the RNMI handler.</p>
</div>
<div class="sect2">
<h3 id="rnmi-interrupt-signals"><a class="anchor" href="#rnmi-interrupt-signals"></a>RNMI Interrupt Signals</h3>
<div class="paragraph">
<p>The <code>rnmi</code> interrupt signals are inputs to the hart. These interrupts
have higher priority than any other interrupt or exception on the hart
and cannot be disabled by software. Specifically, they are not disabled
by clearing the <code>mstatus</code>.MIE register.</p>
</div>
</div>
<div class="sect2">
<h3 id="rnmi-handler-addresses"><a class="anchor" href="#rnmi-handler-addresses"></a>RNMI Handler Addresses</h3>
<div class="paragraph">
<p>The RNMI interrupt trap handler address is implementation-defined.</p>
</div>
<div class="paragraph">
<p>RNMI also has an associated exception trap handler address, which is
implementation defined.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For example, some implementations might use the address specified
in <code>mtvec</code> as the RNMI exception trap handler.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="rnmi-csrs"><a class="anchor" href="#rnmi-csrs"></a>RNMI CSRs</h3>
<div class="paragraph">
<p>This extension adds additional M-mode CSRs to enable a resumable
non-maskable interrupt (RNMI).</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/bytefield/svg/eNq1UEFqwzAQvOcVg04WReA4PvnenpKeCyGHtSPFprJkJLVJW_T3yliGpj0XFsSOZmdnpzhLRSE4j2bSNBgc8_vVKGuCUDQO-gPs8IDthCfSuqXulWH59cOnRFXHE98USQjOXkUvh0sfUJe4A-ksnVAGZtAZ11IFMZK7pG27ciXPw3_Q1t6kF1NSSGLYVTPs6Co6q99Gk9V98pyXV_W9QTSaWqk9CiffE1PiyEoG9k91eNk_Povt3Jx45JvsNl2BIshbABuN7xyFrmdr0GuUPAF-onR8FfmPwUX0Nx0rF01r3RJCjPwb18yGKg==" alt="Resumable NMI scratch register `mnscratch`">
</div>
<div class="title">Figure 1. Resumable NMI scratch register <code>mnscratch</code></div>
</div>
<div class="paragraph">
<p>The <code>mnscratch</code> CSR holds an MXLEN-bit read-write register which enables
the RNMI trap handler to save and restore the context that was
interrupted.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/bytefield/svg/eNq1kcFOwzAMhu97CiunVihS200ceuMAp40DF5CmHdzW3SrSpEo8OkB9d1KWSoyBNA5IkaL8duzPv6OKamS2DvJOYaNhHe73vDaaZY1to15BrK4g7eAOlSqwfBZwjLrmjSBbDJt4FvlCYE0vd9RsdwyLBE5ErMjKWoNuVNAV1SxbtFvfbZ5MyePnM7UwB3Ky8xV8MZhno2yxl6VR-1aH6s4zh-bZ4hQQcoUFKQeRpRefSbAWiQDxT2f1tLy9l-n42MRDPAu0fgqImA4MotXUlSAmlycfYy-4DjWk15CPmRJ1uTMWBOnKm14YGwZl001PudeWFDJVo8Js2p8io9vn-jDE53DR483DMhaBrT9aKgqjqu97_53XMVq-hPhz4X8Z5RT56LWYOObZl5Y-8wOgmuQW" alt="Resumable NMI program counter `mnepc`.">
</div>
<div class="title">Figure 2. Resumable NMI program counter <code>mnepc</code>.</div>
</div>
<div class="paragraph">
<p>The <code>mnepc</code> CSR is an MXLEN-bit read-write register which on entry to
the RNMI trap handler holds the PC of the instruction that took the
interrupt.</p>
</div>
<div class="paragraph">
<p>The low bit of <code>mnepc</code> (<code>mnepc[0]</code>) is always zero. On implementations
that support only IALIGN=32, the two low bits (<code>mnepc[1:0]</code>) are always
zero.</p>
</div>
<div class="paragraph">
<p>If an implementation allows IALIGN to be either 16 or 32 (by changing
CSR <code>misa</code>, for example), then, whenever IALIGN=32, bit <code>mnepc[1]</code> is
masked on reads so that it appears to be 0. This masking occurs also for
the implicit read by the MNRET instruction. Though masked, <code>mnepc[1]</code>
remains writable when IALIGN=32.</p>
</div>
<div class="paragraph">
<p><code>mnepc</code> is a <strong>WARL</strong> register that must be able to hold all valid virtual
addresses. It need not be capable of holding all possible invalid
addresses. Prior to writing <code>mnepc</code>, implementations may convert an
invalid address into some other invalid address that <code>mnepc</code> is capable
of holding.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/bytefield/svg/eNqtUsFqwzAMvfcrhE8Jw9CkOYzexuhg0O6wywalBydR2jDHNra6div59zlt0jVtBxsMDMbPetKTnoIcC0FkHYyNFKWCeXvvxoVWxAtRlfID2OwGIgMPQspUZG8MDr-u_ESIk3oRDgKfCKze8BWWyxVBMoQeKHK0vFCgStniEgvilbBLX2007IIb8gWa6i06bnwGnwxGcQNbseGZlutKtdmd19wWj5O-QBhLkaJ0EFh895EIczZkwP7xzF6nkyceX0JR81iEdThoRftmgD0qQmvXhphX7YxQkNThSUBAuCVgk22Ghkqt4F7nyDpXurmHHTnyLTYMLlS20hYYqtyblGrbDoa06Z58rSxKQZg3CJGurv007lzi9TWRwcvd8zQ8itscPGCplvn5ovws2JGw9BvJ-w35Sy99zSz6nvhJtbOgo3W7sz3aE-PbPvMLEB4E9A==" alt="Resumable NMI cause `mncause`.">
</div>
<div class="title">Figure 3. Resumable NMI cause <code>mncause</code>.</div>
</div>
<div class="paragraph">
<p>The <code>mncause</code> CSR holds the reason for the RNMI.
If the reason is an interrupt, bit MXLEN-1 is set to 1, and the RNMI
cause is encoded in the least-significant bits.
If the reason is an interrupt and RNMI causes are not supported, bit MXLEN-1 is
set to 1, and zero is written to the least-significant bits.
If the reason is an exception within M-mode that results in a double trap as
specified in the Smdbltrp extension, bit MXLEN-1 is set to 0 and the
least-significant bits are set to the cause code corresponding to the
exception that precipitated the double trap.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/bytefield/svg/eNrdVF1LwzAUffdXXPLUIoF-qbNvPkwQtjF8UEF8SNdbV8ySkkTnB_vvpq6L1m1uExERUnpzcnLuuTchXo4FM0ZpSCvOSgHXzf8lLaQwtGCTkj8B6e9DWMEp4zxjozsC81VdPiNEyezG3_OsECg5pWMsb8cGkgBaIMtR0UKAKHmDcywMnTB1a7PFwYJcb15CM_mImlZWwYpBfFDDik3pSPL7iWjUtfXcJI-StkFIOcuQa_AUPlgmwjUJCJD5iOa_2H6JAw9ddOSijouOXRQ2OmH4DtWCYezmbvSvet0BfSPe-DN_r6nCVgeewUcD5Bw1qgfMyaL_2jxxBFIaxsvR57b7lqUrJqAz85e1-oPh8F3n85YI0ppGmRiNpQKCwiZNM6maThpZLab0XijkzGBeI8bIyaqV-jiX8dkqZ97lyXnPd96m80MjmeR5u8RgvV9tmDIEtrD8dqV2qWWl52-eTLzmZLq94TZKwQalXVwFm11d_Pv78sevS9LSIoP-WZe4in44z8dEzcsUu2SdD51qF1g_lwuV9aTQkeLfJX3hKd7NePQdpVcAuFnC" alt="Resumable NMI status register `mnstatus`.">
</div>
<div class="title">Figure 4. Resumable NMI status register <code>mnstatus</code>.</div>
</div>
<div class="paragraph">
<p>The <code>mnstatus</code> CSR holds a two-bit field, MNPP, which on entry to the
RNMI trap handler holds the privilege mode of the interrupted context,
encoded in the same manner as <code>mstatus</code>.MPP. It also holds a one-bit
field, MNPV, which on entry to the RNMI trap handler holds the virtualization
mode of the interrupted context, encoded in the same manner as
<code>mstatus</code>.MPV.</p>
</div>
<div class="paragraph">
<p>If the Zicfilp extension is implemented, <code>mnstatus</code> also holds the MNPELP
field, which on entry to the RNMI trap handler holds the previous <code>ELP</code> state.
When an RNMI trap is taken, MNPELP is set to <code>ELP</code> and <code>ELP</code> is set to 0.</p>
</div>
<div class="paragraph">
<p><code>mnstatus</code> also holds the NMIE bit. When NMIE=1, non-maskable interrupts
are enabled. When NMIE=0, <em>all</em> interrupts are disabled.</p>
</div>
<div class="paragraph">
<p>When NMIE=0, the hart behaves as though <code>mstatus</code>.MPRV were clear,
regardless of the current setting of <code>mstatus</code>.MPRV.</p>
</div>
<div class="paragraph">
<p>Upon reset, NMIE contains the value 0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>RNMIs are masked out of reset to give software the opportunity to
initialize data structures and devices for subsequent RNMI handling.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Software can set NMIE to 1, but attempts to clear NMIE have no effect.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Normally, only reset sequences will explicitly set the NMIE bit.</p>
</div>
<hr>
<div class="paragraph">
<p>That the NMIE bit is settable does not suffice to support the nesting of
RNMIs. To support this feature in a direct manner would have required
allowing software to clear the NMIE bitâ€”a design choice that would have
contravened the concept of non-maskability.</p>
</div>
<div class="paragraph">
<p>Software that wishes to minimize the latency until the next RNMI is
taken can follow the top-half/bottom-half model, where the RNMI handler
itself only enqueues a task to a task queue then returns. The bulk of
the interrupt servicing is performed later, with RNMIs enabled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the purposes of the WFI instruction, NMIE is a global interrupt
enable, meaning that the setting of NMIE does not affect the operation
of the WFI instruction.</p>
</div>
<div class="paragraph">
<p>The other bits in <code>mnstatus</code> are <em>reserved</em>; software should write zeros
and hardware implementations should return zeros.</p>
</div>
</div>
<div class="sect2">
<h3 id="mnret-instruction"><a class="anchor" href="#mnret-instruction"></a>MNRET Instruction</h3>
<div class="paragraph">
<p>MNRET is an M-mode-only instruction that uses the values in <code>mnepc</code> and
<code>mnstatus</code> to return to the program counter, privilege mode, and
virtualization mode of the interrupted context. This instruction also
sets <code>mnstatus</code>.NMIE.  If MNRET changes the privilege mode to a mode less privileged than M, it also sets <code>mstatus</code>.MPRV to 0.
If the Zicfilp extension is implemented, then if the new privileged mode
is <em>y</em>, MNRET sets <code>ELP</code> to the logical AND of <em>y</em>LPE (see <a href="#FCFIACT">[FCFIACT]</a>) and <code>mnstatus</code>.MNPELP.</p>
</div>
</div>
<div class="sect2">
<h3 id="rnmi-operation"><a class="anchor" href="#rnmi-operation"></a>RNMI Operation</h3>
<div class="paragraph">
<p>When an RNMI interrupt is detected, the interrupted PC is written to the
<code>mnepc</code> CSR, the type of RNMI to the <code>mncause</code> CSR, and the privilege
mode of the interrupted context to the <code>mnstatus</code> CSR. The
<code>mnstatus</code>.NMIE bit is cleared, masking all interrupts.</p>
</div>
<div class="paragraph">
<p>The hart then enters machine-mode and jumps to the RNMI trap handler
address.</p>
</div>
<div class="paragraph">
<p>The RNMI handler can resume original execution using the new MNRET
instruction, which restores the PC from <code>mnepc</code>, the privilege mode from
<code>mnstatus</code>, and also sets <code>mnstatus</code>.NMIE, which re-enables interrupts.</p>
</div>
<div class="paragraph">
<p>If the hart encounters an exception while executing in M-mode with the <code>mnstatus</code>.NMIE bit clear, the actions taken are the same as if the exception had occurred while <code>mnstatus</code>.NMIE were set, except that the program counter is set to the RNMI exception trap handler address.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Smrnmi extension does not change the behavior of the MRET and SRET
instructions. In particular, MRET and SRET are unaffected by the
<code>mnstatus</code>.NMIE bit, and their execution does not alter the
<code>mnstatus</code>.NMIE bit.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="smcntrpmf.html">"Smcntrpmf" Cycke and Instret Privilege Mode Filtering, Version 1.0</a></span>
  <span class="next"><a href="smcdeleg.html">"Smcdeleg" Counter Delegation Extension, Version 1.0</a></span>
</nav>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
		<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
